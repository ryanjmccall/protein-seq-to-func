{
  "pmcid": "PMC8238499",
  "doi": "10.1016/j.cell.2021.04.048",
  "title": "Integrated analysis of multimodal single-cell data.",
  "year": 2021,
  "journal": "",
  "protein_hits": [
    "CCR7"
  ],
  "xml": "<!DOCTYPE article PUBLIC \"-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.2 20190208//EN\" \"JATS-archivearticle1-mathml3.dtd\"> \n<article xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:mml=\"http://www.w3.org/1998/Math/MathML\" article-type=\"research-article\"><?DTDIdentifier.IdentifierValue -//ES//DTD journal article DTD version 5.6.0//EN//XML?><?DTDIdentifier.IdentifierType public?><?SourceDTD.DTDName art560.dtd?><?SourceDTD.Version 5.6.0?><?ConverterInfo.XSLTName elsevier2nlmx2.xsl?><?ConverterInfo.Version 1?><?origin publisher?><?FILEmeta_CELL12028 xml ?><?FILEmain xml ?><?FILEfigs1 jpg ?><?FILEfigs2 jpg ?><?FILEfigs3 jpg ?><?FILEfigs4 jpg ?><?FILEfigs5 jpg ?><?FILEfigs6 jpg ?><?FILEfigs7 jpg ?><?FILEgr1 jpg ?><?FILEgr2 jpg ?><?FILEgr3 jpg ?><?FILEgr4 jpg ?><?FILEgr5 jpg ?><?FILEgr6 jpg ?><?FILEgr7 jpg ?><?FILEfx1 jpg ?><?FILEmmc1 xlsx ?><?FILEmmc2 xlsx ?><?FILEmmc3 xlsx ?><?FILEsi1 gif ?><?FILEsi2 gif ?><?FILEsi3 gif ?><?FILEsi4 gif ?><?FILEsi5 gif ?><?FILEsi6 gif ?><?FILEsi7 gif ?><?FILEsi8 gif ?><?FILEsi9 gif ?><?FILEsi10 gif ?><?FILEsi11 gif ?><?FILEsi12 gif ?><?FILEsi13 gif ?><?FILEsi14 gif ?><?FILEsi15 gif ?><?FILEsi16 gif ?><?FILEsi17 gif ?><?FILEsi18 gif ?><?FILEsi19 gif ?><?FILEsi20 gif ?><?FILEsi21 gif ?><?FILEsi22 gif ?><?FILEsi23 gif ?><?FILEsi24 gif ?><?FILEsi25 gif ?><?FILEsi26 gif ?><?FILEsi27 gif ?><?FILEsi28 gif ?><?FILEsi29 gif ?><?FILEsi30 gif ?><?FILEsi31 gif ?><?FILEsi32 gif ?><?FILEsi33 gif ?><?FILEsi34 gif ?><?FILEsi35 gif ?><?FILEsi36 gif ?><?FILEsi37 gif ?><?FILEsi38 gif ?><?FILEsi39 gif ?><?FILEsi40 gif ?><?FILEsi41 gif ?><?FILEsi42 gif ?><?properties open_access?><front><journal-meta><journal-id journal-id-type=\"nlm-ta\">Cell</journal-id><journal-id journal-id-type=\"iso-abbrev\">Cell</journal-id><journal-title-group><journal-title>Cell</journal-title></journal-title-group><issn pub-type=\"ppub\">0092-8674</issn><issn pub-type=\"epub\">1097-4172</issn><publisher><publisher-name>Cell Press</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type=\"pmcid\">8238499</article-id><article-id pub-id-type=\"pii\">S0092-8674(21)00583-3</article-id><article-id pub-id-type=\"doi\">10.1016/j.cell.2021.04.048</article-id><article-categories><subj-group subj-group-type=\"heading\"><subject>Resource</subject></subj-group></article-categories><title-group><article-title>Integrated analysis of multimodal single-cell data</article-title></title-group><contrib-group><contrib contrib-type=\"author\" id=\"au1\"><name><surname>Hao</surname><given-names>Yuhan</given-names></name><xref rid=\"aff1\" ref-type=\"aff\">1</xref><xref rid=\"aff2\" ref-type=\"aff\">2</xref><xref rid=\"fn1\" ref-type=\"fn\">10</xref></contrib><contrib contrib-type=\"author\" id=\"au2\"><name><surname>Hao</surname><given-names>Stephanie</given-names></name><xref rid=\"aff3\" ref-type=\"aff\">3</xref><xref rid=\"fn1\" ref-type=\"fn\">10</xref></contrib><contrib contrib-type=\"author\" id=\"au3\"><name><surname>Andersen-Nissen</surname><given-names>Erica</given-names></name><xref rid=\"aff4\" ref-type=\"aff\">4</xref><xref rid=\"aff5\" ref-type=\"aff\">5</xref></contrib><contrib contrib-type=\"author\" id=\"au4\"><name><surname>Mauck</surname><given-names>William M.</given-names><suffix>III</suffix></name><xref rid=\"aff1\" ref-type=\"aff\">1</xref></contrib><contrib contrib-type=\"author\" id=\"au5\"><name><surname>Zheng</surname><given-names>Shiwei</given-names></name><xref rid=\"aff1\" ref-type=\"aff\">1</xref><xref rid=\"aff2\" ref-type=\"aff\">2</xref></contrib><contrib contrib-type=\"author\" id=\"au6\"><name><surname>Butler</surname><given-names>Andrew</given-names></name><xref rid=\"aff1\" ref-type=\"aff\">1</xref><xref rid=\"aff2\" ref-type=\"aff\">2</xref></contrib><contrib contrib-type=\"author\" id=\"au7\"><name><surname>Lee</surname><given-names>Maddie J.</given-names></name><xref rid=\"aff6\" ref-type=\"aff\">6</xref></contrib><contrib contrib-type=\"author\" id=\"au8\"><name><surname>Wilk</surname><given-names>Aaron J.</given-names></name><xref rid=\"aff6\" ref-type=\"aff\">6</xref></contrib><contrib contrib-type=\"author\" id=\"au9\"><name><surname>Darby</surname><given-names>Charlotte</given-names></name><xref rid=\"aff1\" ref-type=\"aff\">1</xref></contrib><contrib contrib-type=\"author\" id=\"au10\"><name><surname>Zager</surname><given-names>Michael</given-names></name><xref rid=\"aff7\" ref-type=\"aff\">7</xref></contrib><contrib contrib-type=\"author\" id=\"au11\"><name><surname>Hoffman</surname><given-names>Paul</given-names></name><xref rid=\"aff1\" ref-type=\"aff\">1</xref></contrib><contrib contrib-type=\"author\" id=\"au12\"><name><surname>Stoeckius</surname><given-names>Marlon</given-names></name><xref rid=\"aff3\" ref-type=\"aff\">3</xref></contrib><contrib contrib-type=\"author\" id=\"au13\"><name><surname>Papalexi</surname><given-names>Efthymia</given-names></name><xref rid=\"aff1\" ref-type=\"aff\">1</xref><xref rid=\"aff2\" ref-type=\"aff\">2</xref></contrib><contrib contrib-type=\"author\" id=\"au14\"><name><surname>Mimitou</surname><given-names>Eleni P.</given-names></name><xref rid=\"aff3\" ref-type=\"aff\">3</xref></contrib><contrib contrib-type=\"author\" id=\"au15\"><name><surname>Jain</surname><given-names>Jaison</given-names></name><xref rid=\"aff1\" ref-type=\"aff\">1</xref></contrib><contrib contrib-type=\"author\" id=\"au16\"><name><surname>Srivastava</surname><given-names>Avi</given-names></name><xref rid=\"aff1\" ref-type=\"aff\">1</xref></contrib><contrib contrib-type=\"author\" id=\"au17\"><name><surname>Stuart</surname><given-names>Tim</given-names></name><xref rid=\"aff1\" ref-type=\"aff\">1</xref></contrib><contrib contrib-type=\"author\" id=\"au18\"><name><surname>Fleming</surname><given-names>Lamar M.</given-names></name><xref rid=\"aff4\" ref-type=\"aff\">4</xref></contrib><contrib contrib-type=\"author\" id=\"au19\"><name><surname>Yeung</surname><given-names>Bertrand</given-names></name><xref rid=\"aff8\" ref-type=\"aff\">8</xref></contrib><contrib contrib-type=\"author\" id=\"au20\"><name><surname>Rogers</surname><given-names>Angela J.</given-names></name><xref rid=\"aff6\" ref-type=\"aff\">6</xref></contrib><contrib contrib-type=\"author\" id=\"au21\"><name><surname>McElrath</surname><given-names>Juliana M.</given-names></name><xref rid=\"aff4\" ref-type=\"aff\">4</xref></contrib><contrib contrib-type=\"author\" id=\"au22\"><name><surname>Blish</surname><given-names>Catherine A.</given-names></name><xref rid=\"aff6\" ref-type=\"aff\">6</xref><xref rid=\"aff9\" ref-type=\"aff\">9</xref></contrib><contrib contrib-type=\"author\" id=\"au23\"><name><surname>Gottardo</surname><given-names>Raphael</given-names></name><xref rid=\"aff4\" ref-type=\"aff\">4</xref></contrib><contrib contrib-type=\"author\" id=\"au24\"><name><surname>Smibert</surname><given-names>Peter</given-names></name><email>smibertp@gmail.com</email><xref rid=\"aff3\" ref-type=\"aff\">3</xref><xref rid=\"cor1\" ref-type=\"corresp\">&#x02217;</xref></contrib><contrib contrib-type=\"author\" id=\"au25\"><name><surname>Satija</surname><given-names>Rahul</given-names></name><email>rsatija@nygenome.org</email><xref rid=\"aff1\" ref-type=\"aff\">1</xref><xref rid=\"aff2\" ref-type=\"aff\">2</xref><xref rid=\"fn2\" ref-type=\"fn\">11</xref><xref rid=\"cor2\" ref-type=\"corresp\">&#x02217;&#x02217;</xref></contrib><aff id=\"aff1\"><label>1</label>Center for Genomics and Systems Biology, New York University, New York, NY 10003, USA</aff><aff id=\"aff2\"><label>2</label>New York Genome Center, New York, NY 10013, USA</aff><aff id=\"aff3\"><label>3</label>Technology Innovation Lab, New York Genome Center, New York, NY 10013, USA</aff><aff id=\"aff4\"><label>4</label>Vaccine and Infectious Disease Division, Fred Hutchinson Cancer Research Center, Seattle, WA 98109, USA</aff><aff id=\"aff5\"><label>5</label>Cape Town HVTN Immunology Lab, Hutchinson Cancer Research Institute of South Africa, Cape Town 8001, South Africa</aff><aff id=\"aff6\"><label>6</label>Department of Medicine, Stanford University School of Medicine, Stanford, CA 94305, USA</aff><aff id=\"aff7\"><label>7</label>Center for Data Visualization, Fred Hutchinson Cancer Research Center, Seattle, WA 98109, USA</aff><aff id=\"aff8\"><label>8</label>BioLegend Inc., San Diego, CA 92121, USA</aff><aff id=\"aff9\"><label>9</label>Chan Zuckerberg Biohub, San Francisco, CA 94063, USA</aff></contrib-group><author-notes><corresp id=\"cor1\"><label>&#x02217;</label>Corresponding author <email>smibertp@gmail.com</email></corresp><corresp id=\"cor2\"><label>&#x02217;&#x02217;</label>Corresponding author <email>rsatija@nygenome.org</email></corresp><fn id=\"fn1\"><label>10</label><p id=\"ntpara0010\">These authors contributed equally</p></fn><fn id=\"fn2\"><label>11</label><p id=\"ntpara0015\">Lead contact</p></fn></author-notes><pub-date pub-type=\"pmc-release\"><day>24</day><month>6</month><year>2021</year></pub-date><!-- PMC Release delay is 0 months and 0 days and was based on <pub-date\n\t\t\t\t\t\tpub-type=\"ppub\">.--><pub-date pub-type=\"ppub\"><day>24</day><month>6</month><year>2021</year></pub-date><volume>184</volume><issue>13</issue><fpage>3573</fpage><lpage>3587.e29</lpage><history><date date-type=\"received\"><day>3</day><month>11</month><year>2020</year></date><date date-type=\"rev-recd\"><day>3</day><month>3</month><year>2021</year></date><date date-type=\"accepted\"><day>28</day><month>4</month><year>2021</year></date></history><permissions><copyright-statement>&#x000a9; 2021 The Authors</copyright-statement><copyright-year>2021</copyright-year><license><ali:license_ref xmlns:ali=\"http://www.niso.org/schemas/ali/1.0/\" specific-use=\"textmining\" content-type=\"ccbylicense\">https://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This is an open access article under the CC BY license (http://creativecommons.org/licenses/by/4.0/).</license-p></license></permissions><abstract id=\"abs0010\"><title>Summary</title><p>The simultaneous measurement of multiple modalities represents an exciting frontier for single-cell genomics and necessitates computational methods that can define cellular states based on multimodal data. Here, we introduce &#x0201c;weighted-nearest neighbor&#x0201d; analysis, an unsupervised framework to learn the relative utility of each data type in each cell, enabling an integrative analysis of multiple modalities. We apply our procedure to a CITE-seq dataset of 211,000 human peripheral blood mononuclear cells (PBMCs) with panels extending to 228 antibodies to construct a multimodal reference atlas of the circulating immune system. Multimodal analysis substantially improves our ability to resolve cell states, allowing us to identify and validate previously unreported lymphoid subpopulations. Moreover, we demonstrate how to leverage this reference to rapidly map new datasets and to interpret immune responses to vaccination and coronavirus disease 2019 (COVID-19). Our approach represents a broadly applicable strategy to analyze single-cell multimodal datasets and to look beyond the transcriptome toward a unified and multimodal definition of cellular identity.</p></abstract><abstract abstract-type=\"graphical\" id=\"abs0015\"><title>Graphical abstract</title><fig id=\"undfig1\" position=\"anchor\"><graphic xlink:href=\"fx1\"/></fig></abstract><abstract abstract-type=\"author-highlights\" id=\"abs0020\"><title>Highlights</title><p><list list-type=\"simple\" id=\"ulist0010\"><list-item id=\"u0010\"><label>&#x02022;</label><p id=\"p0010\">&#x0201c;Weighted nearest neighbor&#x0201d; analysis integrates multimodal single-cell data</p></list-item><list-item id=\"u0015\"><label>&#x02022;</label><p id=\"p0015\">A multimodal reference &#x0201c;atlas&#x0201d; of the circulating human immune system</p></list-item><list-item id=\"u0020\"><label>&#x02022;</label><p id=\"p0020\">Identification and validation of novel sources of lymphoid heterogeneity</p></list-item><list-item id=\"u0025\"><label>&#x02022;</label><p id=\"p0025\">&#x0201c;Reference-based&#x0201d; mapping of query datasets onto a multimodal atlas</p></list-item></list></p></abstract><abstract abstract-type=\"teaser\" id=\"abs0025\"><p>A framework that allows for the integration of multiple data types using single cells is applied to understand distinct immune cell states, previously unidentified immune populations, and to interpret immune responses to vaccinations.</p></abstract><kwd-group id=\"kwrds0010\"><title>Keywords</title><kwd>single cell genomics</kwd><kwd>multimodal analysis</kwd><kwd>CITE-seq</kwd><kwd>immune system</kwd><kwd>T cell</kwd><kwd>reference mapping</kwd><kwd>COVID-19</kwd></kwd-group></article-meta><notes><p id=\"misc0010\">Published: May 31, 2021</p></notes></front><body><sec id=\"sec1\"><title>Introduction</title><p id=\"p0030\">The potential to catalog and characterize the rich diversity of cell types in the human immune system represents a powerful opportunity for single-cell genomics (<xref rid=\"bib13\" ref-type=\"bibr\">Chen et&#x000a0;al., 2019a</xref>; <xref rid=\"bib27\" ref-type=\"bibr\">Gomes et&#x000a0;al., 2019</xref>; <xref rid=\"bib37\" ref-type=\"bibr\">Jaitin et&#x000a0;al., 2014</xref>; <xref rid=\"bib57\" ref-type=\"bibr\">Papalexi and Satija, 2018</xref>; <xref rid=\"bib75\" ref-type=\"bibr\">Stubbington et&#x000a0;al., 2017</xref>), yet&#x000a0;also reveals the limitations of current approaches. Although established technologies like single-cell RNA-seq (scRNA-seq) are capable of discovering new cell types and states in heterogeneous tissues, transcriptomics alone is often incapable of separating molecularly similar, but functionally distinct, categories of immune cells. Despite tremendous functional diversity, distinct populations of T&#x000a0;cells such as effector, regulatory, &#x003b3;&#x003b4;, and mucosal associated invariant T (MAIT), often cannot be effectively separated by scRNA-seq alone, even when using the most sensitive and cutting-edge technologies (<xref rid=\"bib20\" ref-type=\"bibr\">Ding et&#x000a0;al., 2020</xref>; <xref rid=\"bib54\" ref-type=\"bibr\">Mereu et&#x000a0;al., 2020</xref>). This reflects technical challenges driven by the minimal RNA content of T&#x000a0;cells coupled with high RNase expression (<xref rid=\"bib3\" ref-type=\"bibr\">Andreeff et&#x000a0;al., 1978</xref>; <xref rid=\"bib46\" ref-type=\"bibr\">Lu et&#x000a0;al., 2018</xref>; <xref rid=\"bib68\" ref-type=\"bibr\">Sercan Alp et&#x000a0;al., 2015</xref>), which hampers scRNA-seq data quality. More broadly, this exhibits the challenge of defining cell states based on the transcriptome alone, because important sources of cellular heterogeneity may not correlate strongly with transcriptomic features despite being identifiable in other modalities.</p><p id=\"p0035\">Multimodal single-cell technologies, which simultaneously profile multiple data types in the same cell, represent a new frontier for the discovery and characterization of cell states. For example, we recently introduced CITE-seq (<xref rid=\"bib71\" ref-type=\"bibr\">Stoeckius et&#x000a0;al., 2017</xref>), which leverages oligonucleotide-conjugated antibodies to simultaneously quantify RNA and surface protein abundance in single cells via the sequencing of antibody-derived tags (ADTs). Moreover, pioneering technological advancements now enable the simultaneous profiling of transcriptome alongside either chromatin accessibility (<xref rid=\"bib11\" ref-type=\"bibr\">Cao et&#x000a0;al., 2018</xref>; <xref rid=\"bib14\" ref-type=\"bibr\">Chen et&#x000a0;al., 2019b</xref>), DNA methylation (<xref rid=\"bib25\" ref-type=\"bibr\">Gaiti et&#x000a0;al., 2019</xref>; <xref rid=\"bib48\" ref-type=\"bibr\">Luo et&#x000a0;al., 2019</xref>), nucleosome occupancy (<xref rid=\"bib15\" ref-type=\"bibr\">Clark et&#x000a0;al., 2018</xref>; <xref rid=\"bib61\" ref-type=\"bibr\">Pott, 2017</xref>), or spatial location (<xref rid=\"bib64\" ref-type=\"bibr\">Rodriques et&#x000a0;al., 2019</xref>; <xref rid=\"bib81\" ref-type=\"bibr\">Vickovic et&#x000a0;al., 2019</xref>). Each of these approaches offers an exciting solution to overcome the inherent limitations of scRNA-seq and to explore how multiple cellular modalities affect cellular state and function (<xref rid=\"bib91\" ref-type=\"bibr\">Zhu et&#x000a0;al., 2020</xref>).</p><p id=\"p0040\">The maturation of multimodal single-cell technologies also necessitates the development of new computational methods to integrate information across different data types (<xref rid=\"bib21\" ref-type=\"bibr\">Efremova and Teichmann, 2020</xref>). For example, although CITE-seq datasets can be analyzed by first identifying clusters based on gene expression values (<xref rid=\"bib59\" ref-type=\"bibr\">Peterson et&#x000a0;al., 2017</xref>; <xref rid=\"bib71\" ref-type=\"bibr\">Stoeckius et&#x000a0;al., 2017</xref>) and subsequently exploring their immunophenotypes, a multimodal computational workflow would define cell states based on both modalities. Importantly, these strategies must be robust to potentially large differences in the data quality and information content for each modality. In some contexts, robust protein quantifications may be most valuable for clustering, especially with a large and well-designed antibody panel. In other contexts (particularly when important cell type markers are missing or not previously known), the unsupervised nature of a cell&#x02019;s transcriptome may be the most valuable. The varying information content of each modality, even across cells in the same dataset, represents a pressing challenge for the analysis and integration of multimodal datasets.</p><p id=\"p0045\">Here, we introduce &#x0201c;weighted-nearest neighbor&#x0201d; (WNN) analysis, an analytical framework to integrate multiple data types measured within a cell and to obtain a joint definition of cellular state. Our approach is based on an unsupervised strategy to learn cell-specific modality &#x0201c;weights,&#x0201d; which reflect the information content for each modality and determine its relative importance in downstream analyses. We demonstrate that WNN analysis substantially improves our ability to define cellular states in multiple biological contexts and data types. We leverage this method to generate a multimodal &#x0201c;atlas&#x0201d; based on a CITE-seq dataset of 211,000 human peripheral blood mononuclear cells (PBMCs), with large cell-surface protein marker panels extending up to 228 antibodies. We utilize this dataset to identify and validate heterogeneous cell states in human lymphocytes and explore how the human immune system responds to vaccination and severe acute respiratory syndrome coronavirus 2 (SARS-CoV-2) infection. Our approach, implemented in an updated version 4 of our open source R toolkit Seurat, represents a broadly applicable strategy for integrative multimodal analysis of single-cell data.</p></sec><sec id=\"sec2\"><title>Results</title><sec id=\"sec2.1\"><title>Quantifying the relative utility of each modality in each cell</title><p id=\"p0050\">We sought to design a robust analytical workflow for the integration of multiple measurements collected within the same cell. To be applied to a range of biological contexts and data types, our strategy must successfully address the following criteria. First, the workflow must be robust to potentially vast differences in data quality between the modalities. Second, integrative multimodal analysis should enable multiple downstream analytical tasks, including visualization, clustering, and the identification of cellular trajectories. Last, and most importantly, simultaneous analysis of multiple modalities should improve on the ability to discover and characterize cell states, compared to independent analyses of each modality when performed separately.</p><p id=\"p0055\">These challenges highlight the importance of a flexible framework to handle diverse datasets. As previously described for CITE-seq (<xref rid=\"bib55\" ref-type=\"bibr\">Mimitou et&#x000a0;al., 2019</xref>; <xref rid=\"bib71\" ref-type=\"bibr\">Stoeckius et&#x000a0;al., 2017</xref>), the increased copy number of protein molecules compared to RNA molecules typically leads to more robust detection of protein features. The protein data in CITE-seq may therefore represent the most informative modality, particularly in cases where the antibody panel comprehensively represents all cell subsets with high specificity. Other panels may omit antibodies for key or previously undiscovered markers, or contain antibodies with low binding specificity, in which case the unsupervised nature of scRNA-seq may be most informative. Even within the same dataset, the relative utility of each modality to define cell states may vary across individual cells.</p><p id=\"p0060\">We therefore designed an analytical solution to address these goals, without requiring prior knowledge from the user regarding the importance of each modality. We first introduce and demonstrate our solution on our previously generated CITE-seq dataset of 8,617 cord blood mononuclear cells, with a panel of 10 immunophenotypic markers (<xref rid=\"bib71\" ref-type=\"bibr\">Stoeckius et&#x000a0;al., 2017</xref>). Independent unsupervised analysis of the RNA and protein data revealed largely consistent cell classifications (<xref rid=\"fig1\" ref-type=\"fig\">Figures 1</xref>A, 1B, and <xref rid=\"figs1\" ref-type=\"fig\">S1</xref>) but did exhibit some differences. For example, CD8<sup>+</sup> and CD4<sup>+</sup> T&#x000a0;cells were partially blended together when analyzing the transcriptome but separated clearly in the protein data. Contrastingly, conventional dendritic cells (cDCs), along with a rare population of erythroid progenitors and spiked-in murine 3T3 controls, formed distinct clusters when analyzing RNA but were intermixed with other cell types based on surface protein abundance. With biological foresight, the cell-type-specific differences across modalities could be predicted by the composition of the CITE-seq panel, which contained anti-CD4 and anti-CD8 antibodies but lacked any immunophenotypic markers to discriminate cDCs.<fig id=\"fig1\"><label>Figure&#x000a0;1</label><caption><p>Schematic overview of multimodal integration using weighted nearest neighbor analysis</p><p>(A and B) Independent analysis of transcriptome (A) and protein (B) modalities from a CITE-seq dataset of cord blood mononuclear cells. Blue dot marks the same target cell in (A) and (B). Red dots denote the k&#x000a0;= 20 nearest neighbors to the target cell based on the transcriptome (A) or protein (B) modalities.</p><p>(C) The RNA neighbors are averaged together to predict the molecular contents of the target cell, which can be compared to the actual measurements. Each dot denotes an individual gene, and the axis scale of expression is based on default log-normalization in Seurat. Because the RNA neighbors represent a mixture of different T&#x000a0;cell subsets, there is substantial error between predicted and measured protein expression levels for CD4 and CD8.</p><p>(D) Same as in (C), but averaging protein neighbors. Because protein neighbors are all CD8 T&#x000a0;cells, the predicted values are close to the actual measurements. We can therefore infer that for this target cell, the protein data are most useful for defining cell state and assign it a higher protein modality weight. As described in <xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>, we perform the prediction and comparison steps in low-dimensional space.</p><p>(E) We can integrate the modalities by constructing a weighted nearest neighbor (WNN) graph, based on a weighted average of protein and RNA similarities. UMAP visualization and clustering of this graph.</p><p>(F) Median RNA and protein modality weights for all cell types in the dataset. Modality weights were calculated for each cell without knowledge of cell type labels.</p><p>See also <xref rid=\"figs1\" ref-type=\"fig\">Figure&#x000a0;S1</xref>.</p></caption><graphic xlink:href=\"gr1\"/></fig><fig id=\"figs1\"><label>Figure&#x000a0;S1</label><caption><p>Weighted nearest neighbor analysis on a CITE-seq dataset of cord blood mononuclear cells, related to <xref rid=\"fig1\" ref-type=\"fig\">Figure&#x000a0;1</xref></p><p>(A, B) Independent analysis of transcriptome (A) and protein (B) modalities from a CITE-seq analysis of cord blood mononuclear cells. Panels A-D correspond to <xref rid=\"fig1\" ref-type=\"fig\">Figures 1</xref>A&#x02013;1D, but the target cell is a dendritic cell instead of a CD8 T&#x000a0;cell. Blue dot marks the same target dendritic cell in (A) and (B). Red dots denote the k&#x000a0;= 20 nearest neighbors to the target dendritic cell based on the transcriptome (A) or protein (B) modalities. (C) The RNA neighbors are averaged together to predict the molecular contents of the target dendritic cells. Since the RNA neighbors are all dendritic cells, the predicted values are close to the actual measurements. (D) Same as in (C), but averaging protein neighbors. Since protein neighbors are a mixture of cell types, there is substantial error between predicted and measured RNA expression. Thus, the RNA data is more informative for characterizing the state of the target cell, and the cell is assigned an increased RNA modality weight. (E) RNA, Protein and WNN UMAP visualization for this dataset. Cells are annotated by their WNN-assigned labels. Visualizations are the same as in <xref rid=\"fig1\" ref-type=\"fig\">Figure&#x000a0;1</xref>, but all cell types are labeled on the UMAP plots for greater clarity. (F) Feature plot of CD8 protein expression on all three UMAP visualizations, showing that WNN and ADT analyses help to separate CD4 and CD8 T&#x000a0;cells, and also identify additional heterogeneity within NK cells.</p></caption><graphic xlink:href=\"figs1\"/></fig></p><p id=\"p0065\">For each cell, we began by independently calculating sets of <italic>k</italic>&#x000a0;= 20 nearest neighbors for each modality. We found that for CD8<sup>+</sup> T&#x000a0;cells, the most similar RNA neighbors often reflected a mix of CD8<sup>+</sup> and CD4<sup>+</sup> T&#x000a0;cells (in the RNA KNN graph, there are a total of 944 incorrect edges that connect CD8<sup>+</sup> to CD4<sup>+</sup> T&#x000a0;cells). By contrast, protein neighbors were predominantly correctly identified as CD8<sup>+</sup> T&#x000a0;cells (in the protein KNN graph, 12 CD8<sup>+</sup>/CD4<sup>+</sup> edges were identified). This reflects the particular utility of protein data when defining the state of these cells. Next, we independently averaged the molecular profiles of protein neighbors and RNA neighbors (i.e., predicted the molecular contents of a cell from its neighbors), and compared the averages to their original measured values. We found that for CD8<sup>+</sup> T&#x000a0;cells, protein KNN-based predictions were more accurate compared to RNA KNN-based predictions (<xref rid=\"fig1\" ref-type=\"fig\">Figures 1</xref>C and 1D), whereas the converse was true for cDCs (<xref rid=\"figs1\" ref-type=\"fig\">Figure&#x000a0;S1</xref>).</p><p id=\"p0070\">We then leveraged the relative accuracy of these predictions to calculate RNA and protein modality &#x0201c;weights,&#x0201d; describing their relative information content for each individual cell. We provide a detailed mathematical description for each component of the WNN workflow in the <xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>, highlighting three key steps: (1) obtaining within modality and cross-modality predictions, (2) converting these to prediction affinities, based on a cell-specific bandwidth kernel, and (3) calculating modality weights using a softmax transformation. The RNA and protein modality weights are non-negative, unique to each cell, and sum to 1.</p><p id=\"p0075\">Our final step integrates the modalities to create a WNN graph. For each cell, we calculate a new set of <italic>k</italic>-nearest cells based on a metric that reflects the weighted average of normalized RNA and protein similarities (<xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>). The WNN graph is a single representation of a multimodal dataset, but should more accurately reflect the richness of both data types. For example, the WNN graph contained only 20 CD8<sup>+</sup>/CD4<sup>+</sup> edges. Moreover, many common analytical tasks for single-cell data&#x02014;including t-distributed stochastic neighbor embedding)/uniform manifold approximation and projection (t-SNE/UMAP) visualization, clustering, and trajectory inference&#x02014;can accept a user-specified neighbor graph as input. We therefore used our WNN graph to derive an integrated UMAP and clustering of our CITE-seq dataset (<xref rid=\"fig1\" ref-type=\"fig\">Figure&#x000a0;1</xref>E). In contrast to the separate analysis of either modality, our joint integration clearly separated CD4<sup>+</sup> and CD8<sup>+</sup> T&#x000a0;cells, retained the identity of cDCs, and also uncovered additional sources of subtle heterogeneity within natural killer (NK) cells (<xref rid=\"figs1\" ref-type=\"fig\">Figure&#x000a0;S1</xref>). We observed that cells classified as CD8<sup>+</sup> T&#x000a0;cells were assigned higher protein modality weights, whereas DCs were assigned higher RNA modality weights, recapitulating our biological expectations despite the fact that the calculation of modality weights was unsupervised and unaware of cell-type labels (<xref rid=\"fig1\" ref-type=\"fig\">Figure&#x000a0;1</xref>F).</p></sec><sec id=\"sec2.2\"><title>WNN analysis is a robust and flexible approach for multimodal analysis</title><p id=\"p0080\">We next further explored the performance of our WNN integration, assessed its robustness to fluctuations in data quality, and performed benchmarking against other recently developed methods. For these analyses, we used a more recently generated CITE-seq dataset of human bone marrow, representing 30,672 mononuclear cells with a panel of 25 antibodies. While the samples contained cells across the full spectrum of hematopoietic differentiation, the antibody panel was designed to separate groups of terminally differentiated cells.</p><p id=\"p0085\">Consistent with our previous example, WNN integration substantially increased our ability to resolve hematopoietic cell states (<xref rid=\"fig2\" ref-type=\"fig\">Figures 2</xref>A and <xref rid=\"figs2\" ref-type=\"fig\">S2</xref>). Once cell states were annotated through integrated multimodal clustering, we were able to discover differentially expressed (DE) genes and proteins in each group, further validating their biological identity and significance (<xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>). However, although these cell types are defined by both RNA and protein markers, the statistical power in unsupervised analysis of either modality separately was insufficient to identify these populations, demonstrating the importance of joint analysis. Indeed, when examining the cell-specific modality weights, we found that T&#x000a0;cell groups&#x02014;and in particular, populations that were masked in scRNA-seq analyses&#x02014;all received higher protein modality weights (<xref rid=\"fig2\" ref-type=\"fig\">Figure&#x000a0;2</xref>B). We found that unsupervised transcriptome-focused clustering was unable to separate these cell states, even if we performed a focused re-clustering using only T&#x000a0;cells (<xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>).<fig id=\"fig2\"><label>Figure&#x000a0;2</label><caption><p>Benchmarking and robustness analysis for WNN integration</p><p>(A) Analysis of a CITE-seq dataset of human bone marrow mononuclear cells and 25 surface proteins. UMAP visualizations are computed using RNA, protein, or WNN analysis. Cell annotations are derived from WNN analysis and reveal heterogeneity within T&#x000a0;cells and progenitors that cannot be discovered by either modality independently. Granular annotations, which more clearly indicate subpar performance when analyzing only one modality, are shown in <xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>.</p><p>(B) Single-cell protein modality weights. Progenitor populations all receive low protein weights, whereas T&#x000a0;cell populations receive high protein modality weights, consistent with the composition of the antibody panel that was tailored for differentiated cell types.</p><p>(C) To test the robustness of WNN, we added increasing amounts of Gaussian noise to the protein data. Protein weights decrease to 0 in all cell types as noise levels increase.</p><p>(D and E) Benchmarking WNN against totalVI and MOFA+. (D) The integrated latent space defined by WNN most accurately reconstructs expression levels for 25 proteins. (E) WNN analysis exhibits improved runtimes compared to competing methods. Additional benchmarking analyses in <xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>.</p><p>See also <xref rid=\"figs3\" ref-type=\"fig\">Figure&#x000a0;S3</xref>.</p></caption><graphic xlink:href=\"gr2\"/></fig><fig id=\"figs2\"><label>Figure&#x000a0;S2</label><caption><p>Benchmarking and robustness analysis for WNN integration on a CITE-seq dataset of human bone marrow mononuclear cells (BMNC), related to <xref rid=\"fig2\" ref-type=\"fig\">Figure&#x000a0;2</xref></p><p>(A) UMAP visualizations of the BMNC dataset based on five analytical strategies: independent RNA analysis, independent Protein analysis, WNN, totalVI and MOFA+. Cell annotations are derived from WNN analysis, which reflect distinct molecular states (see heatmaps in (G-H)). Dashed ovals indicate regions in each analysis where cell states are intermixed. (B) Expression of protein CD25 and CD57 in these five UMAP visualizations. In WNN analysis, cells that are positive for these proteins are correctly determined to be neighbors of each other, and therefore separate in UMAP visualization. (C) Robustness analysis for k in the WNN procedure (k&#x000a0;= 20 by default). We varied the number of single-cell RNA modality weights across different number of k-nearest neighbors used (k&#x000a0;= 10, 20, 30, 50) on the BMNC dataset, and show single-cell violin plots of the resulting RNA modality weight. We observe only minor fluctuations when varying k within this range. (D) Benchmarking WNN against totalVI and MOFA+. The integrated latent space defined by WNN most accurately reconstructs expression levels for all 25 proteins. Same as <xref rid=\"fig2\" ref-type=\"fig\">Figure&#x000a0;2</xref>D but showing Spearman correlation instead of Pearson correlation. (E) When using the integrated latent space to reconstruct 2000 variable features in the transcriptome, all three methods exhibit equivalent performance. Figure&#x000a0;shows boxplot of Pearson correlation between predicted and measured values for 2,000 features. Benchmarking metrics are described further in <xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>. (F) Memory usage for all three methods as a function of the size of the input dataset. (G) Heatmap of WNN-annotated T&#x000a0;cell states. Features include the best RNA and protein features identified by differential expression. Heatmap displays pseudobulk averages where cells are grouped by cell type, human donor, and technical replicate, and demonstrates that markers are repeatedly detected across samples and replicates. (H) Same as in (G) but for progenitor cell states. (I) Sub-clustering BMNC T&#x000a0;cells based on RNA profiles, ADT profiles, and WNN analysis. (J) Gene dropout curve for neighbors of regulatory T&#x000a0;cells defined by RNA, ADT, and WNN analysis. Each point represents a gene, with the average trendline in black. Genes that deviate from the trendline (STAR Methods) are denoted as &#x02018;variable&#x02019; and plotted as red dots. Rightmost panel represents an upsetR plot examining the set of variable genes identified for each neighborhood set, and shows that WNN-derived neighborhoods exhibit a lower number of variable genes than RNA-derived neighborhoods. (K) Same as in (J) but for HSC cells. (L) Same as (J) but examining the standard deviation of gene expression as an alternative metric to dropout rate. (M) Same as in (L) but for HSC cells. (N) Absolute log2FC of differentially expressed genes between CD4 Naive and CD8 Naive clusters, where clusters were defined by either RNA or WNN analysis (STAR Methods). (O) Distribution of changes in the magnitude of log2FC for differentially expressed genes between cell populations based on WNN-based and RNA-based clustering. Distributions are centered at 0, indicating that for all comparisons, WNN-derived clusters were equally effective at identifying cluster-enriched genes as RNA-derived clusters.</p></caption><graphic xlink:href=\"figs2\"/></fig></p><p id=\"p0090\">Conversely, each of the cell populations with the highest RNA weights represented hematopoietic progenitor populations. As a result, our multimodal analysis was able to identify diverse populations of hematopoietic stem cells, lymphoid-primed multipotent progenitors (LMPP), and progenitors of erythroid, platelet, monocyte, B, and conventional/plasmacytoid DC lineages that could be recovered in scRNA-seq data, even though these groups lacked immunophenotypic markers in our CITE-seq experiment. We confirmed that our results were robust to a range of values for <italic>k</italic> (<xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>), and the incorporation of protein information in the WNN graph does not come at the expense of identifying transcriptomically congruent neighborhoods (<xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>; <xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>).</p><p id=\"p0095\">These results suggest that integrated WNN analysis can provide necessary flexibility and allow one data type to compensate for weaknesses in another. We confirmed this using a simulation experiment, where we added increasing amounts of random Gaussian noise to the ADT data, in order to mimic increases in nonspecific binding (<xref rid=\"fig2\" ref-type=\"fig\">Figure&#x000a0;2</xref>C). We found that the increasing ADT noise led to a decrease in protein weights for all cell types, in a dose-dependent manner. Moreover, protein modality weights were assigned to 0 after a sufficient amount of protein noise was added, correctly instructing downstream analyses to focus only on scRNA-seq data.</p><p id=\"p0100\">We next benchmarked WNN analysis against two recently introduced methods for multimodal integration: multi-omics factor analysis v2 (MOFA+) (<xref rid=\"bib5\" ref-type=\"bibr\">Argelaguet et&#x000a0;al., 2020</xref>), which uses a statistical framework based on factor analysis, and totalVI (<xref rid=\"bib26\" ref-type=\"bibr\">Gayoso et&#x000a0;al., 2019</xref>), which combines deep neural networks with a hierarchical Bayesian model. Both methods integrate the modalities into a latent space, which we used to construct an integrated <italic>k</italic>-NN graph and a 2D UMAP visualization. We reasoned that we could quantify the performance of the different methods by comparing the similarity of each cell&#x02019;s molecular state to its closest neighbors in the integrated latent space. We found that for each of the 25 proteins (<xref rid=\"fig2\" ref-type=\"fig\">Figure&#x000a0;2</xref>D), as well as the RNA transcriptome (<xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>), WNN analysis exhibited superior or equivalent performance to alternative approaches. The difference in performance was particularly striking for markers of regulatory (CD25) and effector (CD57) T&#x000a0;cells. This was consistent with UMAP visualization, in which WNN was the only method where these populations were not intermixed with other groups (<xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>). WNN analysis also exhibited significant improvements in speed, ranging up to 15-fold when analyzing the full dataset (<xref rid=\"fig2\" ref-type=\"fig\">Figure&#x000a0;2</xref>E).</p><p id=\"p0105\">Although we primarily demonstrate our approach on CITE-seq datasets, our strategy is applicable to diverse multimodal technologies. For example, recent developments have enabled the simultaneous measurement of ATAC-seq profiles and transcriptomes from single nuclei (<xref rid=\"bib11\" ref-type=\"bibr\">Cao et&#x000a0;al., 2018</xref>; <xref rid=\"bib14\" ref-type=\"bibr\">Chen et&#x000a0;al., 2019b</xref>). We applied WNN analysis to a dataset of 11,351 paired PBMC profiles generated by the 10x Genomics Multiome ATAC+RNA kit. We found that the combination of modalities exhibited maximal power to separate immune subsets (<xref rid=\"figs3\" ref-type=\"fig\">Figure&#x000a0;S3</xref>). Interestingly, similar to our CITE-seq analyses, we found that ATAC-seq data were more capable of separating naive CD8<sup>+</sup> and CD4<sup>+</sup> T&#x000a0;cell states due to reliable detection of cell-type-specific open chromatin regions (<xref rid=\"figs3\" ref-type=\"fig\">Figure&#x000a0;S3</xref>). The separation of these clusters upon UMAP visualization (<xref rid=\"figs3\" ref-type=\"fig\">Figure&#x000a0;S3</xref>) was consistent with the number of incorrect naive CD8<sup>+</sup>/CD4<sup>+</sup> edges identified in each representation (RNA KNN: 984, ATAC KNN: 373, WNN: 322).<fig id=\"figs3\"><label>Figure&#x000a0;S3</label><caption><p>Applying WNN to additional multimodal technologies, related to <xref rid=\"fig2\" ref-type=\"fig\">Figure&#x000a0;2</xref></p><p>(A) Analysis of a publicly available dataset of 11,351 PBMC processed with the 10x Genomics Multiome ATAC+RNA kit. UMAP visualizations of RNA and ATAC-seq data, as well as integrated WNN analysis. Cells are labeled by their WNN-annotated clusters. (B) Visualization of pseudobulk chromatin accessibility tracks of the CD8A locus for eight T&#x000a0;cell subsets. Multiple peaks clearly separate CD8+ and CD8- T&#x000a0;cells, exemplifying the information in ATAC-seq that can enhance parallel RNA measurements for defining cell states. (C) Enriched motifs within MAIT-specific open chromatin regions. Since multiple transcription factors (i.e., RORA, RORB, RORC) have very similar binding motifs, each exhibits strong evidence of enrichment. (D) Density plots, produced by the Nebulosa package, showing the RNA expression of RORC, RORA and RORB. (E) Visualization of RORC motif activity, as calculated by chromVAR, which mirrors the expression of the RORC as shown in (D). (F) Analysis of a published ASAP-seq dataset of 4,725 human PBMC where chromatin accessibility and surface expression of 227 surface proteins are simultaneously measured. UMAP visualizations of ATAC and protein data, as well as integrated WNN analysis. Cells are labeled by their WNN-annotated clusters. (G) Enriched motifs within MAIT-specific open chromatin regions in the ASAP-seq dataset are concordant with those identified in ATAC+RNA analysis. (H) Analysis of a publicly available dataset of 34,774 mouse skin cells from SHARE-seq, which generates paired single-cell profiles of gene expression and chromatin accessibility. UMAP visualizations of RNA and ATAC-seq profiles, as well as integrated WNN analysis. Cells are labeled by their annotations from (Ma et&#x000a0;al., 2020b). (I) Four basal subpopulations were identified from WNN clustering, and cells from each subpopulation are highlighted in the UMAP visualizations from (H). Basal_4 and Basal_1 do not separate in transcriptomic analysis, but form distinct clusters in ATAC and WNN analysis. (J) Pseudobulk expression profiles of the Basal_4 and Basal_1 subpopulations demonstrate that the two groups exhibit similar transcriptomic profiles. (K) Top motifs exhibiting differential accessibility between Basal_4 and Basal_1, as identified by chromVar analysis. (L) chromVar motif activity scores for the p53 and CTCF motifs for all basal subpopulations. In each case, Basal_4 exhibits elevated accessibility at these motif sites. <sup>&#x02217;&#x02217;&#x02217;</sup>p value&#x000a0;&#x0003c; 1e-5 based on Wilcoxon test. (M) Visualization of pseudobulk chromatin accessibility tracks of the Ct<italic>cf.</italic> locus for four basal subpopulations. In addition to exhibiting greater accessibility globally at CTCF motif sites, Basal_4 exhibits increased accessibility at the Ct<italic>cf.</italic> promoter.</p></caption><graphic xlink:href=\"figs3\"/></fig></p><p id=\"p0110\">The combination of ATAC and RNA data also allowed us to identify differentially accessible DNA sequence motifs between our WNN-defined clusters. For example, we found that ATAC-seq peaks accessible in MAIT cells were highly enriched for motifs for the pro-inflammatory transcription factor ROR&#x003b3;t (<xref rid=\"bib36\" ref-type=\"bibr\">Ivanov et&#x000a0;al., 2006</xref>; <xref rid=\"bib87\" ref-type=\"bibr\">Willing et&#x000a0;al., 2018</xref>), which was also upregulated transcriptionally in these cells (<xref rid=\"figs3\" ref-type=\"fig\">Figure&#x000a0;S3</xref>). We obtained highly concordant results when applying WNN analysis to ASAP-seq (<xref rid=\"bib56\" ref-type=\"bibr\">Mimitou et&#x000a0;al., 2020</xref>), a third multimodal technology, that pairs measurements of surface protein abundance with ATAC-seq profiles in single cells (<xref rid=\"figs3\" ref-type=\"fig\">Figure&#x000a0;S3</xref>).</p><p id=\"p0115\">Last, we considered a recent dataset of 34,774 mouse skin cells generated by SHARE-seq (<xref rid=\"bib50\" ref-type=\"bibr\">Ma et&#x000a0;al., 2020</xref>), which generates paired measurements of chromatin accessibility and gene expression. WNN analysis recapitulated each of the 23 populations described in the original manuscript where unsupervised clustering was performed on transcriptomic measurements, including three subgroups of Basal cells that could be distinguished from scRNA-seq. However, in addition to the published findings, WNN analysis identified a novel population of Basal cells that exhibits distinct chromatin accessibility profiles, but does not exhibit unique transcriptomic characteristics (<xref rid=\"figs3\" ref-type=\"fig\">Figure&#x000a0;S3</xref>). As basal cells in the skin are continually replenished (<xref rid=\"bib23\" ref-type=\"bibr\">Epstein, 2008</xref>), cells that exhibit a primed chromatin state preceding transcriptomic shifts may differ in their proliferative and regenerative potential. We found that the Basal_4 population was specifically characterized by increased chromatin accessibility at CTCF and p53 motifs (<xref rid=\"bib18\" ref-type=\"bibr\">Demirkan et&#x000a0;al., 2000</xref>) (<xref rid=\"figs3\" ref-type=\"fig\">Figure&#x000a0;S3</xref>). Notably, basal cell carcinoma, the most common form of skin cancer, is often characterized by mutations in p53 and CTCF binding sites (<xref rid=\"bib62\" ref-type=\"bibr\">Poulos et&#x000a0;al., 2016</xref>) and results in uncontrolled basal cell division. Taken together, these findings demonstrate that the ability of WNN to identify subpopulations that are masked by scRNA-seq alone is not limited to immune or CITE-seq datasets. We conclude that WNN analysis is capable of sensitively and robustly characterizing populations that cannot be identified by a single modality, exhibits best-in-class performance, and can be flexibly applied to multiple data types for integrative and multimodal analysis.</p></sec><sec id=\"sec2.3\"><title>A multimodal atlas of the human PBMCs</title><p id=\"p0120\">Although flow cytometry and cytometry by time of flight (CyTOF) are widely used and powerful approaches for making high-dimensional measurements of protein expression in immune cells (<xref rid=\"bib7\" ref-type=\"bibr\">Bendall et&#x000a0;al., 2011</xref>; <xref rid=\"bib8\" ref-type=\"bibr\">Bodenmiller et&#x000a0;al., 2012</xref>; <xref rid=\"bib19\" ref-type=\"bibr\">Diggins et&#x000a0;al., 2015</xref>; <xref rid=\"bib65\" ref-type=\"bibr\">Saeys et&#x000a0;al., 2016</xref>), CITE-seq&#x02019;s use of distinct oligonucleotide barcode sequences provides a unique opportunity to profile very large panels of antibodies alongside cellular transcriptomes. In addition, we have recently demonstrated that the signal-to-noise for each antibody can be optimized for any individual marker as a function of antibody concentration, and we have shown that CITE-seq data quality does not deteriorate with greater amounts of total antibody (<xref rid=\"bib72\" ref-type=\"bibr\">Stoeckius et&#x000a0;al., 2018</xref>). We therefore curated and optimized a panel of TotalSeqA reagents encompassing 228 antibodies (<xref rid=\"mmc1\" ref-type=\"supplementary-material\">Table S1</xref>) comprising a diverse set of lineage and activation markers.</p><p id=\"p0125\">We leveraged the CITE-seq technology alongside our optimized antibody panel and integrative WNN analysis strategy to generate a multimodal atlas of human PBMCs. We obtained PBMC samples from eight volunteers enrolled in an HIV vaccine trial (<xref rid=\"bib22\" ref-type=\"bibr\">Elizaga et&#x000a0;al., 2018</xref>; <xref rid=\"bib44\" ref-type=\"bibr\">Li et&#x000a0;al., 2017</xref>), with ages spanning from 20&#x02013;49 years. For each subject, PBMCs were collected at three time points: immediately before (day 0), 3&#x000a0;days, and 7&#x000a0;days following administration of a VSV-vectored HIV vaccine (<xref rid=\"fig3\" ref-type=\"fig\">Figure&#x000a0;3</xref>A). For each sample, we profiled cells using 10x Chromium 3&#x02032; (using 228 TotalSeq A antibodies), representing a total of 161,764 cells (average of 8,003 unique RNA molecules/cell, 5,251 unique ADT/cell). We also profiled a total of 49,147 cells (54 antibodies) split across all samples using ECCITE-seq (<xref rid=\"bib55\" ref-type=\"bibr\">Mimitou et&#x000a0;al., 2019</xref>), which also enables immune repertoire profiling with the 10x 5&#x02032; technology. After NovaSeq sequencing, stringent quality control, and doublet filtration (<xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>), our final dataset consists of 210,911 total cells and allows us to profile cellular heterogeneity in both the resting (unvaccinated) and activated (post-vaccination) immune system.<fig id=\"fig3\"><label>Figure&#x000a0;3</label><caption><p>A multimodal atlas of human PBMC</p><p>(A) Experimental design schematic of the CITE-seq experiment. PBMC samples originate from eight volunteers pre (day 0) and post-vaccination (day 3 and day 7). We processed each sample with CITE-seq using the 10x 3&#x02032; (228 antibodies) and 10x 5&#x02032; (54 antibodies&#x000a0;+ BCR&#x000a0;+ TCR) technologies, yielding a total of 210,911 cells.</p><p>(B&#x02013;D) UMAP visualization of 161,764 cells 10x 3&#x02032; cells analyzed based on RNA data (B), protein data (C), or WNN analysis (D). Cell types were identified using unsupervised clustering of the WNN graph and grouped into three annotation tiers, ranging from eight broad categories, to 57 high-resolution clusters. UMAP visualization of 49,147 10x 5&#x02032; cells, mapped onto the 3&#x02032; reference data, is shown in <xref rid=\"figs5\" ref-type=\"fig\">Figure&#x000a0;S5</xref>.</p><p>See also <xref rid=\"mmc1\" ref-type=\"supplementary-material\">Table S1</xref>.</p></caption><graphic xlink:href=\"gr3\"/></fig></p><p id=\"p0130\">We applied our &#x0201c;anchor-based&#x0201d; workflow (<xref rid=\"bib73\" ref-type=\"bibr\">Stuart et&#x000a0;al., 2019</xref>) to first integrate the samples together, enabling cells to cluster together based on their shared biological state, as opposed to sample-of-origin (<xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>). Although this causes unvaccinated and vaccinated samples to cluster together initially, it enables us to annotate cell states consistently in all samples, and to learn cell-type-specific responses in downstream analyses. We then performed joint analysis of both modalities using WNN integration, and as a comparative control, visualized the dataset using the RNA and protein modalities independently (<xref rid=\"fig3\" ref-type=\"fig\">Figures 3</xref>B&#x02013;3D).</p><p id=\"p0135\">We identified 57 clusters in WNN analysis, encapsulating all major and minor immune cell types and revealing striking cellular diversity particularly within lymphoid lineages. With rare exceptions for infrequent cell types, each cluster included cells from all 24 samples. Our clusters could be readily grouped into larger categories, including CD4<sup>+</sup> T&#x000a0;cells (12 clusters), CD8<sup>+</sup> T&#x000a0;cells (12 clusters), unconventional T&#x000a0;cells (7 clusters), NK cells (6 clusters), B cells, plasma cells, and plasmablasts (8 clusters), dendritic cells and monocytes (8 clusters), and rare clusters of hematopoietic progenitors, platelets, erythrocytes, and circulating innate lymphoid cells (ILC). To assist in the interpretation of our clusters, we assign each cell three annotations with increasing granularity (level 1, 8 categories; level 2, 30 categories; level 3, 57 categories). Although we saw the greatest level of heterogeneity within T&#x000a0;cell subsets, our analysis clearly identified heterogeneous subsets of myeloid cells that were fully concordant with recent high-resolution scRNA-seq analyses of sorted populations, including extremely rare populations (0.02%) of dendritic cells defined by the expression of <italic>AXL</italic> and <italic>SIGLEC6</italic> (<xref rid=\"bib67\" ref-type=\"bibr\">See et&#x000a0;al., 2017</xref>; <xref rid=\"bib82\" ref-type=\"bibr\">Villani et&#x000a0;al., 2017</xref>) (ASDC; <xref rid=\"figs4\" ref-type=\"fig\">Figure&#x000a0;S4</xref>). We also identified substantial heterogeneity in the expression of inflammatory genes such as <italic>IL1B</italic> and <italic>CCL3</italic> within monocyte populations, but because this heterogeneity varied across different volunteers, we conservatively did not further subdivide these states (<xref rid=\"figs4\" ref-type=\"fig\">Figure&#x000a0;S4</xref>).<fig id=\"figs4\"><label>Figure&#x000a0;S4</label><caption><p>Identifying targeted gene expression markers and immunophenotype panels, related to <xref rid=\"fig4\" ref-type=\"fig\">Figure&#x000a0;4</xref></p><p>(A) RNA expression of two canonical markers of AXL+ SIGLEC6+ dendritic cells (ASDC). Both markers were specifically enriched in the ASDC cells compared to other DC subsets. (B-C) For each of the 57 clusters, we computed targeted immunophenotype panels using forward selection coupled with logistic regression. In <xref rid=\"fig4\" ref-type=\"fig\">Figure&#x000a0;4</xref>C we visualize the level of enrichment for each cluster based on panels of one to ten markers. Here, we show precision and recall metrics based on logistic regression, using a decision boundary of 0.5. These data demonstrate that while we can achieve substantial enrichment with small panels, isolating pure and homogeneous populations based on small marker panels remains challenging for some clusters. (D-E) Additional heterogeneity in the expression of inflammatory genes in monocyte populations. Only CD14+ and CD16+ monocytes are shown. Heterogeneous expression of these genes is exhibited in multiple, but not all, volunteers. This heterogeneity was not related to the vaccination time course, as shown in (E). (F) Heatmap of unconventional T&#x000a0;cells states. Features include the best RNA and protein features identified by differential expression. Heatmap displays pseudobulk averages where cells are grouped by cell type, human volunteer, and vaccination time point and demonstrates that markers are repeatedly identified across samples. Heatmaps for CD4+ T&#x000a0;cell and CD8+ T&#x000a0;cell states are shown in <xref rid=\"fig4\" ref-type=\"fig\">Figures 4</xref>A and 4B. (G) Same as in (F) but for myeloid cell states. (H) Same as in (F) but for B cell states. B cell states are subdivided by their mutually exclusive expression of kappa or lambda light chain, with distinguishing markers including IGKC, IGLC3, IGLC3. (I) Same as in (F) but for other cells states. (J) Same as in (F) but for NK cells states.</p></caption><graphic xlink:href=\"figs4\"/></fig></p><p id=\"p0140\">We next identified differentially expressed RNA and immunophenotype markers for each cluster. We found that each cluster exhibited distinct molecular patterns and biomarkers for both modalities (<xref rid=\"fig4\" ref-type=\"fig\">Figure&#x000a0;4</xref>A; additional heatmaps in <xref rid=\"figs4\" ref-type=\"fig\">Figure&#x000a0;S4</xref>). Moreover, these identified biomarkers were invariant across human volunteers and vaccination time points. Despite the fact that clusters were enriched for both RNA and protein markers, our ability to identify these groups was substantially reduced without WNN analysis, as multiple clusters blended together when performing separate analysis of either RNA or protein data (<xref rid=\"fig3\" ref-type=\"fig\">Figures 3</xref>B and 3C). We conclude that multimodal integration is essential for the unsupervised discovery and annotation of immune cell states; however, once these states are enumerated, supervised differential analyses are capable of sensitively describing markers that define their molecular state.<fig id=\"fig4\"><label>Figure&#x000a0;4</label><caption><p>Multimodal biomarkers of immune cell states</p><p>(A) Heatmap of CD4<sup>+</sup> T&#x000a0;cell states. Markers include the best RNA and protein features identified by differential expression (DE). Heatmap displays pseudobulk averages where cells are grouped by cell type, donor, and vaccination time point and demonstrates that markers do not vary across different PBMC samples.</p><p>(B) Same as in (A) but for CD8<sup>+</sup> T&#x000a0;cell states. Additional heatmaps are shown in <xref rid=\"figs4\" ref-type=\"fig\">Figure&#x000a0;S4</xref>.</p><p>(C) For each of our 57 clusters, we calculated the optimal surface marker enrichment panels based on our CITE-seq data. Bar plots show the ability of the panels to enrich for each cell type <italic>in silico</italic>. The composition of each panel is shown in <xref rid=\"mmc2\" ref-type=\"supplementary-material\">Table S2</xref>.</p><p>(D) Validation of predicted marker panels for the CD8_TEM_5 cluster. We sorted cells based on the marker panels identified in (C), and performed bulk RNA-seq. Each column represents a replicate bulk RNA-seq profile. Heatmap is ordered by genes expected to be DE based on our CITE-seq dataset and are validated by bulk RNA-seq.</p><p>(E) Same as in (D) but for CD4 CTL cells.</p></caption><graphic xlink:href=\"gr4\"/></fig></p><p id=\"p0145\">Due to the robust detection of protein features in CITE-seq combined with the size of our antibody panel, we reasoned that we could discover small panels of immunophenotypic markers to perform targeted enrichment through flow cytometry. We used stepwise variable selection coupled with logistic regression (<xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>) to identify the best antibody marker panels of different sizes (1&#x02013;10 markers) for each subset, and calculated the level of enrichment <italic>in silico</italic> (<xref rid=\"fig4\" ref-type=\"fig\">Figure&#x000a0;4</xref>C). We found that a single marker was capable of achieving effective enrichment of at least 10-fold for 45 clusters, whereas a panel with three markers was sufficient to achieve 10-fold enrichment for 55 clusters.</p><p id=\"p0150\">We confirmed that this marker discovery procedure identifies effective panels for well-characterized populations (plasmacytoid DC [pDC]: CD123<sup>+</sup>; MAIT cells: CD3<sup>+</sup> CD161<sup>+</sup> TCRv&#x00251;7.2<sup>+</sup>; CD4 naive: CD4<sup>+</sup> CD45RA<sup>+</sup> CD45RB<sup>+</sup>). In other instances (e.g., cytotoxic populations of CD4<sup>+</sup> lymphocytes), our analysis identified CD43 as a marker with high enrichment power that has not been previously reported. For this population, as well as a subgroup of highly cytotoxic CD8<sup>+</sup> T&#x000a0;cells (CD8_TEM_5), we successfully validated our enrichment panels in an independent set of PBMCs from healthy donors by conventional flow cytometry followed by bulk RNA-seq (<xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>). In both cases, we examined the expression level of genes that we expected to be DE-based on our CITE-seq data, and we observed clear agreement between the sorted bulk profiles and CITE-seq clusters (<xref rid=\"fig4\" ref-type=\"fig\">Figures 4</xref>D and 4E). Notably, our flow cytometry experiments utilized the exact antibody clones represented in the CITE-seq experiment, which can help to ensure that the two assays will return concordant results. We report each of these panels in <xref rid=\"mmc2\" ref-type=\"supplementary-material\">Table S2</xref> to facilitate similar experiments for additional clusters in our dataset. We note that although these panels can achieve high levels of enrichment, even optimally sorted groups may contain a minority of contaminating cells from other states. We show precision and recall metrics for each panel in <xref rid=\"figs4\" ref-type=\"fig\">Figure&#x000a0;S4</xref>, demonstrating that it remains challenging to sort truly &#x0201c;homogeneous&#x0201d; populations of high-resolution subsets using a small number of markers.</p></sec><sec id=\"sec2.4\"><title>Multimodal heterogeneity within lymphoid populations</title><p id=\"p0155\">Our integrated WNN analysis reveals a rich diversity of T&#x000a0;cell states that is not typically captured in scRNA-seq analyses, including CD4<sup>+</sup> regulatory T&#x000a0;cells, MAIT cells, multiple subpopulations of &#x003b3;&#x003b4; and double-negative T&#x000a0;cells, along with heterogeneous subpopulations of naive, memory, and effector states. Within CD8<sup>+</sup> memory T&#x000a0;cells, we identified distinct subpopulations defined by bimodal and mutually exclusive expression of the integrin proteins CD49a and CD103 (<xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>A). Although we identified these cells in peripheral blood, expression of these&#x000a0;proteins has traditionally been strongly associated with tissue-resident memory (TRM) cells, where integrins help mediate adhesion to epithelial cells or the extracellular matrix (<xref rid=\"bib16\" ref-type=\"bibr\">Corgnac et&#x000a0;al., 2018</xref>; <xref rid=\"bib78\" ref-type=\"bibr\">Topham and Reilly, 2018</xref>). CD8<sup>+</sup> CD103<sup>+</sup> T&#x000a0;cells expressed high surface protein levels of the heterodimeric co-binding partner integrin beta-7 (<xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>B), while expression was absent in CD8<sup>+</sup> CD49a<sup>+</sup> groups. We validated the presence of the populations in independent healthy PBMC samples by performing flow cytometry for the same markers (<xref rid=\"fig5\" ref-type=\"fig\">Figures 5</xref>C and 5D). In addition, we identified modules of differentially expressed genes between these two groups (<xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>E), which were enriched for T&#x000a0;cell activation, differentiation, signaling response, and chemotaxis modules (<xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>F). Both populations did not express the canonical resident marker CD69 (<xref rid=\"bib76\" ref-type=\"bibr\">Szabo et&#x000a0;al., 2019</xref>; <xref rid=\"bib83\" ref-type=\"bibr\">Walsh et&#x000a0;al., 2019</xref>) (<xref rid=\"figs5\" ref-type=\"fig\">Figure&#x000a0;S5</xref>), suggesting that they are not TRMs that have temporarily detached and re-entered circulation. Instead, these subpopulations may represent cells that are preparing to become tissue-resident and have already begun to acquire distinguishing molecular characteristics.<fig id=\"fig5\"><label>Figure&#x000a0;5</label><caption><p>Characterizing heterogeneity within lymphoid populations</p><p>(A) Mutually exclusive expression of the integrin proteins CD103 and CD49a within CD8<sup>+</sup> T memory cells, as measured by CITE-seq.</p><p>(B) Differential expression of integrin-7 between CD103<sup>+</sup> CD49a<sup>&#x02212;</sup> and CD103<sup>+</sup> CD49<sup>+</sup> populations as measured by CITE-seq.</p><p>(C and D) Flow cytometry validates the presence of these populations. Plots are the same as in (A) and (B) but generated via flow cytometry.</p><p>(E and F) Differentially expressed genes, and enriched gene ontology terms, between CD103<sup>+</sup> CD49a<sup>&#x02212;</sup> and CD103<sup>&#x02212;</sup> CD49<sup>+</sup> populations.</p><p>(G) Dot plot showing the representation of the fifteen most abundant T&#x000a0;cell clonotypes in the dataset. For space, only the VDJ regions are shown on the y axis, but all cells in a clone share identical CDR3 sequences. Clones reside in a restricted set of cytotoxic and effector cell states and are shared across vaccination time points. Size of each dot represents the number of cells in the clonotype. Clones present in donors who were classified as CMV-positive are colored in red.</p><p>(H) Cells within a clone exhibit similar molecular profiles. Grey dots represent T&#x000a0;cells where TCR sequence was measured using the 10x 5&#x02032; assay. Cells from the eight most highly represented clonotypes are highlighted as colored dots.</p><p>(I&#x02013;K) Heterogeneity in NK cells is defined by two gradients correlating with CD16 and CD38 protein expression. (I) NK cells are ordered by their quantitative expression of CD16 protein expression. Rolling averages for the expression of genes that correlate positively or negatively with CD16 are shown as smoothed lines. (J) same as (I) but for CD38. (K) CD38 and CD16 protein expression define two separate gradients and are uncorrelated in NK cells.</p><p>See also <xref rid=\"figs5\" ref-type=\"fig\">Figure&#x000a0;S5</xref> and <xref rid=\"mmc3\" ref-type=\"supplementary-material\">Table S3</xref>.</p></caption><graphic xlink:href=\"gr5\"/></fig><fig id=\"figs5\"><label>Figure&#x000a0;S5</label><caption><p>Additional heterogeneity within lymphoid populations, related to <xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref></p><p>(A) Protein expression of canonical resident lymphocyte marker CD69 in CD8+ CD103+, CD8+ CD49a+ T&#x000a0;cell populations. Neither population is positive. Platelets are included as a positive control, as CD69 is constitutively expressed on these cells. (B) Naive, intermediate and memory B cells are ordered by their quantitative level of CD27 protein expression. Rolling averages for the expression of genes that correlate positively or negatively with CD27 are shown as smoothed lines. (C-E) Same as <xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>J, but after splitting the eight volunteers into five CMV+ (C) and three CMV- (D) samples (<xref rid=\"mmc3\" ref-type=\"supplementary-material\">Table S3</xref>). We observe concordant trends in both subsets, as well as an independent CITE-seq dataset (<xref rid=\"bib41\" ref-type=\"bibr\">Kotliarov et&#x000a0;al., 2020</xref>). (F) UMAP visualization of CITE-seq dataset of 49,147 PBMC analyzed with the 10X 5&#x02032; Immune Profiling kit, which also measures immune repertoires. The dataset has been mapped onto the 3&#x02032;-defined multimodal reference, allowing cells to be visualized in the same UMAP space as the reference, and cells are labeled based on transferred Level 2 annotations. (G) Dot plot showing the overrepresentation of TCR&#x003b1; sequences within cells annotated as MAIT. As expected, we detect the canonical MAIT TRAV1-2-TRAJ33 as the most abundant sequence along with reduced usage of TRAJ12 and TRAJ20. We also detect rare populations of invariant NKT cells (defined by the use of TRAV10.TRAJ18). As expected, and in contrast to the clonotypes reported in <xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>G, these findings are consistent across volunteers, vaccination time points, and CMV status.</p></caption><graphic xlink:href=\"figs5\"/></fig></p><p id=\"p0160\">In addition to characterizing heterogeneity in mRNA and protein expression, we leveraged our 5&#x02032; dataset to explore the relationship between molecular state and TCR sequence (<xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>). Overall clonal diversity was consistent across vaccination time points, consistent with an expected lack of a lymphoid response to vaccination within 7&#x000a0;days, and 97% of clones consisted only of a single cell. However, we also observed the presence of expanded clonal populations. As a positive control, we observed populations with highly restricted usage of TCR&#x003b1; sequences: both MAIT and invariant NKT cells exhibited closely related transcriptional profiles (<xref rid=\"bib35\" ref-type=\"bibr\">Huang et&#x000a0;al., 2019</xref>) and semi-invariant repertoires across multiple volunteers (<xref rid=\"figs5\" ref-type=\"fig\">Figure&#x000a0;S5</xref>).</p><p id=\"p0165\">Excluding these populations, we identified 31 additional expanded clones consisting of at least 10 cells (<xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>G). In each case, cells within a clonal population exhibited extremely similar molecular profiles (<xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>H), representing subgroups of CD8<sup>+</sup> T&#x000a0;cells (primarily within our previously identified CD8_TEM_4 and CD 8_TEM_5 clusters), as well as cytotoxic CD4<sup>+</sup> T&#x000a0;cells (CD4 CTL). Each clone typically represented cells from a single volunteer, but could be independently found across multiple time points, including before vaccination (<xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>G). Because our sample volunteers were generally middle-aged and otherwise healthy, we considered the possibility that overexpanded clones could be related to cytomegalovirus (CMV) infection (<xref rid=\"bib38\" ref-type=\"bibr\">Kim et&#x000a0;al., 2015</xref>). We assessed the CMV status of each volunteer by stimulating PBMCs with a CMV peptide pool and performing intracellular cytokine staining to determine responses in CD8<sup>+</sup> T&#x000a0;cells (<xref rid=\"mmc3\" ref-type=\"supplementary-material\">Table S3</xref>; <xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>), identifying five positive and three negative volunteers. We found that the five positive samples accounted for 91% of cells within expanded clones.</p><p id=\"p0170\">We note that although WNN integration improves the ability to discover distinct cell subpopulations, it can also improve the characterization of cellular trajectories and continuous sources of heterogeneity. For example, within B cells, we identified a continuous trajectory connecting naive to memory cells defined by the canonical protein markers immunoglobulin D (IgD) and CD27, along with a module of correlated genes (<xref rid=\"figs5\" ref-type=\"fig\">Figure&#x000a0;S5</xref>). Similarly, NK cells were subdivided into five clusters, representing variation across a continuous landscape. Our data show that the traditional division of NK cells into CD56-bright and CD56-dim categories represents a broader continuum defined by CD16 expression, alongside a module of genes that modulate cytotoxicity and correlate both positively and negatively with this marker (<xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>I).</p><p id=\"p0175\">We also observed a second gradient defined by CD38 expression that, to our knowledge, has not been previously described. Notably, <italic>KLRC2</italic>, which encodes the NK activating receptor NKG2C was negatively associated with this continuum, while the signaling adaptor <italic>FCER1G</italic> was positively associated (<xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>J). This expression pattern is consistent with the development of &#x0201c;adaptive&#x0201d; or &#x0201c;memory-like&#x0201d; NK cells observed in CMV seropositive individuals (<xref rid=\"bib42\" ref-type=\"bibr\">Lee et&#x000a0;al., 2015</xref>; <xref rid=\"bib66\" ref-type=\"bibr\">Schlums et&#x000a0;al., 2015</xref>). Notably, we observed consistent trends when restricting our analysis only to individuals with either positive or negative CMV T&#x000a0;cell responses (<xref rid=\"figs5\" ref-type=\"fig\">Figure&#x000a0;S5</xref>). We also observed consistent results (<xref rid=\"figs5\" ref-type=\"fig\">Figure&#x000a0;S5</xref>) in an independent CITE-seq dataset of human PBMCs (<xref rid=\"bib41\" ref-type=\"bibr\">Kotliarov et&#x000a0;al., 2020</xref>). Our results indicate that this phenotype does not represent a strictly binary phenomenon and may not be specific to CMV response. Finally, we observed minimal correlation between CD38 and CD16 expression (<xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>K), demonstrating that NK cells fall along a two-dimensional gradient defined by these markers.</p><p id=\"p0180\">Taken together, these results demonstrate that our dataset represents a powerful resource to enumerate cell states in the immune system, identify optimal reagents for cell-type-specific enrichment, and to understand the molecular heterogeneity in clonally related or antigen-specific cell groups. Because these results are consistent in both pre- and post-vaccination time points, they likely describe general characteristics of the healthy immune system.</p></sec><sec id=\"sec2.5\"><title>Characterizing the initial innate response to vaccination</title><p id=\"p0185\">We next explored our dataset to characterize the response to vaccination for each of our previously identified cell types. We were particularly interested to identify cell populations that contribute most strongly to the innate immune response, which is expected to be highly activated at our first vaccinated time point (day 3), and subsequently dampen in our second time point (day 7) as seen with another non-replicating viral vectored HIV vaccine (<xref rid=\"bib89\" ref-type=\"bibr\">Zak et&#x000a0;al., 2012</xref>). As expected, we observed robust responses in a subset of myeloid subpopulations, but only minimal responses in lymphoid groups (<xref rid=\"fig6\" ref-type=\"fig\">Figures 6</xref>A and 6B). Response patterns were also largely consistent across samples with the exception of one volunteer that exhibited a highly activated immune system in advance of vaccination and was removed from further analysis (<xref rid=\"figs6\" ref-type=\"fig\">Figure&#x000a0;S6</xref>).<fig id=\"fig6\"><label>Figure&#x000a0;6</label><caption><p>Identifying cell-type-specific responses to vaccination</p><p>(A) For each of our level 2 annotated cell clusters, we calculated the number of differentially expressed genes between unvaccinated (day 0) and day 3 samples (size of each dot). As each per-gene test is highly sensitive to the number of cells, we also calculated a &#x0201c;perturbation score,&#x0201d; which reflects the strength of the molecular response based on the whole transcriptome (color of each dot).</p><p>(B) Density plot, produced by the Nebulosa package, showing the expression of canonical interferon response gene IFI27.</p><p>(C and D) Violin plot showing the protein upregulation of Siglec-1 (CD169) in single cells from day 3 samples (C), along with a signature of interferon response (D), in select cell types. In (A)&#x02013;(D) we consistently observe robust responses only in CD14<sup>+</sup> monocytes, CD16<sup>+</sup> monocytes, and cDC2 DC.</p><p>(E) Bar plot showing that the frequency of broad groups (level 1 annotations) is stable across the vaccination time course.</p><p>(F) Within these broad categories, the relative abundance of classical monocytes, nonclassical monocytes, and proliferating NK cells across the vaccination time course. p values are computed using a paired Wilcoxon test.</p><p>(G) Relative abundance of monocyte populations as measured by flow cytometry.</p><p>See also <xref rid=\"figs6\" ref-type=\"fig\">Figure&#x000a0;S6</xref>.</p></caption><graphic xlink:href=\"gr6\"/></fig><fig id=\"figs6\"><label>Figure&#x000a0;S6</label><caption><p>Cell-type-specific responses to vaccination, related to <xref rid=\"fig6\" ref-type=\"fig\">Figure&#x000a0;6</xref></p><p>(A, B) Violin plot showing the upregulation of CD169 protein levels and a module of interferon response genes at day 3. Plot is similar to <xref rid=\"fig6\" ref-type=\"fig\">Figures 6</xref>C and 6D, but restricted to CD14 Monocytes, and shows the individual response of each volunteer. The response is consistent across all volunteers with one exception (P6), which exhibited signs of a highly activated immune system even prior to vaccination. (C) RNA expression of canonical interferon response gene IFI27 across the vaccination time course. The expression of IFI27 increases within particular myeloid populations at day 3, but dampens at day 7. (D) Pathway enrichment (enrichR) of the top DE genes between day 0 and day 3 myeloid cells exhibits a clear enrichment for components of the interferon response. (E) Same as in <xref rid=\"fig6\" ref-type=\"fig\">Figure&#x000a0;6</xref>F, but computed for cells profiled with the 10X 5&#x02032; kit.</p></caption><graphic xlink:href=\"figs6\"/></fig></p><p id=\"p0190\">We observed the strongest changes in both CD14<sup>+</sup> classical and CD16<sup>+</sup> non-classical monocytes, as both cell types upregulated a shared module of 62 genes highly enriched for transcripts responsive to type I interferon (<xref rid=\"fig6\" ref-type=\"fig\">Figures 6</xref>A, 6B, and <xref rid=\"figs6\" ref-type=\"fig\">S6</xref>; visualization in <xref rid=\"fig6\" ref-type=\"fig\">Figure&#x000a0;6</xref>B from <xref rid=\"bib2\" ref-type=\"bibr\">Alquicira-Hernandez and Powell [2020</xref>]). In addition, we identified Siglec-1 (CD169) as a protein response biomarker that was robustly induced only in day 3 samples (<xref rid=\"fig6\" ref-type=\"fig\">Figure&#x000a0;6</xref>C). When we examined dendritic cell populations, we observed a similarly robust response only within CD1C<sup>+</sup> cDC2 cells. Contrastingly, closely related populations of CD141<sup>+</sup> cDC1, as well as ASDC and pDC, exhibited minimal responses, and we did not detect any DE genes before and after vaccination for these groups (<xref rid=\"fig6\" ref-type=\"fig\">Figure&#x000a0;6</xref>A). This indicates that within DC subgroups, cDC2s may perform an important role in the downstream priming and activation of the adaptive immune system during this vaccine response.</p><p id=\"p0195\">We did not observe significant changes during the time course in overall abundance of broad immune classes (<xref rid=\"fig6\" ref-type=\"fig\">Figure&#x000a0;6</xref>E;); thus, we focused on identifying more subtle compositional changes. For example, although the overall proportion of monocytes was consistent across time points, there was a strong shift in the ratio between classical and non-classical populations between day 0 and day 3 (<xref rid=\"fig6\" ref-type=\"fig\">Figure&#x000a0;6</xref>F). We validated this result, as well as the observed return to baseline ratios at day 7, using flow cytometry on the same samples (<xref rid=\"fig6\" ref-type=\"fig\">Figure&#x000a0;6</xref>G). We did not observe changes within lymphoid cells with one exception: a small population of NK cells expressing proliferation and cell-cycle genes (NK_proliferation), consistently increased upon vaccination (<xref rid=\"fig6\" ref-type=\"fig\">Figure&#x000a0;6</xref>F). These findings were reproducible in independent analyses of the 3&#x02032; and 5&#x02032; scRNA-seq experiments and persisted in both day 3 and day 7 samples (<xref rid=\"fig6\" ref-type=\"fig\">Figures 6</xref>F and <xref rid=\"figs6\" ref-type=\"fig\">S6</xref>). This finding may reflect an early step in the development and maturation of NK cells, a key component of the NK cell-mediated innate immune response (<xref rid=\"bib1\" ref-type=\"bibr\">Abel et&#x000a0;al., 2018</xref>).</p></sec><sec id=\"sec2.6\"><title>Mapping query datasets to multimodal references</title><p id=\"p0200\">Single-cell transcriptomic profiling of the immune system has become routine, not only for healthy subjects, but also in multiple clinical contexts including for patients hospitalized with COVID-19. These datasets are typically processed using a workflow that consists of unsupervised clustering, which assumes minimal prior knowledge and is ideally suited for cell type discovery. However, having constructed a multimodal reference of the immune system, we sought to leverage this dataset to assist in the analysis and interpretation of additional single-cell experiments profiling human PBMCs (queries), even if only the transcriptome was profiled.</p><p id=\"p0205\">We first apply a procedure known as &#x0201c;supervised principal component analysis&#x0201d; (sPCA) (<xref rid=\"bib6\" ref-type=\"bibr\">Barshan et&#x000a0;al., 2011</xref>) to the transcriptome measurements in our reference dataset. Instead of seeking to identify a low-dimensional projection that maximizes total variance as in PCA, sPCA identifies a projection of the transcriptome dataset that maximally captures the structure defined in the WNN graph. Formally, given a gene expression matrix X and a WNN graph Y, sPCA identifies the transformation matrix U that maximizes the Hilbert-Schmidt Independence Criterion measure between a linear kernel of U<sup>T</sup>X and Y (<xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>). Informally, sPCA allows the weighted transcriptome and protein measurements to help &#x0201c;supervise&#x0201d; the analysis of gene expression data and identify the optimal transcriptomic vectors (gene modules) that define the cell states in our multimodal reference.</p><p id=\"p0210\">We compute this sPCA transformation on our reference (where both mRNA and protein were measured simultaneously), but can subsequently rapidly project this transformation onto any scRNA-seq query dataset. Combining this transformation with our previously described &#x0201c;anchor&#x0201d;-based framework (<xref rid=\"bib73\" ref-type=\"bibr\">Stuart et&#x000a0;al., 2019</xref>) allows us to place each scRNA-seq query cell on the previously defined reference UMAP visualization (<xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>) and annotate its identity based on reference clusters.</p><p id=\"p0215\">We found that this supervised mapping procedure dramatically improved our ability to analyze and interpret query scRNA-seq datasets compared to unsupervised analysis. We examined a recently generated dataset of human PBMCs prior to flu vaccination, which measured the transcriptomes of 53,099 cells alongside 82 surface proteins. We mapped this dataset onto our reference using only the transcriptome data and transferred our level 2 annotations, revealing the presence of multiple high-resolution lymphoid subsets (<xref rid=\"figs7\" ref-type=\"fig\">Figure&#x000a0;S7</xref>). We verified the accuracy of our predictions using the query protein data, which was held out of the reference mapping procedure, yet revealed expression patterns based on our predicted annotations that were fully concordant with our reference dataset. For example, cells that were annotated as regulatory T&#x000a0;cells expressed CD25 in the CITE-seq data, and we observed similar results for MAIT cells (CD161<sup>+</sup>), memory (CD45RA<sup>&#x02212;</sup> CD45RO<sup>+</sup>) and naive (CD45RA<sup>+</sup> CD45RO<sup>&#x02212;</sup>) T&#x000a0;cells, and circulating ILC (CD117<sup>+</sup> CD25<sup>+</sup>) (<xref rid=\"figs7\" ref-type=\"fig\">Figure&#x000a0;S7</xref>). We benchmarked our method against scArches, a recently developed method for mapping scRNA-seq queries to reference datasets (<xref rid=\"bib45\" ref-type=\"bibr\">Lotfollahi et&#x000a0;al., 2020</xref>) and observed that our approach yielded substantial improvements in accuracy and performance (<xref rid=\"fig7\" ref-type=\"fig\">Figures 7</xref>A, 7B, and <xref rid=\"figs7\" ref-type=\"fig\">S7</xref>).<fig id=\"figs7\"><label>Figure&#x000a0;S7</label><caption><p>Reference-based mapping of query datasets, related to <xref rid=\"fig7\" ref-type=\"fig\">Figure&#x000a0;7</xref></p><p>(A-E) Benchmarking of Seurat v4 reference-based mapping with scArches. Both methods utilize reference datasets to assist in the interpretation of query data. (A-B) UMAP visualizations of reference-based mapping of a human PBMC CITE-seq dataset from <xref rid=\"bib41\" ref-type=\"bibr\">Kotliarov et&#x000a0;al. (2020)</xref>. Cells are label by the annotation that was transferred using each method. The protein data was withheld from mapping and can be used to assess accuracy. (C) For five cell types where we observed a high rate of discordant predictions between Seurat and scArches, we visualize the protein expression of key markers in the reference dataset (left), Seurat-transferred annotations (middle), and scArches-transferred annotations (right). In each case, the Seurat annotations provide the most concordant results. For example, cells annotated by Seurat as Treg express CD25 protein, while cells annotated by scArches as Treg do not. (D) For all 17,480 (32.9%) of query cells where Seurat and scArches returned different annotations based on the transcriptome, we calculated protein-based classification metrics to determine the support for each result (<xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>). In 73.8% of cases, we observe stronger support for the Seurat annotation. (E) Computing time for reference-mapping of <xref rid=\"bib41\" ref-type=\"bibr\">Kotliarov et&#x000a0;al. (2020)</xref> onto the multimodal reference. (F) The abundance of plamablasts increases during COVID-19 response. p value is computed using an unpaired Wilcoxon test. Annotations were derived from reference-based mapping, and confirm the result reported in <xref rid=\"bib86\" ref-type=\"bibr\">Wilk et&#x000a0;al. (2020)</xref>. (G) &#x02018;<italic>de novo</italic>&#x02019; UMAP (<xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>) visualization of the dataset from <xref rid=\"bib86\" ref-type=\"bibr\">Wilk et&#x000a0;al. (2020)</xref> after reference-mapping. Concordant cell types are identified between query and reference data with three exceptions, denoted with dashed rectangles. (H) Same as in (G), but cells are colored by their unsupervised label as described in <xref rid=\"bib86\" ref-type=\"bibr\">Wilk et&#x000a0;al. (2020)</xref>. These results demonstrate that developing and differentiated neutrophils, which are not present in the reference, remain distinct after reference-based mapping. Additionally, a population of CD14+ Monocytes that has severe transcriptional responses to COVID-19 is also highlighted in this analysis. (I) Gating strategy used to identify MAIT cells in mass cytometry experiments.</p></caption><graphic xlink:href=\"figs7\"/></fig><fig id=\"fig7\"><label>Figure&#x000a0;7</label><caption><p>Supervised mapping of immune perturbations</p><p>(A) Violin plots showing the expression patterns for nine proteins in our CITE-seq dataset. Cells are grouped by their WNN-defined T&#x000a0;cell level 2 annotations.</p><p>(B) Violin plots for the same proteins in an independent CITE-seq dataset of human PBMC (<xref rid=\"bib41\" ref-type=\"bibr\">Kotliarov et&#x000a0;al., 2020</xref>). Cells are grouped based on their predicted annotations from transcriptome-based reference mapping. The protein data were withheld from the mapping but displays the same patterns as in (A).</p><p>(C) UMAP visualization of <xref rid=\"bib86\" ref-type=\"bibr\">Wilk et&#x000a0;al. (2020)</xref> scRNA-seq dataset, which includes 44,721 PBMC from patients hospitalized with COVID-19 and healthy controls. UMAP was computed using unsupervised analysis.</p><p>(D) Same as in (C), but after the dataset has been mapped onto our multimodal reference. Cells are colored by their predicted level-2 annotations.</p><p>(E) Quantification of MAIT cell abundance based on scRNA-seq reference mapping (y axis) and CyTOF (x axis) for the samples in <xref rid=\"bib86\" ref-type=\"bibr\">Wilk et&#x000a0;al. (2020)</xref>. The Pearson correlation between these two methods is 0.911.</p><p>(F) CyTOF quantification of MAIT cell abundance in PBMC samples from COVID-19 patients and healthy controls. p values are computed using an unpaired Wilcoxon test.</p><p>See also <xref rid=\"figs7\" ref-type=\"fig\">Figure&#x000a0;S7</xref>.</p></caption><graphic xlink:href=\"gr7\"/></fig></p><p id=\"p0220\">We next applied our mapping approach to a recent scRNA-seq study analyzing PBMC samples from seven patients hospitalized with COVID-19, alongside six healthy controls (<xref rid=\"bib86\" ref-type=\"bibr\">Wilk et&#x000a0;al., 2020</xref>). The original publication performed unsupervised clustering on the full dataset and identified six T&#x000a0;cell clusters (three CD4<sup>+</sup> T, two CD8<sup>+</sup> T, and &#x003b3;&#x003b4; T&#x000a0;cells). In our supervised analysis, we transferred our level 2 annotations, successfully dividing T&#x000a0;cells into the 12 groups (<xref rid=\"fig7\" ref-type=\"fig\">Figure&#x000a0;7</xref>C, D). Notably, populations of developing and differentiated neutrophils, which were identified by the original manuscript as being uniquely present in COVID-19 samples but were absent from our reference, could not be successfully mapped (<xref rid=\"figs7\" ref-type=\"fig\">Figure&#x000a0;S7</xref>).</p><p id=\"p0225\">We leveraged our supervised annotations to test for differences in cell type abundance across disease conditions. Our findings recapitulated the original unsupervised analysis, for example, highlighting increases in plasmablast frequency during COVID-19 response (<xref rid=\"figs7\" ref-type=\"fig\">Figure&#x000a0;S7</xref>). However, we also observed proportional shifts in cell states that were not detected in unsupervised clustering but were successfully annotated after reference mapping. In particular, we observed a depletion of MAIT cells in COVID-19 samples compared to healthy controls. To validate our findings, we performed CyTOF on both the original samples and a validation cohort of 16 additional samples. We observed strong quantitative agreement (R&#x000a0;= 0.911) in the fraction of MAIT cells predicted by scRNA-seq and measured by CyTOF in the original cohort (<xref rid=\"fig7\" ref-type=\"fig\">Figure&#x000a0;7</xref>E). Moreover, CyTOF analysis of the larger sample set identified a depletion of MAIT cells in COVID-19 samples (<xref rid=\"fig7\" ref-type=\"fig\">Figures 7</xref>F and <xref rid=\"figs7\" ref-type=\"fig\">S7</xref>). This change in abundance may reflect these cells exiting circulation to play protective roles in barrier tissues during the antiviral immune response (<xref rid=\"bib28\" ref-type=\"bibr\">Grimaldi et&#x000a0;al., 2014</xref>; <xref rid=\"bib34\" ref-type=\"bibr\">Hinks and Zhang, 2020</xref>; <xref rid=\"bib63\" ref-type=\"bibr\">Provine and Klenerman, 2020</xref>).</p></sec></sec><sec id=\"sec3\"><title>Discussion</title><p id=\"p0230\">In order to leverage multiple data types to define cellular identity, we developed WNN analysis, a computational method that learns the information content of each modality and generates an integrated representation of multimodal data. By calculating cell-specific modality weights, WNN analysis solves an important technical challenge for the analysis of multimodal datasets and allows for flexible application across a range of modalities and data types. We demonstrate throughout this manuscript that performing downstream analyses on a weighted combination of data types improves our ability to characterize cellular diversity.</p><p id=\"p0235\">We apply our approach to analyze a dataset of human PBMCs featuring paired transcriptomes and measurements of 228 surface proteins, representing a multimodal atlas of the immune system. We leverage this resource to characterize extensive lymphoid heterogeneity that has not been previously observed by scRNA-seq alone, including the heterogeneous expression of integrin proteins on circulating memory T&#x000a0;cells, a gradient of adaptive-like responses in NK cells, and tightly clustered clonal populations within effector and cytotoxic groups. Our data also enable us to explore the response of the innate immune system to vaccination, highlighting specific response biomarkers, as well as the heterogeneous responses of conventional DCs. Importantly, we demonstrate that CITE-seq data can be easily mined to identify the best immunophenotypic marker panels for any subpopulation of interest. These marker panels can be used for flow cytometry with the same antibody clones in our CITE-seq panel, facilitating rapid enrichment and downstream analysis of these groups, and broadening the value of our resource.</p><p id=\"p0240\">In addition to constructing a multimodal reference, we demonstrate the ability to map scRNA-seq data onto this dataset. We accomplish this via a supervised version of principal component analysis to identify the best transcriptomic modules which delineate our WNN-defined cell types. Supervised mapping represents an attractive alternative to unsupervised analysis, and we show how this workflow can improve cell type identification and robustly integrate samples from multiple donors and disease states. To assist the community in utilizing our resource, we have created a web application, freely available at <ext-link ext-link-type=\"uri\" xlink:href=\"https://azimuth.hubmapconsortium.org/\" id=\"intref0010\">https://azimuth.hubmapconsortium.org/</ext-link>, which enables users to rapidly map their own datasets online, automating the process of visualization and annotation. Using this approach, a dataset of 50,000 cells can be fully processed and mapped in less than 5&#x000a0;min. As the profiling of human PBMCs under a variety of disease states becomes increasingly routine, the ability to perform automated mapping of these datasets will facilitate the characterization of complex immune responses, and the discovery of pathogenic populations. We note that our supervised mapping is not limited to scRNA-seq and can be extended to other modalities. For example, future extensions of this work could modify our supervised PCA procedure to identify optimal transformations of multiplexed protein measurements. This would enable the mapping of mass cytometry profiles to our multimodal reference, even in the absence of transcriptomic data.</p><p id=\"p0245\">Last, we note that the modality weights learned in our procedure serve not only as a proxy for the technical quality of a measurement type, but may also reflect the biological importance of each modality in determining cellular identity. For example, our analyses of human bone marrow demonstrated that progenitor cells and differentiated cells exhibited divergent modality weights. As future technologies enable the simultaneous measurement of modalities spanning the central dogma including chromatin state, DNA methylation, transcription, lineage, spatial location, and protein levels&#x02014;WNN analysis may help to reveal how subpopulations of cells differentially utilize these modalities to regulate their current state and future potential. Our current implementation of WNN analysis extends to handle three or more simultaneously measured modalities, as these technologies mature. Integrative multimodal analysis therefore provides a path forward to move beyond the partial and transcriptome-focused view of a cell and toward a unified definition of cellular behavior, identity, and function.</p><sec id=\"sec3.1\"><title>Limitations of the study</title><p id=\"p0250\">We note the following limitations with our study. First, WNN requires a dimensional reduction to describe the neighborhood structure between cells. This requirement is not compatible with categorical or low-dimensional data. Second, WNN assumes that modalities do not define conflicting sets of cell states. Although we have not observed this when using molecular data such as chromatin state, gene expression, and surface protein abundance, this assumption may be problematic when integrating morphological, functional, and molecular data. In addition, our circulating immune atlas was constructed from PBMCs and therefore contains few cells with no nuclei (erythrocytes) or multi-lobed nuclei (granulocytes).</p></sec></sec><sec id=\"sec4\"><title>STAR&#x02605;Methods</title><sec id=\"sec4.1\"><title>Key resources table</title><p id=\"p0255\"><table-wrap position=\"float\" id=\"undtbl1\"><table frame=\"hsides\" rules=\"groups\"><thead><tr><th>REAGENT or RESOURCE</th><th>SOURCE</th><th>IDENTIFIER</th></tr></thead><tbody><tr><td colspan=\"3\"><bold>Antibodies</bold></td></tr><tr><td colspan=\"3\"><hr/></td></tr><tr><td>B7-H4</td><td>BioLegend TotalSeq-A</td><td>Cat# 358114</td></tr><tr><td>C5L2</td><td>BioLegend TotalSeq-A</td><td>Cat# 342407</td></tr><tr><td>Cadherin</td><td>BioLegend TotalSeq-A</td><td>Cat# 368715</td></tr><tr><td>CCR10</td><td>Custom made</td><td>clone 6588-5</td></tr><tr><td>CD102</td><td>BioLegend TotalSeq-A</td><td>Cat# 328509</td></tr><tr><td>CD103</td><td>BioLegend TotalSeq-A</td><td>Cat# 350231</td></tr><tr><td>CD105</td><td>BioLegend TotalSeq-A</td><td>Cat# 323221</td></tr><tr><td>CD106</td><td>BioLegend TotalSeq-A</td><td>Cat# 305813</td></tr><tr><td>CD107a</td><td>BioLegend TotalSeq-A</td><td>Cat# 328647</td></tr><tr><td>CD109</td><td>BioLegend TotalSeq-A</td><td>Cat# 323307</td></tr><tr><td>CD110</td><td>Custom made</td><td>clone S16017E</td></tr><tr><td>CD112</td><td>BioLegend TotalSeq-A</td><td>Cat# 337417</td></tr><tr><td>CD115</td><td>BioLegend TotalSeq-A</td><td>Cat# 347325</td></tr><tr><td>CD117</td><td>BioLegend TotalSeq-A</td><td>Cat# 313241</td></tr><tr><td>CD119</td><td>BioLegend TotalSeq-A</td><td>Cat# 308607</td></tr><tr><td>CD11a/CD18</td><td>BioLegend TotalSeq-A</td><td>Cat# 363425</td></tr><tr><td>CD11b_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 101265</td></tr><tr><td>CD11b_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 301353</td></tr><tr><td>CD11c</td><td>BioLegend TotalSeq-A</td><td>Cat# 371519</td></tr><tr><td>CD122</td><td>Custom made</td><td>clone TU27</td></tr><tr><td>CD123</td><td>BioLegend TotalSeq-A</td><td>Cat# 306037</td></tr><tr><td>CD124</td><td>Custom made</td><td>clone G077F6</td></tr><tr><td>CD126</td><td>BioLegend TotalSeq-A</td><td>Cat# 352813</td></tr><tr><td>CD127</td><td>BioLegend TotalSeq-A</td><td>Cat# 351352</td></tr><tr><td>CD13</td><td>BioLegend TotalSeq-A</td><td>Cat# 301729</td></tr><tr><td>CD133_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 372815</td></tr><tr><td>CD133_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 394005</td></tr><tr><td>CD134</td><td>BioLegend TotalSeq-A</td><td>Cat# 350033</td></tr><tr><td>CD135</td><td>BioLegend TotalSeq-A</td><td>Cat# 313317</td></tr><tr><td>CD137</td><td>BioLegend TotalSeq-A</td><td>Cat# 309835</td></tr><tr><td>CD138_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 356533</td></tr><tr><td>CD138_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 352325</td></tr><tr><td>CD14</td><td>BioLegend TotalSeq-A</td><td>Cat# 301855</td></tr><tr><td>CD140a</td><td>BioLegend TotalSeq-A</td><td>Cat# 323509</td></tr><tr><td>CD140b</td><td>BioLegend TotalSeq-A</td><td>Cat# 323609</td></tr><tr><td>CD141</td><td>BioLegend TotalSeq-A</td><td>Cat# 344121</td></tr><tr><td>CD142</td><td>BioLegend TotalSeq-A</td><td>Cat# 365207</td></tr><tr><td>CD144</td><td>BioLegend TotalSeq-A</td><td>Cat# 348517</td></tr><tr><td>CD146</td><td>BioLegend TotalSeq-A</td><td>Cat# 361017</td></tr><tr><td>CD15</td><td>BioLegend TotalSeq-A</td><td>Cat# 323046</td></tr><tr><td>CD152</td><td>BioLegend TotalSeq-A</td><td>Cat# 369619</td></tr><tr><td>CD154</td><td>BioLegend TotalSeq-A</td><td>Cat# 310843</td></tr><tr><td>CD155</td><td>BioLegend TotalSeq-A</td><td>Cat# 337623</td></tr><tr><td>CD158</td><td>BioLegend TotalSeq-A</td><td>Cat# 339515</td></tr><tr><td>CD158b</td><td>BioLegend TotalSeq-A</td><td>Cat# 312615</td></tr><tr><td>CD158e1</td><td>BioLegend TotalSeq-A</td><td>Cat# 312723</td></tr><tr><td>CD158f</td><td>BioLegend TotalSeq-A</td><td>Cat# 341307</td></tr><tr><td>CD16</td><td>BioLegend TotalSeq-A</td><td>Cat# 302061</td></tr><tr><td>CD161</td><td>BioLegend TotalSeq-A</td><td>Cat# 339945</td></tr><tr><td>CD163</td><td>BioLegend TotalSeq-A</td><td>Cat# 333635</td></tr><tr><td>CD164</td><td>BioLegend TotalSeq-A</td><td>Cat# 324809</td></tr><tr><td>CD169</td><td>BioLegend TotalSeq-A</td><td>Cat# 346011</td></tr><tr><td>CD171</td><td>BioLegend TotalSeq-A</td><td>Cat# 371609</td></tr><tr><td>CD172a</td><td>BioLegend TotalSeq-A</td><td>Cat# 372109</td></tr><tr><td>CD177</td><td>BioLegend TotalSeq-A</td><td>Cat# 315811</td></tr><tr><td>CD178</td><td>BioLegend TotalSeq-A</td><td>Cat# 306413</td></tr><tr><td>CD18</td><td>BioLegend TotalSeq-A</td><td>Cat# 302121</td></tr><tr><td>CD184</td><td>BioLegend TotalSeq-A</td><td>Cat# 306531</td></tr><tr><td>CD185</td><td>BioLegend TotalSeq-A</td><td>Cat# 356937</td></tr><tr><td>CD186</td><td>BioLegend TotalSeq-A</td><td>Cat# 356021</td></tr><tr><td>CD19</td><td>BioLegend TotalSeq-A</td><td>Cat# 302259</td></tr><tr><td>CD192</td><td>BioLegend TotalSeq-A</td><td>Cat# 357229</td></tr><tr><td>CD193</td><td>BioLegend TotalSeq-A</td><td>Cat# 310729</td></tr><tr><td>CD194</td><td>BioLegend TotalSeq-A</td><td>Cat# 359423</td></tr><tr><td>CD195</td><td>BioLegend TotalSeq-A</td><td>Cat# 359135</td></tr><tr><td>CD196</td><td>BioLegend TotalSeq-A</td><td>Cat# 353437</td></tr><tr><td>CD199</td><td>BioLegend TotalSeq-A</td><td>Cat# 358919</td></tr><tr><td>CD1a</td><td>BioLegend TotalSeq-A</td><td>Cat# 300133</td></tr><tr><td>CD1c</td><td>BioLegend TotalSeq-A</td><td>Cat# 331539</td></tr><tr><td>CD1d</td><td>BioLegend TotalSeq-A</td><td>Cat# 350317</td></tr><tr><td>CD2</td><td>BioLegend TotalSeq-A</td><td>Cat# 309229</td></tr><tr><td>CD20</td><td>BioLegend TotalSeq-A</td><td>Cat# 302359</td></tr><tr><td>CD200</td><td>Custom made</td><td>clone OX-104</td></tr><tr><td>CD201</td><td>BioLegend TotalSeq-A</td><td>Cat# 351907</td></tr><tr><td>CD202b</td><td>BioLegend TotalSeq-A</td><td>Cat# 334213</td></tr><tr><td>CD203c</td><td>BioLegend TotalSeq-A</td><td>Cat# 324627</td></tr><tr><td>CD204</td><td>BioLegend TotalSeq-A</td><td>Cat# 371909</td></tr><tr><td>CD205</td><td>BioLegend TotalSeq-A</td><td>Cat# 342211</td></tr><tr><td>CD206</td><td>BioLegend TotalSeq-A</td><td>Cat# 321143</td></tr><tr><td>CD207</td><td>BioLegend TotalSeq-A</td><td>Cat# 352207</td></tr><tr><td>CD209</td><td>BioLegend TotalSeq-A</td><td>Cat# 330119</td></tr><tr><td>CD21</td><td>BioLegend TotalSeq-A</td><td>Cat# 354915</td></tr><tr><td>CD22</td><td>BioLegend TotalSeq-A</td><td>Cat# 363514</td></tr><tr><td>CD223</td><td>BioLegend TotalSeq-A</td><td>Cat# 369333</td></tr><tr><td>CD226</td><td>BioLegend TotalSeq-A</td><td>Cat# 337111</td></tr><tr><td>CD235a</td><td>BioLegend TotalSeq-A</td><td>Cat# 349117</td></tr><tr><td>CD235ab</td><td>BioLegend TotalSeq-A</td><td>Cat# 306623</td></tr><tr><td>CD24</td><td>BioLegend TotalSeq-A</td><td>Cat# 311137</td></tr><tr><td>CD243</td><td>BioLegend TotalSeq-A</td><td>Cat# 919407</td></tr><tr><td>CD244</td><td>BioLegend TotalSeq-A</td><td>Cat# 329527</td></tr><tr><td>CD25</td><td>BioLegend TotalSeq-A</td><td>Cat# 302643</td></tr><tr><td>CD252</td><td>Custom made</td><td>clone 11C3.1</td></tr><tr><td>CD253</td><td>BioLegend TotalSeq-A</td><td>Cat# 308211</td></tr><tr><td>CD26_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 302720</td></tr><tr><td>CD26_2</td><td>Custom made</td><td>clone BA5b</td></tr><tr><td>CD267</td><td>BioLegend TotalSeq-A</td><td>Cat# 311913</td></tr><tr><td>CD268</td><td>BioLegend TotalSeq-A</td><td>Cat# 316925</td></tr><tr><td>CD269</td><td>BioLegend TotalSeq-A</td><td>Cat# 357521</td></tr><tr><td>CD27</td><td>BioLegend TotalSeq-A</td><td>Cat# 302847</td></tr><tr><td>CD270</td><td>BioLegend TotalSeq-A</td><td>Cat# 318813</td></tr><tr><td>CD271</td><td>BioLegend TotalSeq-A</td><td>Cat# 345123</td></tr><tr><td>CD272</td><td>BioLegend TotalSeq-A</td><td>Cat# 344525</td></tr><tr><td>CD273</td><td>BioLegend TotalSeq-A</td><td>Cat# 329619</td></tr><tr><td>CD274</td><td>BioLegend TotalSeq-A</td><td>Cat# 329743</td></tr><tr><td>CD275_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 309413</td></tr><tr><td>CD275_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 329809</td></tr><tr><td>CD278</td><td>BioLegend TotalSeq-A</td><td>Cat# 313555</td></tr><tr><td>CD279</td><td>BioLegend TotalSeq-A</td><td>Cat# 329955</td></tr><tr><td>CD28</td><td>BioLegend TotalSeq-A</td><td>Cat# 302955</td></tr><tr><td>CD284</td><td>BioLegend TotalSeq-A</td><td>Cat# 312817</td></tr><tr><td>CD29</td><td>BioLegend TotalSeq-A</td><td>Cat# 303027</td></tr><tr><td>CD294</td><td>BioLegend TotalSeq-A</td><td>Cat# 350127</td></tr><tr><td>CD3_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 300475</td></tr><tr><td>CD3_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 344847</td></tr><tr><td>CD30</td><td>BioLegend TotalSeq-A</td><td>Cat# 333913</td></tr><tr><td>CD301</td><td>BioLegend TotalSeq-A</td><td>Cat# 354707</td></tr><tr><td>CD303</td><td>BioLegend TotalSeq-A</td><td>Cat# 354239</td></tr><tr><td>CD304</td><td>BioLegend TotalSeq-A</td><td>Cat# 354525</td></tr><tr><td>CD305</td><td>BioLegend TotalSeq-A</td><td>Cat# 342805</td></tr><tr><td>CD307c/FcRL3</td><td>BioLegend TotalSeq-A</td><td>Cat# 374411</td></tr><tr><td>CD307d</td><td>BioLegend TotalSeq-A</td><td>Cat# 340209</td></tr><tr><td>CD307e</td><td>BioLegend TotalSeq-A</td><td>Cat# 340307</td></tr><tr><td>CD309</td><td>BioLegend TotalSeq-A</td><td>Cat# 359919</td></tr><tr><td>CD31</td><td>BioLegend TotalSeq-A</td><td>Cat# 303137</td></tr><tr><td>CD314</td><td>BioLegend TotalSeq-A</td><td>Cat# 320835</td></tr><tr><td>CD319</td><td>BioLegend TotalSeq-A</td><td>Cat# 331821</td></tr><tr><td>CD324</td><td>BioLegend TotalSeq-A</td><td>Cat# 324125</td></tr><tr><td>CD325</td><td>BioLegend TotalSeq-A</td><td>Cat# 350817</td></tr><tr><td>CD335</td><td>BioLegend TotalSeq-A</td><td>Cat# 331943</td></tr><tr><td>CD337</td><td>BioLegend TotalSeq-A</td><td>Cat# 325221</td></tr><tr><td>CD338</td><td>BioLegend TotalSeq-A</td><td>Cat# 332021</td></tr><tr><td>CD34</td><td>BioLegend TotalSeq-A</td><td>Cat# 343537</td></tr><tr><td>CD340</td><td>BioLegend TotalSeq-A</td><td>Cat# 324423</td></tr><tr><td>CD35</td><td>BioLegend TotalSeq-A</td><td>Cat# 333407</td></tr><tr><td>CD354</td><td>Custom made</td><td>clone TREM-26</td></tr><tr><td>CD357</td><td>BioLegend TotalSeq-A</td><td>Cat# 371225</td></tr><tr><td>CD36</td><td>BioLegend TotalSeq-A</td><td>Cat# 336225</td></tr><tr><td>CD366</td><td>BioLegend TotalSeq-A</td><td>Cat# 345047</td></tr><tr><td>CD370</td><td>BioLegend TotalSeq-A</td><td>Cat# 353807</td></tr><tr><td>CD38_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 303541</td></tr><tr><td>CD38_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 356635</td></tr><tr><td>CD39</td><td>BioLegend TotalSeq-A</td><td>Cat# 328233</td></tr><tr><td>CD4_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 344649</td></tr><tr><td>CD4_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 300563</td></tr><tr><td>CD40</td><td>BioLegend TotalSeq-A</td><td>Cat# 334346</td></tr><tr><td>CD41</td><td>BioLegend TotalSeq-A</td><td>Cat# 303737</td></tr><tr><td>CD42b</td><td>BioLegend TotalSeq-A</td><td>Cat# 303937</td></tr><tr><td>CD43</td><td>BioLegend TotalSeq-A</td><td>Cat# 343209</td></tr><tr><td>CD44_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 103045</td></tr><tr><td>CD44_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 338825</td></tr><tr><td>CD45_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 368543</td></tr><tr><td>CD45_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 304064</td></tr><tr><td>CD45RA</td><td>BioLegend TotalSeq-A</td><td>Cat# 304157</td></tr><tr><td>CD45RB</td><td>BioLegend TotalSeq-A</td><td>Cat# 310209</td></tr><tr><td>CD45RO</td><td>BioLegend TotalSeq-A</td><td>Cat# 304255</td></tr><tr><td>CD46</td><td>BioLegend TotalSeq-A</td><td>Cat# 352415</td></tr><tr><td>CD47</td><td>BioLegend TotalSeq-A</td><td>Cat# 323129</td></tr><tr><td>CD48</td><td>BioLegend TotalSeq-A</td><td>Cat# 336709</td></tr><tr><td>CD49a</td><td>BioLegend TotalSeq-A</td><td>Cat# 328315</td></tr><tr><td>CD49b</td><td>BioLegend TotalSeq-A</td><td>Cat# 359311</td></tr><tr><td>CD49d</td><td>BioLegend TotalSeq-A</td><td>Cat# 304337</td></tr><tr><td>CD52</td><td>BioLegend TotalSeq-A</td><td>Cat# 316017</td></tr><tr><td>CD54</td><td>BioLegend TotalSeq-A</td><td>Cat# 353123</td></tr><tr><td>CD55</td><td>BioLegend TotalSeq-A</td><td>Cat# 311317</td></tr><tr><td>CD56_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 362557</td></tr><tr><td>CD56_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 392421</td></tr><tr><td>CD57</td><td>BioLegend TotalSeq-A</td><td>Cat# 393319</td></tr><tr><td>CD59</td><td>BioLegend TotalSeq-A</td><td>Cat# 304709</td></tr><tr><td>CD61</td><td>BioLegend TotalSeq-A</td><td>Cat# 336423</td></tr><tr><td>CD62E</td><td>BioLegend TotalSeq-A</td><td>Cat# 336017</td></tr><tr><td>CD62P</td><td>BioLegend TotalSeq-A</td><td>Cat# 304933</td></tr><tr><td>CD63</td><td>BioLegend TotalSeq-A</td><td>Cat# 353035</td></tr><tr><td>CD64</td><td>BioLegend TotalSeq-A</td><td>Cat# 305037</td></tr><tr><td>CD66a/c/e</td><td>BioLegend TotalSeq-A</td><td>Cat# 342319</td></tr><tr><td>CD66b</td><td>BioLegend TotalSeq-A</td><td>Cat# 392905</td></tr><tr><td>CD68</td><td>Custom made</td><td>clone Y1/82A</td></tr><tr><td>CD69</td><td>BioLegend TotalSeq-A</td><td>Cat# 310947</td></tr><tr><td>CD70</td><td>BioLegend TotalSeq-A</td><td>Cat# 355117</td></tr><tr><td>CD71</td><td>BioLegend TotalSeq-A</td><td>Cat# 334123</td></tr><tr><td>CD72</td><td>BioLegend TotalSeq-A</td><td>Cat# 316205</td></tr><tr><td>CD73</td><td>BioLegend TotalSeq-A</td><td>Cat# 344029</td></tr><tr><td>CD79a</td><td>Custom made</td><td>clone HM47</td></tr><tr><td>CD79b</td><td>BioLegend TotalSeq-A</td><td>Cat# 341415</td></tr><tr><td>CD8</td><td>BioLegend TotalSeq-A</td><td>Cat# 344751</td></tr><tr><td>CD80</td><td>BioLegend TotalSeq-A</td><td>Cat# 305239</td></tr><tr><td>CD81</td><td>BioLegend TotalSeq-A</td><td>Cat# 349521</td></tr><tr><td>CD83</td><td>BioLegend TotalSeq-A</td><td>Cat# 305339</td></tr><tr><td>CD85 g</td><td>BioLegend TotalSeq-A</td><td>Cat# 326411</td></tr><tr><td>CD86</td><td>BioLegend TotalSeq-A</td><td>Cat# 305443</td></tr><tr><td>CD8a</td><td>BioLegend TotalSeq-A</td><td>Cat# 301067</td></tr><tr><td>CD9</td><td>BioLegend TotalSeq-A</td><td>Cat# 312119</td></tr><tr><td>CD90</td><td>BioLegend TotalSeq-A</td><td>Cat# 328135</td></tr><tr><td>CD93</td><td>BioLegend TotalSeq-A</td><td>Cat# 336121</td></tr><tr><td>CD95</td><td>BioLegend TotalSeq-A</td><td>Cat# 305649</td></tr><tr><td>CD96</td><td>BioLegend TotalSeq-A</td><td>Cat# 338419</td></tr><tr><td>CD98</td><td>BioLegend TotalSeq-A</td><td>Cat# 315605</td></tr><tr><td>CD99</td><td>BioLegend TotalSeq-A</td><td>Cat# 371317</td></tr><tr><td>CLEC12A</td><td>BioLegend TotalSeq-A</td><td>Cat# 353613</td></tr><tr><td>CLEC2</td><td>BioLegend TotalSeq-A</td><td>Cat# 372009</td></tr><tr><td>CX3CR1</td><td>BioLegend TotalSeq-A</td><td>Cat# 355709</td></tr><tr><td>Folate</td><td>BioLegend TotalSeq-A</td><td>Cat# 391707</td></tr><tr><td>Galectin-9</td><td>Custom made</td><td>clone 9M1-3</td></tr><tr><td>GP130</td><td>Custom made</td><td>clone 2E1B02</td></tr><tr><td>HLA-DR</td><td>BioLegend TotalSeq-A</td><td>Cat# 307659</td></tr><tr><td>IgD</td><td>BioLegend TotalSeq-A</td><td>Cat# 348243</td></tr><tr><td>IgM</td><td>BioLegend TotalSeq-A</td><td>Cat# 314541</td></tr><tr><td>Integrin_7</td><td>BioLegend TotalSeq-A</td><td>Cat# 321227</td></tr><tr><td>LOX-1</td><td>BioLegend TotalSeq-A</td><td>Cat# 358611</td></tr><tr><td>MERTK</td><td>BioLegend TotalSeq-A</td><td>Cat# 367617</td></tr><tr><td>Notch_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 352109</td></tr><tr><td>Notch_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 345411</td></tr><tr><td>Podoplanin</td><td>BioLegend TotalSeq-A</td><td>Cat# 337019</td></tr><tr><td>Rag_IgG2c</td><td>BioLegend TotalSeq-A</td><td>Cat# 400739</td></tr><tr><td>Rat_IgG1_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 400459</td></tr><tr><td>Rat_IgG1_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 401919</td></tr><tr><td>Rat_IgG2b</td><td>BioLegend TotalSeq-A</td><td>Cat# 400673</td></tr><tr><td>Siglec-8</td><td>Custom made</td><td>clone 7C9</td></tr><tr><td>TCR_1</td><td>BioLegend TotalSeq-A</td><td>Cat# 331229</td></tr><tr><td>TCR_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 306737</td></tr><tr><td>TCR_V_2</td><td>BioLegend TotalSeq-A</td><td>Cat# 331433</td></tr><tr><td>TCR_V_24_J_18</td><td>BioLegend TotalSeq-A</td><td>Cat# 342923</td></tr><tr><td>TCR_V_7.2</td><td>BioLegend TotalSeq-A</td><td>Cat# 351733</td></tr><tr><td>TCR_V_9</td><td>BioLegend TotalSeq-A</td><td>Cat# 331311</td></tr><tr><td>TIGIT</td><td>BioLegend TotalSeq-A</td><td>Cat# 372725</td></tr><tr><td>TIM-4</td><td>BioLegend TotalSeq-A</td><td>Cat# 354009</td></tr><tr><td>TSLPR</td><td>BioLegend TotalSeq-A</td><td>Cat# 322907</td></tr><tr><td>VEGFR-3</td><td>Custom made</td><td>clone 9D9F9</td></tr><tr><td>XCR1</td><td>BioLegend TotalSeq-A</td><td>Cat# 372613</td></tr><tr><td>CD3</td><td>Custom made</td><td>clone UCHT1</td></tr><tr><td>CD4</td><td>Custom made</td><td>clone RPA-T4</td></tr><tr><td>CD8</td><td>Custom made</td><td>clone RPA-T8</td></tr><tr><td>TCRb</td><td>Custom made</td><td>clone IP26</td></tr><tr><td>TCRg</td><td>Custom made</td><td>clone B1</td></tr><tr><td>CD44</td><td>Custom made</td><td>clone BJ18</td></tr><tr><td>CD62L</td><td>Custom made</td><td>clone DREG-56</td></tr><tr><td>Ox40 (CD134)</td><td>Custom made</td><td>clone Ber-ACT35</td></tr><tr><td>PD1 (CD279)</td><td>Custom made</td><td>clone EH12.2H7</td></tr><tr><td>PD-L1</td><td>Custom made</td><td>clone 29E.2A3</td></tr><tr><td>EpCAM (CD326)</td><td>Custom made</td><td>clone 9C4</td></tr><tr><td>CD66b</td><td>Custom made</td><td>clone 6/40C</td></tr><tr><td>MHCII (HLA-DR)</td><td>Custom made</td><td>clone L243</td></tr><tr><td>CD45</td><td>Custom made</td><td>clone H130</td></tr><tr><td>CD19</td><td>Custom made</td><td>clone H1B19</td></tr><tr><td>B220 (CD45R)</td><td>Custom made</td><td>clone RA3-6B2</td></tr><tr><td>CD11c</td><td>Custom made</td><td>clone 3.9</td></tr><tr><td>CD14</td><td>Custom made</td><td>clone M5E2</td></tr><tr><td>CD34</td><td>Custom made</td><td>clone 581</td></tr><tr><td>CD56</td><td>Custom made</td><td>clone 5.1H11</td></tr><tr><td>CD16</td><td>Custom made</td><td>clone B73.1</td></tr><tr><td>CD2</td><td>Custom made</td><td>clone TS1/8</td></tr><tr><td>CD5</td><td>Custom made</td><td>clone UCHT2</td></tr><tr><td>CD45RA</td><td>Custom made</td><td>clone HI100</td></tr><tr><td>CD45RO</td><td>Custom made</td><td>clone UCHL1</td></tr><tr><td>CCR7</td><td>Custom made</td><td>clone GO43H7</td></tr><tr><td>CD11b</td><td>Custom made</td><td>clone ICRF44</td></tr><tr><td>CD1a</td><td>Custom made</td><td>clone HI149</td></tr><tr><td>CD27</td><td>Custom made</td><td>clone M-T271</td></tr><tr><td>CD69</td><td>Custom made</td><td>clone FN50</td></tr><tr><td>PECAM (CD31)</td><td>Custom made</td><td>clone WM59</td></tr><tr><td>CD138</td><td>Custom made</td><td>clone DL-101</td></tr><tr><td>CD24</td><td>Custom made</td><td>clone ML5</td></tr><tr><td>Siglec-8</td><td>Custom made</td><td>clone 7C9</td></tr><tr><td>LAMP1</td><td>Custom made</td><td>clone H4A3</td></tr><tr><td>C-kit (CD117)</td><td>Custom made</td><td>clone 104D2</td></tr><tr><td>IL7Ralpha (CD127)</td><td>Custom made</td><td>clone A019D5</td></tr><tr><td>CTLA4</td><td>Custom made</td><td>clone BNI3</td></tr><tr><td>HLA-A,B,C</td><td>Custom made</td><td>clone W6/32</td></tr><tr><td>CD77</td><td>Custom made</td><td>clone 5B5</td></tr><tr><td>CD366 (tim3)</td><td>Custom made</td><td>clone F38-2E2</td></tr><tr><td>CLA</td><td>Custom made</td><td>clone HECA-452</td></tr><tr><td>CD28</td><td>Custom made</td><td>clone CD28.2</td></tr><tr><td>CD7</td><td>Custom made</td><td>clone CD7-6B7</td></tr><tr><td>CD26 (Adenosine)</td><td>Custom made</td><td>clone BA5b</td></tr><tr><td>PD-1 (CD279)</td><td>Custom made</td><td>clone NAT105</td></tr><tr><td>PD-L1 (CD274)</td><td>Custom made</td><td>clone MIH1</td></tr><tr><td>CD161</td><td>Custom made</td><td>clone CD161</td></tr><tr><td>CD123</td><td>Custom made</td><td>clone CD123</td></tr><tr><td>CD25</td><td>Custom made</td><td>clone CD25</td></tr><tr><td>IgG1</td><td>Custom made</td><td>clone MOPC21</td></tr><tr><td>IgG2a</td><td>Custom made</td><td>clone MOPC273</td></tr><tr><td>CD45RA</td><td>Custom made</td><td>clone HI100</td></tr><tr><td>CD45RO</td><td>Custom made</td><td>clone UCHL1</td></tr><tr><td colspan=\"3\"><hr/></td></tr><tr><td colspan=\"3\"><bold>Biological samples</bold></td></tr><tr><td colspan=\"3\"><hr/></td></tr><tr><td>Human PBMC</td><td>Cape Town HVTN Immunology Lab, South Africa</td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://www.chil.org.za/\" id=\"intref0015\">https://www.chil.org.za/</ext-link></td></tr><tr><td>Human PBMC</td><td>AllCells</td><td>Lot 3032552</td></tr><tr><td colspan=\"3\"><hr/></td></tr><tr><td colspan=\"3\"><bold>Critical commercial assays</bold></td></tr><tr><td colspan=\"3\"><hr/></td></tr><tr><td>3&#x02032; scRNA-seq kit</td><td>10x Genomics</td><td>v3 GEM kit</td></tr><tr><td>5&#x02032; VDJ-seq kit</td><td>10x Genomics</td><td>v1 V(D)J kit</td></tr><tr><td colspan=\"3\"><hr/></td></tr><tr><td colspan=\"3\"><bold>Deposited data</bold></td></tr><tr><td colspan=\"3\"><hr/></td></tr><tr><td>Human PBMC this paper &#x02013; CITE-seq, ECITE-seq</td><td>This paper</td><td>GEO: <ext-link ext-link-type=\"uri\" xlink:href=\"ncbi-geo:GSE164378\" id=\"intref0020\">GSE164378</ext-link> dbGAP: phs002315.v1.p1</td></tr><tr><td>Human cord blood mononuclear cells &#x02013; CITE-seq</td><td><xref rid=\"bib71\" ref-type=\"bibr\">Stoeckius et&#x000a0;al., 2017</xref></td><td>GEO: <ext-link ext-link-type=\"uri\" xlink:href=\"ncbi-geo:GSE100866\" id=\"intref0025\">GSE100866</ext-link></td></tr><tr><td>Human bone marrow mononuclear cells &#x02013; CITE-seq</td><td><xref rid=\"bib73\" ref-type=\"bibr\">Stuart et&#x000a0;al., 2019</xref></td><td>GEO: <ext-link ext-link-type=\"uri\" xlink:href=\"ncbi-geo:GSE128639\" id=\"intref0030\">GSE128639</ext-link></td></tr><tr><td>Human PBMC &#x02013; ASAP-seq</td><td><xref rid=\"bib56\" ref-type=\"bibr\">Mimitou et&#x000a0;al., 2020</xref></td><td>GEO: <ext-link ext-link-type=\"uri\" xlink:href=\"ncbi-geo:GSE156473\" id=\"intref0035\">GSE156473</ext-link></td></tr><tr><td>Human PBMC &#x02013; 10x multiome ATAC+Gene expression</td><td>Single Cell Multiome ATAC&#x000a0;+ Gene Exp. Datasets</td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://support.10xgenomics.com/single-cell-multiome-atac-gex/datasets\" id=\"intref0040\">https://support.10xgenomics.com/single-cell-multiome-atac-gex/datasets</ext-link></td></tr><tr><td>Mouse skin cells &#x02013; SHARE-seq</td><td>Ma et&#x000a0;al., 2020</td><td>GEO: <ext-link ext-link-type=\"uri\" xlink:href=\"ncbi-geo:GSE140203\" id=\"intref0045\">GSE140203</ext-link></td></tr><tr><td>Human PBMC&#x02013;CITE-seq</td><td><xref rid=\"bib41\" ref-type=\"bibr\">Kotliarov et&#x000a0;al., 2020</xref></td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://nih.figshare.com/collections/Data_and_software_code_repository_for_Broad_immune_activation_underlies_shared_set_point_signatures_for_vaccine_responsiveness_in_healthy_individuals_and_disease_activity_in_patients_with_lupus_Kotliarov_Y_Sparks_R_et_al_Nat_Med_DOI_https_d/4753772\" id=\"intref0050\">https://nih.figshare.com/collections/Data_and_software_code_repository_for_Broad_immune_activation_underlies_shared_set_point_signatures_for_vaccine_responsiveness_in_healthy_individuals_and_disease_activity_in_patients_with_lupus_Kotliarov_Y_Sparks_R_et_al_Nat_Med_DOI_https_d/4753772</ext-link></td></tr><tr><td>Human PBMC &#x02013; scRNA-seq</td><td><xref rid=\"bib86\" ref-type=\"bibr\">Wilk et&#x000a0;al., 2020</xref></td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://www.covid19cellatlas.org/index.patient.html\" id=\"intref0055\">https://www.covid19cellatlas.org/index.patient.html</ext-link></td></tr><tr><td colspan=\"3\"><hr/></td></tr><tr><td colspan=\"3\"><bold>Software and algorithms</bold></td></tr><tr><td colspan=\"3\"><hr/></td></tr><tr><td>Seurat v4</td><td>This paper</td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://github.com/satijalab/seurat\" id=\"intref0060\">https://github.com/satijalab/seurat</ext-link></td></tr><tr><td>Azimuth</td><td>This paper</td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://azimuth.hubmapconsortium.org/\" id=\"intref0065\">https://azimuth.hubmapconsortium.org/</ext-link></td></tr><tr><td>Seurat v3.2.0</td><td><xref rid=\"bib73\" ref-type=\"bibr\">Stuart et&#x000a0;al., 2019</xref></td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://github.com/satijalab/seurat/releases/tag/v3.2.0\" id=\"intref0070\">https://github.com/satijalab/seurat/releases/tag/v3.2.0</ext-link></td></tr><tr><td>SCTransform v0.3.2</td><td><xref rid=\"bib29\" ref-type=\"bibr\">Hafemeister and Satija, 2019</xref></td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://github.com/ChristophH/sctransform\" id=\"intref0075\">https://github.com/ChristophH/sctransform</ext-link></td></tr><tr><td>Cell Ranger v3.1.0</td><td>10x Genomics</td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/installation\" id=\"intref0080\">https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/installation</ext-link></td></tr><tr><td>Cell Ranger vdj v3.0.2</td><td>10x Genomics</td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/installation\" id=\"intref0085\">https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/installation</ext-link></td></tr><tr><td>Salmon Alevin v1.3.0</td><td><xref rid=\"bib70\" ref-type=\"bibr\">Srivastava et&#x000a0;al., 2019</xref></td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://salmon.readthedocs.io/en/latest/alevin.html\" id=\"intref0090\">https://salmon.readthedocs.io/en/latest/alevin.html</ext-link></td></tr><tr><td>totalVI v0.6.7</td><td><xref rid=\"bib26\" ref-type=\"bibr\">Gayoso et&#x000a0;al., 2019</xref></td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://github.com/YosefLab/scvi-tools\" id=\"intref0095\">https://github.com/YosefLab/scvi-tools</ext-link></td></tr><tr><td>MOFA+ v1.1</td><td><xref rid=\"bib5\" ref-type=\"bibr\">Argelaguet et&#x000a0;al., 2020</xref></td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://biofam.github.io/MOFA2\" id=\"intref0100\">https://biofam.github.io/MOFA2</ext-link></td></tr><tr><td>scArches v0.1.2</td><td><xref rid=\"bib45\" ref-type=\"bibr\">Lotfollahi et&#x000a0;al., 2020</xref></td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://github.com/theislab/scarches\" id=\"intref0105\">https://github.com/theislab/scarches</ext-link></td></tr><tr><td>uwot v 0.1.10</td><td><xref rid=\"bib51\" ref-type=\"bibr\">McInnes et&#x000a0;al., 2018</xref></td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://github.com/jlmelville/uwot\" id=\"intref0110\">https://github.com/jlmelville/uwot</ext-link></td></tr><tr><td>Presto v1.0.0</td><td><xref rid=\"bib40\" ref-type=\"bibr\">Korsunsky et&#x000a0;al., 2019</xref></td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://github.com/immunogenomics/presto\" id=\"intref0115\">https://github.com/immunogenomics/presto</ext-link></td></tr><tr><td>Signac v1.0.0</td><td><xref rid=\"bib74\" ref-type=\"bibr\">Stuart et&#x000a0;al., 2020</xref></td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://satijalab.org/signac/index.html\" id=\"intref0120\">https://satijalab.org/signac/index.html</ext-link></td></tr><tr><td>R</td><td>R Core</td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://www.r-project.org/\" id=\"intref0125\">https://www.r-project.org/</ext-link></td></tr><tr><td>Python</td><td>Python Software Foundation</td><td><ext-link ext-link-type=\"uri\" xlink:href=\"https://www.python.org/\" id=\"intref0130\">https://www.python.org/</ext-link></td></tr></tbody></table></table-wrap></p></sec><sec id=\"sec4.2\"><title>Resource availability</title><sec id=\"sec4.2.1\"><title>Lead contact</title><p id=\"p0260\">Further information and requests for resources and reagents should be directed to and will be fulfilled by the Lead Contact, Rahul Satija (<ext-link ext-link-type=\"uri\" xlink:href=\"mailto:rsatija@nygenome.org\" id=\"intref0135\">rsatija@nygenome.org</ext-link>)</p></sec><sec id=\"sec4.2.2\"><title>Materials availability</title><p id=\"p0265\">No unique reagents were generated for this study.</p></sec><sec sec-type=\"data-availability\" id=\"sec4.2.3\"><title>Data and code availability</title><p id=\"p0270\">CITE-seq data generated for this manuscript is available to download and explore at <ext-link ext-link-type=\"uri\" xlink:href=\"https://atlas.fredhutch.org/nygc/multimodal-pbmc/\" id=\"intref0140\">https://atlas.fredhutch.org/nygc/multimodal-pbmc/</ext-link>. All CITE-seq and ECITE-seq raw data are available in GEO database under the accession number GEO: GSE164378. All raw sequencing data are deposited in the dbGaP under the accession number dbGaP: phs002315.v1.p1.</p><p id=\"p0275\">Seurat v4 is released under the open source GPLv3 license, and all code is available at <ext-link ext-link-type=\"uri\" xlink:href=\"https://www.github.com/satijalab/seurat\" id=\"intref0145\">https://www.github.com/satijalab/seurat</ext-link>. To facilitate the mapping of new query datasets to the multimodal PBMC reference described in this manuscript, we have released an automated web app, Azimuth: <ext-link ext-link-type=\"uri\" xlink:href=\"https://azimuth.hubmapconsortium.org/\" id=\"intref0150\">https://azimuth.hubmapconsortium.org/</ext-link>.</p></sec></sec><sec id=\"sec4.3\"><title>Experimental model and subject details</title><sec id=\"sec4.3.1\"><title>HIV vaccine trial specimens</title><p id=\"p0280\">HVTN 087 (NCT01578889) was a phase 1a HIV vaccine trial that tested intramuscular electroporation of a DNA vaccine with or without IL-12 adjuvant delivered as a plasmid at months 0, 1 and 3 followed by boosting with VSV-vectored HIV <italic>gag</italic> vaccine at month 6 (<xref rid=\"bib22\" ref-type=\"bibr\">Elizaga et&#x000a0;al., 2018</xref>; <xref rid=\"bib44\" ref-type=\"bibr\">Li et&#x000a0;al., 2017</xref>). Eight participants in this trial were selected for single cell analysis from Group 1 (no IL-12) and Group 3 (1000 mcg IL-12) based on sample availability. Participant demographics and group assignments are listed in <xref rid=\"mmc1\" ref-type=\"supplementary-material\">Table S1</xref>. Blood was collected immediately before the first VSV-Gag administration and at sequential time points afterward. PBMC were isolated and cryopreserved as previously described (<xref rid=\"bib9\" ref-type=\"bibr\">Bull et&#x000a0;al., 2007</xref>).</p></sec></sec><sec id=\"sec4.4\"><title>Method details</title><sec id=\"sec4.4.1\"><title>Antibody titration, staining, and cleanup</title><p id=\"p0285\">For CITE-seq / TotalSeq-A / 3P scRNA-seq experiments, we pooled together 228 TotalSeq-A antibodies from BioLegend (<xref rid=\"mmc2\" ref-type=\"supplementary-material\">Table S2</xref>). In preliminary experiments designed to test the balance of markers in the panel, reads corresponding to 12 antibodies each took up more than 2% of the total sequencing space, and combined together, accounted for half of the total antibody reads. The signal for each of these markers was reduced by addition of a proportional amount of unlabeled antibodies. We recommend the addition of unlabeled antibodies as an effective strategy to modify existing panels to be more robust to sequencing saturation from highly expressed protein markers. CITE-seq antibodies and unlabeled blocking antibodies were then combined in PBS and concentrated with a 50&#x000a0;kDa Amicon filter as per manufacturer&#x02019;s instructions. Post elution, BSA was added to a final concentration of 2%.</p><p id=\"p0290\">For ECCITE-seq / TotalSeq-C / 5P scRNA-seq experiments, we used a combination of antibody:oligo conjugates designed for ECCITE-seq (<xref rid=\"bib55\" ref-type=\"bibr\">Mimitou et&#x000a0;al., 2019</xref>), conjugated as described (<xref rid=\"bib72\" ref-type=\"bibr\">Stoeckius et&#x000a0;al., 2018</xref>), and commercially available TotalSeq-C reagents. 52 ECCITE-seq antibodies (<xref rid=\"bib55\" ref-type=\"bibr\">Mimitou et&#x000a0;al., 2019</xref>) were pooled together at a concentration of 1&#x000a0;&#x003bc;g each per test, and combined with TotalSeq-C reagents for CD45RA and CD45RO at 0.25&#x000a0;&#x003bc;g each per test. Antibodies were pooled together and concentrated in a 50&#x000a0;kDa Amicon filter as per manufacturer&#x02019;s instructions in PBS. Post elution, BSA was added to a final concentration of 2%.</p></sec><sec id=\"sec4.4.2\"><title>CITE-seq staining and sample preparation</title><p id=\"p0295\">To minimize batch effects, for each experiment we processed frozen PBMCs from four different patients at 3 different time points (day 0, day 3, and day 7). After thawing, cells were incubated with FcX block (BioLegend) for 10&#x000a0;min. Cells were then divided into separate aliquots and processed independently for the 3P and 5P protocols.</p><p id=\"p0300\">For the 3P CITE-seq staining protocol, samples were stained simultaneously with the antibody/block pool and a unique hashtag for 30&#x000a0;min. Cells were then washed 3 times in staining buffer (2% BSA, 0.01% Tween in PBS) and filtered using a 40&#x000a0;&#x003bc;m Flowmi filter in PBS and pooled in equal proportions. Cells were loaded into 8 lanes of a 10x Genomics Chip B, at 45,000 cells per lane using the 10x Genomics 3&#x02032; v3 GEM kit.</p><p id=\"p0305\">For the 5P ECCITE-seq staining protocol, each sample of cells was first stained with a unique hashtag for 30&#x000a0;min. Cells were then washed 3 times in staining buffer, pooled together, and stained with the antibody panel for 30&#x000a0;min. The pool of cells was then washed 3 times in staining buffer and filtered using a 40&#x003bc;m Flowmi filter in PBS. Cells were loaded into 2 lanes of a 10x Genomics Chip A, at 45000 cells per lane, using the 10x Genomics V(D)J kit (v1).</p><p id=\"p0310\">For both 3P and 5P experiments, first strand cDNA was generated by incubating the emulsions according to the respective 10x Genomics protocol. Emulsions were then broken and nucleic acids recovered Subsequent library preparation steps are detailed in the section below.</p></sec><sec id=\"sec4.4.3\"><title>Library prep</title><sec id=\"sec4.4.3.1\"><title>CITE-seq / 3P scRNA-seq</title><p id=\"p0315\">The 10x 3P v3 protocol was followed according to manufacturer&#x02019;s instructions for cDNA amplification, with the following modifications:<list list-type=\"simple\" id=\"ulist0015\"><list-item id=\"u0030\"><label>&#x02022;</label><p id=\"p0320\">During cDNA amplification, 0.2&#x000a0;&#x003bc;M of ADT additive primer (<bold>5&#x02032;CCTTGGCACCCGAGAATTCC</bold>) and 0.2&#x000a0;&#x003bc;M of HTO additive primer (5&#x02032;GTGACTGGAGTTCAGACGTGTGCTC) were added to the reaction.</p></list-item><list-item id=\"u0035\"><label>&#x02022;</label><p id=\"p0325\">During cDNA cleanup, the supernatant from the 0.6x SPRI cleanup was saved and purified with two rounds of 2x SPRI. The eluate was split and used as template for production of ADT and Hashtag libraries:</p></list-item><list-item id=\"u0040\"><label>&#x02022;</label><p id=\"p0330\">Hashtag libraries were generated by PCR using Kapa Hifi Master Mix, 10&#x000a0;&#x003bc;M 10x Genomics SI-PCR primer (5&#x02032;AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTC), and 10&#x000a0;&#x003bc;M Illumina TruSeq DNA D7xx primer (5&#x02032;CAAGCAGAAGACGGCATACGAGATxxxxxxxxGTGACTGGAGTTCAGACGTGTGC). Following amplification, Hashtag libraries were and cleaned up with 1.6x SPRI.</p></list-item></list></p><p id=\"p0335\">Antibody tag libraries were generated by PCR using Kapa Hifi Master Mix, 10&#x000a0;&#x003bc;M 10x Genomics SI-PCR primer, and 10&#x000a0;&#x003bc;M TruSeq Small RNA RPIx primer (5&#x02032;CAAGCAGAAGACGGCATACGAGxxxxxxxxGTGACTGGAGTTCCTTGGCACCCGAGAATTCCA) Following amplification, Antibody tag libraries were and cleaned up with 1.6x SPRI.</p></sec><sec id=\"sec4.4.3.2\"><title>ECCITE-seq / 5P scRNA-seq / immune receptor:</title><p id=\"p0340\">The 10x Immune Profiling v1 protocol was followed according to manufacturer&#x02019;s instructions for cDNA amplification, with the following modifications:<list list-type=\"simple\" id=\"ulist0020\"><list-item id=\"u0045\"><label>&#x02022;</label><p id=\"p0345\">During cDNA amplification, 0.2&#x000a0;&#x003bc;M each of ADT (<bold>5&#x02032;CCTTGGCACCCGAGAATT<sup>&#x02217;</sup>C<sup>&#x02217;</sup>C)</bold>, HTO (<bold>5&#x02032;GTGACTGGAGTTCAGACGTGTGC<sup>&#x02217;</sup>T<sup>&#x02217;</sup>C)</bold>, and TotalSeq-C additives (5&#x02032; CTCGTGGGCTCGGAGATGTGTATAAGAGACAG) were added to the reaction.</p></list-item><list-item id=\"u0050\"><label>&#x02022;</label><p id=\"p0350\">Post cDNA cleanup, a 0.6x SPRI cleanup was performed, where larger cDNA fragments were kept on the beads, and the smaller tag libraries were retained in the supernatant. From the material retained on the beads, a portion of the eluted material was used to generate TCR &#x003b1;/&#x003b2; libraries (as written in the 10x protocol), BCR libraries (as written in the 10x protocol) and TCR &#x003b3;/&#x003b4; libraries (as written in the 10x protocol for TCR &#x003b1;/&#x003b2;, with these modifications):</p></list-item><list-item id=\"u0055\"><label>&#x02022;</label><p id=\"p0355\">5&#x000a0;&#x003bc;L of cDNA was taken into the initial reaction</p></list-item><list-item id=\"u0060\"><label>&#x02022;</label><p id=\"p0360\">For the first PCR, instead of the TCR1 primer mix provided by 10x genomics, we substituted our own mix consisting of primers 5&#x02032;AGCTTGACAGCATTGTACTTCC and 5&#x02032;TGTGTCGTTAGTCTTCATGGTGTTCC</p></list-item><list-item id=\"u0065\"><label>&#x02022;</label><p id=\"p0365\">For the second PCR, instead of the TCR2 primer mix provided by 10x Genomics, we substituted our own of primers consisting of 5&#x02032;TCCTTCACCAGACAAGCGAC and 5&#x02032;GATCCCAGAATCGTGTTGCTC</p></list-item><list-item id=\"u0070\"><label>&#x02022;</label><p id=\"p0370\">The 0.6X SPRI supernatant remaining following cDNA cleanup was subjected to 2 rounds of 2x SPRI. The eluate was split into three reactions for tag library production:</p></list-item><list-item id=\"u0075\"><label>&#x02022;</label><p id=\"p0375\">Hashtag libraries were created by performing a PCR reaction consisting of Kapa Hifi Master Mix, 10&#x000a0;&#x003bc;M 10x Genomics SI-PCR primer, and 10&#x000a0;&#x003bc;M Illumina TruSeq DNA D7xx primer.</p></list-item><list-item id=\"u0080\"><label>&#x02022;</label><p id=\"p0380\">Antibody libraries (for homemade conjugates) were created by performing a PCR reaction with Kapa Hifi Master Mix, 10&#x000a0;&#x003bc;M 10x Genomics SI-PCR primer, and 10&#x000a0;&#x003bc;M TruSeq Small RNA RPIx primer.</p></list-item><list-item id=\"u0085\"><label>&#x02022;</label><p id=\"p0385\">TotlaSeq-C antibody libraries were created by performing a PCR reaction with 2x Kapa Hifi Master Mix, 10&#x000a0;&#x003bc;M 10x Genomics SI-PCR primer, and 10&#x000a0;&#x003bc;M Nextera indexing primer (CAAGCAGAAGACGGCATACGAGATxxxxxxxxGTCTCGTGGGCTCGGAGATGTGTATAAGAGACAG).</p></list-item></list></p></sec><sec id=\"sec4.4.3.3\"><title>Sequencing</title><p id=\"p0390\">For 3P libraries, the samples were pooled in a ratio of 80% RNA, 12% ADT, and 8% HTO.</p><p id=\"p0395\">For the 5P libraries, the samples were pooled in a ratio of 70% RNA, 12% ADT, 8% HTO, 5% of TCR libraries (with equal amounts of &#x003b1;/&#x003b2; and &#x003b3;/&#x003b4; libraries), and 5% of BCR libraries. 3P and 5P libraries were then pooled together in equal amounts and sequenced on an Illumina Novaseq S4 flowcell.</p></sec></sec><sec id=\"sec4.4.4\"><title>Validation of targeted immunophenotype panels experiments</title><p id=\"p0400\">Commercially available cryopreserved PBMCs (AllCells) were thawed into DMEM with 10% FBS. Two million cells per condition (4 conditions) were spun down in Eppendorf tubes at 4&#x000b0;C for 5&#x000a0;min at 400 <italic>g</italic>, and resuspended in 100&#x000a0;&#x003bc;l PBS with 2% BSA. Each aliquot was incubated for 10&#x000a0;min with 10&#x000a0;&#x003bc;L of FcX block, followed by staining with flow cytometry antibodies (BioLegend) on ice for 30&#x000a0;min. Cells were washed three times with PBS with 2% BSA. Samples were then gated as described below and sorted directly into Buffer RLT (QIAGEN).</p></sec><sec id=\"sec4.4.5\"><title>Antibodies used (all at 5uL per condition unless otherwise noted):</title><p id=\"p0405\"><table-wrap position=\"float\" id=\"undtbl2\"><table frame=\"hsides\" rules=\"groups\"><thead><tr><th>Specificity</th><th>Fluorophore</th><th>Clone</th><th>Note</th></tr></thead><tbody><tr><td>CD3</td><td>AF488</td><td>UCHT1</td><td>10<italic>u</italic>L of antibody used</td></tr><tr><td>CD8</td><td>APC-Cy7</td><td>SK1</td><td/></tr><tr><td>CD4</td><td>AF700</td><td>RPA-T4</td><td/></tr><tr><td>CD57</td><td>PE</td><td>QA17A04</td><td/></tr><tr><td>CD56</td><td>APC</td><td>5.1H11</td><td/></tr><tr><td>CD103</td><td>BV421</td><td>Ber-ACT8</td><td/></tr><tr><td>Integrin 7</td><td>PE</td><td>FIB504</td><td/></tr><tr><td>CD49a</td><td>APC</td><td>TS2/7</td><td>BioLegend</td></tr><tr><td>CD43</td><td>PE</td><td>CD43-10G7</td><td>BioLegend</td></tr></tbody></table></table-wrap></p><p id=\"p0410\">Gating conditions for each of the validation experiments are shown in <xref rid=\"fig4\" ref-type=\"fig\">Figures 4</xref>D and 4E.</p><p id=\"p0415\">Post sorting, samples were each split into quintuplicates, and then cleaned up with 2x SPRI. Samples were then brought into reverse transcription in an adaptation of SMARTseq2 (<xref rid=\"bib60\" ref-type=\"bibr\">Picelli et&#x000a0;al., 2014</xref>) and SCRB-seq (<xref rid=\"bib69\" ref-type=\"bibr\">Soumillon et&#x000a0;al., 2014</xref>) as described here: <ext-link ext-link-type=\"uri\" xlink:href=\"https://dx.doi.org/10.17504/protocols.io.nkgdctw\" id=\"intref0155\">https://dx.doi.org/10.17504/protocols.io.nkgdctw</ext-link>.</p><p id=\"p0420\">The pooled library was sequenced on an Illumina Nextseq (50 R1, 8 index, 34 R2). Post base calling, samples were aligned using a wrapper for DropSeqTools against the human reference hg19 to generate RNA counts matrices.</p><p id=\"p0425\">To assess the agreement between single-cell datasets and bulk-sorted experiments, we examined the top DE genes separating our gated populations in the CITE-seq reference dataset. We next visualized the relative expression of these genes in the heatmaps in <xref rid=\"fig4\" ref-type=\"fig\">Figures 4</xref>D and 4E. The bulk-sorted populations exhibited highly concordant relative expression patterns for DE genes as we observed in CITE-seq data.</p></sec><sec id=\"sec4.4.6\"><title>Flow cytometry analysis of whole blood</title><p id=\"p0430\">Whole blood collected immediately before the first VSV <italic>gag</italic> administration and then 1 and 7&#x000a0;days after was stained in TruCOUNT tubes as previously described (<xref rid=\"bib22\" ref-type=\"bibr\">Elizaga et&#x000a0;al., 2018</xref>; <xref rid=\"bib32\" ref-type=\"bibr\">Hensley et&#x000a0;al., 2012</xref>; <xref rid=\"bib33\" ref-type=\"bibr\">Hensley-McBain et&#x000a0;al., 2014</xref>) using the following antibody staining panel: (antibodies from BD Biosciences, unless otherwise indicated): CD14&#x02013;V450, CD19&#x02013;V450, CD45&#x02013;AmCyan, CD4&#x02013;FITC, CD8&#x02013;PerCP-Cy5.5, CD123&#x02013;PE, HLA-DR&#x02013;ECD (Beckman Coulter), CD86&#x02013;PE-Cy5, CD56&#x02013;PE-Cy7, CD11c&#x02013;APC, CD3&#x02013;Alexa700 and CD16&#x02013;APC-Cy7. We used these measurements in <xref rid=\"fig6\" ref-type=\"fig\">Figures 6</xref>G and 6H to validate changes in cell type abundance that were detected by scRNA-seq.</p></sec><sec id=\"sec4.4.7\"><title>Determination of cellular responses to CMV</title><p id=\"p0435\">Intracellular cytokine staining assays were conducted as described in <xref rid=\"bib44\" ref-type=\"bibr\">Li et&#x000a0;al. (2017)</xref> and the proportion of CD8<sup>+</sup> T&#x000a0;cells expressing IL-2 and/or IFN-&#x003b3; after stimulation with a CMV peptide pool as well as the response call are listed are in <xref rid=\"mmc1\" ref-type=\"supplementary-material\">Table S1</xref>.</p></sec><sec id=\"sec4.4.8\"><title>Mass cytometry</title><p id=\"p0440\">PBMC from patients with nasopharyngeal swab PCR-confirmed COVID-19 and healthy controls were thawed into warm RPMI (HyClone/Thermo Scientific) supplemented with 10% FBS and 0.5&#x000a0;&#x000d7; 106 cells per sample were transferred into a 96-well plate for staining. Cells were stained as previously described in <xref rid=\"bib80\" ref-type=\"bibr\">Vendrame et&#x000a0;al. (2020)</xref>, using the panel described in <xref rid=\"bib52\" ref-type=\"bibr\">McKechnie et&#x000a0;al. (2020)</xref> with the addition of the following antibodies to identify MAIT cells: anti-CD161 (DX12, BD Biosciences) conjugated on 141Pr and TCR V&#x003b1;7.2 (clone 3C10, Biolegend) conjugated on 162Dy. Antibodies were conjugated using MaxPar&#x000ae; X8 Conjugation Kits (Fluidigm, South San Francisco, CA, USA) or purchased pre-conjugated from Fluidigm. With the exception of the antibodies added, the immune profiling panel was premixed and frozen at &#x02212;80&#x000b0;C in order to ensure antibody stability and minimize differential staining between batches as described in <xref rid=\"bib52\" ref-type=\"bibr\">McKechnie et&#x000a0;al. (2020)</xref>. Briefly, cells were washed with PBS (Rockwell) and resuspended in 25&#x000a0;mM cisplatin (Enzo, Farmingdale, NY, USA) for sixty seconds to stain for viability before being quenched with undiluted FBS. Samples were multiplexed by staining with CD45-Pd barcodes as previously described (<xref rid=\"bib53\" ref-type=\"bibr\">Mei et&#x000a0;al., 2015</xref>), washed thoroughly in CyFACS buffer (PBS, 0.1% BSA, 2mM EDTA, 0.05% sodium azide), and pooled into sets of barcodes. Barcoded samples were then stained with all antibodies for 30&#x000a0;min, washed with CyFACS buffer, and fixed in 2% Paraformaldehyde (Electron Microscopy Sciences, Hatfield, PA, USA) for 20&#x000a0;min at room temperature. Fixed cells were permeabilized with 1x eBiosciences Permeabilization Buffer. Manufacturer ThermoFisher Scientific (Waltham, MA). Samples were washed, resuspended in 2% PFA containing iridium intercalator (Fluidigm), and stored at 4&#x000b0;C until acquisition (within 3&#x000a0;days of staining). On the day of acquisition, samples were washed once with PBS and thrice with Milli-Q water before being resuspended in 1&#x000a0;&#x000d7; EQ Beads (Fluidigm) and collected on a Helios mass cytometer (Fluidigm).</p><p id=\"p0445\">Prior to analysis, fcs files were debarcoded and bead-normalized with EQ beads using the Premessa package in the open-source statistical software R as previously described (<xref rid=\"bib24\" ref-type=\"bibr\">Finck et&#x000a0;al., 2013</xref>). FlowJo v10.7.1 was used to visualize the data and used to gate out beads, dead cells, doublets, and cell debris. MAIT cells were identified by expression of CD3, CD161, and TCR V&#x003b1; 7.2 as shown in <xref rid=\"figs7\" ref-type=\"fig\">Figure&#x000a0;S7</xref>.</p></sec><sec id=\"sec4.4.9\"><title>Weighted Nearest Neighbor Analysis</title><p id=\"p0450\">The weighted nearest neighbor (WNN) procedure implemented in Seurat v4 is designed to integrate multiple types of data that are collected in the same cells to define a single unified representation of single-cell multimodal data. For each cell, the procedure learns a set of modality weights, which reflect the relative information content for each data type in that cell. This enables the generation of a WNN graph: for each cell, this graph denotes the most similar cells in the dataset based on a weighted combination of protein and RNA similarities. The WNN graph can be used as input for common downstream analytical tasks including tSNE or UMAP visualization, graph-based clustering, and the identification of developmental trajectories.</p><p id=\"p0455\">Our approach consists of four broad steps, as explained in detail below: (1) Constructing independent <italic>k</italic>-nearest neighbor (KNN) graphs for both modalities. (2) Performing within and across-modality prediction (3) Calculating cell-specific modality weights. (4) Calculating a WNN graph.</p><p id=\"p0460\">All methods are implemented in our open-source R package Seurat (<ext-link ext-link-type=\"uri\" xlink:href=\"https://www.satijalab.org/seurat\" id=\"intref0160\">https://www.satijalab.org/seurat</ext-link>, <ext-link ext-link-type=\"uri\" xlink:href=\"http://https;//www.github.com/satijalab/seurat\" id=\"intref0165\">https;//www.github.com/satijalab/seurat</ext-link>).</p><sec id=\"sec4.4.9.1\"><title>Constructing k-nearest neighbor graphs for each modality</title><p id=\"p0465\">The WNN procedure begins by first applying standard analytical workflows to each modality independently and constructing KNN graphs for each one. In this manuscript we analyze data falling into three categories: measurements of single-cell gene expression, single-cell surface protein expression, and single-cell chromatin accessibility (ATAC-seq). For most analyses in this manuscript, we use a default value of <italic>k</italic>&#x000a0;= 20, which is also the default value of <italic>k</italic> in the standard Seurat clustering workflow. For the analysis of the multimodal PBMC atlas, due to the substantial size of the dataset, we used a value of <italic>k</italic>&#x000a0;= 30. In <xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>, we show that we obtain very similar results from the WNN procedure when varying <italic>k</italic> across a series of values ranging from 10 to 50.</p><p id=\"p0470\">For clarity, we overview the analytical workflows for each data type below:<list list-type=\"simple\" id=\"ulist0025\"><list-item id=\"u0090\"><p id=\"p0475\">Single-cell gene expression: We analyze scRNA-seq data using standard pipelines in Seurat which include normalization, feature selection, and dimensional reduction with PCA. We then construct a KNN graph after dimensional reduction.</p></list-item></list></p><p id=\"p0480\">We emphasize that WNN analysis can leverage any scRNA-seq preprocessing workflow that generates a KNN graph. For example, users can preprocess their scRNA-seq data with a variety of normalization tools including log-normalization, scran (<xref rid=\"bib47\" ref-type=\"bibr\">Lun et&#x000a0;al., 2016</xref>) or SCTransform (<xref rid=\"bib29\" ref-type=\"bibr\">Hafemeister and Satija, 2019</xref>), and can utilize alternative dimensional reduction procedures such as factor analysis or variational autoencoders. In this manuscript, we use workflows that are available in the Seurat package, and detail exact settings for each analysis later in this document.<list list-type=\"simple\" id=\"ulist0030\"><list-item id=\"u0095\"><p id=\"p0485\">Single-cell cell surface protein level expression: We analyze single-cell protein data (representing the quantification of antibody-derived tags (ADTs) in CITE-seq or ASAP-seq data) using a similar workflow to scRNA-seq. We normalize protein expression levels within a cell using the centered-log ratio (CLR) transform, followed by dimensional reduction with PCA, and subsequently construct a KNN graph. Unless otherwise specified, we do not perform feature selection on protein data, and use all measured proteins during dimensional reduction.</p></list-item><list-item id=\"u0100\"><p id=\"p0490\">Single-cell chromatin accessibility: We analyze single-cell ATAC-seq data using our previously described workflow (<xref rid=\"bib73\" ref-type=\"bibr\">Stuart et&#x000a0;al., 2019</xref>), as implemented in the Signac package. We reduced the dimensionality of the scATAC-seq data by performing latent semantic indexing (LSI) on the scATAC-seq peak matrix, as suggested by <xref rid=\"bib17\" ref-type=\"bibr\">Cusanovich et&#x000a0;al. (2018)</xref>. We first computed the term frequency-inverse document frequency (TF-IDF) of the peak matrix by dividing the accessibility of each peak in each cell by the total accessibility in the cell (the &#x0201c;term frequency&#x0201d;), and multiplied this by the inverse accessibility of the peak in the cell population. This step &#x02018;upweights&#x02019; the contribution of highly variable peaks and down-weights peaks that are accessible in all cells. We then multiplied these values by 10,000 and log-transformed this TF-IDF matrix, adding a pseudocount of 1 to avoid computing the log of 0. We decomposed the TF-IDF matrix via SVD to return LSI components, and scaled LSI loadings for each LSI component to mean 0 and standard deviation 1.</p></list-item></list></p><p id=\"p0495\">As described for scRNA-seq analysis, while we use Seurat and Signac functions in this manuscript, any analytical workflow that computes a KNN graph for surface protein or chromatin accessibility data can also be used in the first step of WNN analysis.</p></sec><sec id=\"sec4.4.9.2\"><title>Performing within and cross-modality predictions</title><p id=\"p0500\">Suppose we have a CITE-seq dataset where two modalities, RNA and protein, are measured in each single cell. From the previous step, we define the following:<list list-type=\"simple\" id=\"ulist0035\"><list-item id=\"u0105\"><p id=\"p0505\"><inline-formula><mml:math id=\"M1\" altimg=\"si1.gif\"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>: L2-normalized low-dimensional vector representing the RNA profile for cell <inline-formula><mml:math id=\"M2\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula></p></list-item><list-item id=\"u0110\"><p id=\"p0510\"><inline-formula><mml:math id=\"M3\" altimg=\"si3.gif\"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>: L2-normalized low-dimensional vector representing the protein profile for cell <inline-formula><mml:math id=\"M4\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula></p></list-item><list-item id=\"u0115\"><p id=\"p0515\"><inline-formula><mml:math id=\"M5\" altimg=\"si4.gif\"><mml:mrow><mml:mo>{</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>&#x02026;</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>: the set of k-nearest RNA neighbors for cell <inline-formula><mml:math id=\"M6\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula></p></list-item><list-item id=\"u0120\"><p id=\"p0520\"><inline-formula><mml:math id=\"M7\" altimg=\"si5.gif\"><mml:mrow><mml:mo>{</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>&#x02026;</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>: the set of k-nearest protein neighbors for cell <inline-formula><mml:math id=\"M8\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula></p></list-item></list></p><p id=\"p0525\">We average the low-dimensional profiles of each neighbor set, which represent a prediction for the molecular contents for cell <inline-formula><mml:math id=\"M9\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula> based on their local neighborhoods. We perform both within-modality and cross-modality prediction:</p><p id=\"p0530\">Within-modality prediction:<disp-formula id=\"ufd1\"><mml:math id=\"M10\" altimg=\"si6.gif\"><mml:mrow><mml:msub><mml:mover accent=\"true\"><mml:mi>r</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mfrac><mml:mrow><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mi>k</mml:mi></mml:mfrac><mml:mspace width=\"0.25em\"/><mml:mtext>:</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mtext>prediction&#x000a0;of&#x000a0;RNA&#x000a0;profile&#x000a0;for&#x000a0;cell</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mi>i</mml:mi><mml:mtext>,</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mtext>based&#x000a0;on&#x000a0;RNA&#x000a0;neighbors</mml:mtext></mml:mrow></mml:math></disp-formula><disp-formula id=\"ufd2\"><mml:math id=\"M11\" altimg=\"si7.gif\"><mml:mrow><mml:msub><mml:mover accent=\"true\"><mml:mi>p</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mfrac><mml:mrow><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mi>k</mml:mi></mml:mfrac><mml:mspace width=\"0.25em\"/><mml:mtext>:</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mtext>prediction&#x000a0;of&#x000a0;protein&#x000a0;profile&#x000a0;for&#x000a0;cell</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mi>i</mml:mi><mml:mtext>,</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mtext>based&#x000a0;on&#x000a0;protein&#x000a0;neighbors</mml:mtext></mml:mrow></mml:math></disp-formula>Cross-modality prediction:<disp-formula id=\"ufd3\"><mml:math id=\"M12\" altimg=\"si8.gif\"><mml:mrow><mml:msub><mml:mover accent=\"true\"><mml:mi>r</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mfrac><mml:mrow><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mi>k</mml:mi></mml:mfrac><mml:mtext>:</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mtext>prediction&#x000a0;of&#x000a0;RNA&#x000a0;profile&#x000a0;for&#x000a0;cell</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mi>i</mml:mi><mml:mtext>,</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mtext>based&#x000a0;on&#x000a0;protein&#x000a0;neighbors</mml:mtext></mml:mrow></mml:math></disp-formula><disp-formula id=\"ufd4\"><mml:math id=\"M13\" altimg=\"si9.gif\"><mml:mrow><mml:msub><mml:mover accent=\"true\"><mml:mi>p</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mfrac><mml:mrow><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mi>k</mml:mi></mml:mfrac><mml:mtext>:</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mtext>prediction&#x000a0;of&#x000a0;protein&#x000a0;profile&#x000a0;for&#x000a0;cell</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mi>i</mml:mi><mml:mtext>,</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mtext>based&#x000a0;on&#x000a0;RNA&#x000a0;neighbors</mml:mtext></mml:mrow></mml:math></disp-formula></p></sec><sec id=\"sec4.4.9.3\"><title>Calculating cell-specific modality weights</title><p id=\"p0535\">We next calculate the similarity between predicted values for each cell <inline-formula><mml:math id=\"M14\" altimg=\"si10.gif\"><mml:mrow><mml:msub><mml:mover accent=\"true\"><mml:mi>r</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id=\"M15\" altimg=\"si11.gif\"><mml:mrow><mml:msub><mml:mover accent=\"true\"><mml:mi>p</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, and the actual values <inline-formula><mml:math id=\"M16\" altimg=\"si1.gif\"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id=\"M17\" altimg=\"si3.gif\"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. We first compute Euclidean distances between predicted and actual values, and next convert these to affinities using the exponential kernel utilized in UMAP (<xref rid=\"bib51\" ref-type=\"bibr\">McInnes et&#x000a0;al., 2018</xref>). In <xref rid=\"bib51\" ref-type=\"bibr\">McInnes et&#x000a0;al. (2018)</xref>, the authors demonstrate that the distance between a cell and its first nearest neighbor (&#x02018;local connectivity&#x02019;) functions as distance gap that inflates values in both the numerator and denominator of the exponent. Therefore, they subtract local connectivity from cellular distances when computing the exponential kernel.<disp-formula id=\"ufd5\"><mml:math id=\"M18\" altimg=\"si12.gif\"><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent=\"true\"><mml:mi>r</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mi>max</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent=\"true\"><mml:mi>r</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>&#x003c3;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow><mml:mspace width=\"0.25em\"/><mml:mtext>affinity&#x000a0;between</mml:mtext><mml:mspace width=\"0.25em\"/><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mspace width=\"0.25em\"/><mml:mtext>and&#x000a0;predicted&#x000a0;RNA&#x000a0;profile&#x000a0;</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mtext>based&#x000a0;on&#x000a0;RNA&#x000a0;knn</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id=\"ufd6\"><mml:math id=\"M19\" altimg=\"si13.gif\"><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent=\"true\"><mml:mi>r</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mi>max</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent=\"true\"><mml:mi>r</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>&#x003c3;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow><mml:mspace width=\"0.25em\"/><mml:mtext>affinity&#x000a0;between</mml:mtext><mml:mspace width=\"0.25em\"/><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mspace width=\"0.25em\"/><mml:mtext>and&#x000a0;predicted&#x000a0;RNA&#x000a0;profile&#x000a0;</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mtext>based&#x000a0;on&#x000a0;protein&#x000a0;knn</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id=\"ufd7\"><mml:math id=\"M20\" altimg=\"si14.gif\"><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent=\"true\"><mml:mi>p</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mi>max</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent=\"true\"><mml:mi>p</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>&#x003c3;</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow><mml:mspace width=\"0.25em\"/><mml:mtext>affinity&#x000a0;between</mml:mtext><mml:mspace width=\"0.25em\"/><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mspace width=\"0.25em\"/><mml:mtext>and&#x000a0;predicted&#x000a0;protein&#x000a0;profile&#x000a0;</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mtext>based&#x000a0;on&#x000a0;protein&#x000a0;knn</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id=\"ufd8\"><mml:math id=\"M21\" altimg=\"si15.gif\"><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent=\"true\"><mml:mi>p</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mi>max</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent=\"true\"><mml:mi>p</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>&#x003c3;</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow><mml:mspace width=\"0.25em\"/><mml:mtext>affinity&#x000a0;between</mml:mtext><mml:mspace width=\"0.25em\"/><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mspace width=\"0.25em\"/><mml:mtext>and&#x000a0;predicted&#x000a0;protein&#x000a0;profile&#x000a0;</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mtext>based&#x000a0;on&#x000a0;RNA&#x000a0;knn</mml:mtext><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>In the equations above, <italic>d</italic> represents the Euclidean distance metric, and <inline-formula><mml:math id=\"M22\" altimg=\"si16.gif\"><mml:mrow><mml:msub><mml:mi>&#x003c3;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id=\"M23\" altimg=\"si17.gif\"><mml:mrow><mml:msub><mml:mi>&#x003c3;</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> represent the bandwidth of the RNA and protein kernels for cell <inline-formula><mml:math id=\"M24\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. A commonly used approach is to set the bandwidth of a kernel to reflect the distance between a cell and its <italic>k-</italic>th nearest neighbor, resulting in an adaptive bandwidth that is specific to each cell (<xref rid=\"bib30\" ref-type=\"bibr\">Haghverdi et&#x000a0;al., 2016</xref>; <xref rid=\"bib79\" ref-type=\"bibr\">van Dijk et&#x000a0;al., 2018</xref>). However, the value of <italic>k</italic> used to compute this bandwidth is typically fixed across all cells. We considered that cells originating from rare states should not have the same bandwidth constraint as cells originating from abundant states, and therefore considered a modified approach to select kernel bandwidths.</p><p id=\"p0540\">Our approach is inspired by the concept of large margin nearest neighbors, which aims to identify kernel bandwidths that separate data points in the same class from those in different classes, even if the classes are closely related (<xref rid=\"bib85\" ref-type=\"bibr\">Weinberger and Saul, 2009</xref>). In the context of unsupervised single-cell analysis (where the data points are unlabeled), we aim to identify a kernel bandwidth that groups together cells in the same state, yet divides cells that originate from closely related (but different) states.</p><p id=\"p0545\">Recent work has clearly demonstrated that KNN-graphs are prone to the formation of spurious edges, which represent links between cells that share some similarity molecular profiles, but are not in a matched molecular state (<xref rid=\"bib43\" ref-type=\"bibr\">Levine et&#x000a0;al., 2015</xref>). However, it is possible to identify these spurious edges through the use of the Jaccard metric. This identifies the number of shared nearest neighbors between two cells, thereby exploiting the local density of each data point to separate well-supported from spurious edges.</p><p id=\"p0550\">For each cell <inline-formula><mml:math id=\"M25\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>, we therefore aim to identify the 20 cells in the dataset with the <italic>lowest</italic> non-zero Jaccard similarity. We expect that these represent cells that exhibit some similarity with cell <inline-formula><mml:math id=\"M26\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>, but are unlikely to reside in the same molecular state. If more than 20 cells share the same Jaccard value, we select the 20 with the furthest euclidean distance to cell <inline-formula><mml:math id=\"M27\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. We take the average of the Euclidean distances from cell <inline-formula><mml:math id=\"M28\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula> to the 20 selected cells, and set this as the cell-specific kernel bandwidth.</p><p id=\"p0555\">We next calculate the ratio between the affinities for <inline-formula><mml:math id=\"M29\" altimg=\"si1.gif\"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> with predictions based on RNA neighbors, and predictions based on protein neighbors. A large ratio suggests that the local neighborhood of the cell, as defined by its RNA neighbors, better reflects its molecular state. We calculate the analogous ratio for protein affinities. In both cases, we add a small <inline-formula><mml:math id=\"M30\" altimg=\"si18.gif\"><mml:mrow><mml:mi>&#x003b5;</mml:mi></mml:mrow></mml:math></inline-formula>(10<sup>&#x02212;4</sup>) to the denominator to avoid numerical errors.<disp-formula id=\"ufd9\"><mml:math id=\"M31\" altimg=\"si19.gif\"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent=\"true\"><mml:mi>r</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent=\"true\"><mml:mi>r</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">+</mml:mo><mml:mi>&#x003b5;</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mspace width=\"0.25em\"/><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"goodbreak\">=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent=\"true\"><mml:mi>p</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent=\"true\"><mml:mi>p</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">+</mml:mo><mml:mi>&#x003b5;</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>Finally, we normalize these values with a softmax transformation. The resulting two values are non-negative, and together sum to 1. We refer to these as cell-specific modality weights.<disp-formula id=\"ufd10\"><mml:math id=\"M32\" altimg=\"si20.gif\"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mfrac><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo linebreak=\"badbreak\">+</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mspace width=\"0.25em\"/><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"goodbreak\">=</mml:mo><mml:mfrac><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mo linebreak=\"badbreak\">+</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p></sec><sec id=\"sec4.4.9.4\"><title>Calculating a WNN graph</title><p id=\"p0560\">We leverage the cell-specific modality weights calculated above to define a new similarity metric between any two cells, which reflects a weighted combination of RNA and protein affinities. For two cells <inline-formula><mml:math id=\"M33\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula> and cell <inline-formula><mml:math id=\"M34\" altimg=\"si21.gif\"><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula>, we define their weighted similarity as:<disp-formula id=\"ufd11\"><mml:math id=\"M35\" altimg=\"si22.gif\"><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>w</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"goodbreak\">+</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>We then construct a WNN graph, defined as a KNN graph constructed using this weighted similarity metric. For each cell, we consider the set<disp-formula id=\"ufd12\"><mml:math id=\"M36\" altimg=\"si23.gif\"><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>&#x02026;</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>200</mml:mn></mml:mrow></mml:msub><mml:mo linebreak=\"goodbreak\">&#x0222a;</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>&#x02026;</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>200</mml:mn></mml:mrow></mml:msub><mml:mspace width=\"0.25em\"/><mml:mtext>&#x000a0;and&#x000a0;identify&#x000a0;the&#x000a0;k</mml:mtext><mml:mo>-</mml:mo><mml:mtext>most&#x000a0;similar&#x000a0;cells&#x000a0;within&#x000a0;this&#x000a0;set&#x000a0;based&#x000a0;on&#x000a0;the&#x000a0;weighted&#x000a0;similarity&#x000a0;metric&#x000a0;as&#x000a0;weighted&#x000a0;nearest&#x000a0;neighbors</mml:mtext></mml:mrow></mml:math></disp-formula></p></sec><sec id=\"sec4.4.9.5\"><title>Extending WNN to process more than two simultaneously measured modalities</title><p id=\"p0565\">The WNN method can be generalized to analyze single-cell datasets with three or more simultaneously measured modalities. Briefly, we perform within-modality comparisons for each modality, and extend the concept of cross-modality predictions to all pairwise combinations of modalities. We calculate affinity rations comparing within-modality predictions to cross-modality predictions and normalize these values with a softmax transformation. These ideas are a generalization of the methods described for two modalities, with a full mathematical description below for clarity:</p><p id=\"p0570\">Suppose the single-cell dataset has <italic>M</italic> modalities, we define the following:<list list-type=\"simple\" id=\"ulist0040\"><list-item id=\"u0125\"><p id=\"p0575\"><italic>m, n</italic>: Two different modalities in the dataset <inline-formula><mml:math id=\"M37\" altimg=\"si24.gif\"><mml:mrow><mml:mi>m</mml:mi><mml:mo linebreak=\"goodbreak\" linebreakstyle=\"after\">&#x02208;</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>1,2</mml:mn><mml:mo>,</mml:mo><mml:mo>&#x02026;</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>n</mml:mi><mml:mo linebreak=\"goodbreak\" linebreakstyle=\"after\">&#x02208;</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>1,2</mml:mn><mml:mo>,</mml:mo><mml:mo>&#x02026;</mml:mo><mml:mi>M</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mo linebreak=\"goodbreak\" linebreakstyle=\"after\">&#x02260;</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula>,</p></list-item><list-item id=\"u0130\"><p id=\"p0580\"><inline-formula><mml:math id=\"M38\" altimg=\"si25.gif\"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula>: L2-normalized low-dimensional vector representing the modality <italic>m</italic> profile for cell <inline-formula><mml:math id=\"M39\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula></p></list-item><list-item id=\"u0135\"><p id=\"p0585\"><inline-formula><mml:math id=\"M40\" altimg=\"si26.gif\"><mml:mrow><mml:mo>{</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>&#x02026;</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>: the set of k-nearest neighbors from modality <italic>m</italic> for cell <inline-formula><mml:math id=\"M41\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula></p></list-item></list></p><p id=\"p0590\">Within-modality prediction:<disp-formula id=\"ufd13\"><mml:math id=\"M42\" altimg=\"si27.gif\"><mml:mrow><mml:msubsup><mml:mover accent=\"true\"><mml:mi>X</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mfrac><mml:mrow><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow><mml:mi>k</mml:mi></mml:mfrac><mml:mtext>:</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mtext>prediction&#x000a0;of&#x000a0;&#x000a0;</mml:mtext><mml:msubsup><mml:mtext>X</mml:mtext><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mtext>,&#x000a0;based&#x000a0;on&#x000a0;neighbors&#x000a0;from&#x000a0;modality&#x000a0;</mml:mtext><mml:mi>m</mml:mi></mml:mrow></mml:math></disp-formula>Pairwise cross-modality prediction:<disp-formula id=\"ufd14\"><mml:math id=\"M43\" altimg=\"si28.gif\"><mml:mrow><mml:msubsup><mml:mover accent=\"true\"><mml:mi>X</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mfrac><mml:mrow><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:munderover><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow><mml:mi>k</mml:mi></mml:mfrac><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mo linebreak=\"goodbreak\">&#x02260;</mml:mo><mml:mi>n</mml:mi><mml:mtext>:</mml:mtext><mml:mspace width=\"0.25em\"/><mml:mtext>prediction&#x000a0;of</mml:mtext><mml:mspace width=\"0.25em\"/><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:msubsup><mml:mtext>,&#x000a0;based&#x000a0;on&#x000a0;neighbors&#x000a0;from&#x000a0;modality&#x000a0;</mml:mtext><mml:mi>m</mml:mi></mml:mrow></mml:math></disp-formula>We next calculate the within and cross-modality affinities, <inline-formula><mml:math id=\"M44\" altimg=\"si29.gif\"><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent=\"true\"><mml:mi>X</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id=\"M45\" altimg=\"si30.gif\"><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent=\"true\"><mml:mi>X</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> between within and cross-modality predicted values for each cell <inline-formula><mml:math id=\"M46\" altimg=\"si31.gif\"><mml:mrow><mml:msubsup><mml:mover accent=\"true\"><mml:mi>X</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id=\"M47\" altimg=\"si32.gif\"><mml:mrow><mml:msubsup><mml:mover accent=\"true\"><mml:mi>X</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula>, and the actual values <inline-formula><mml:math id=\"M48\" altimg=\"si25.gif\"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula>.</p><p id=\"p0595\">Within-modality affinity:<disp-formula id=\"ufd15\"><mml:math id=\"M49\" altimg=\"si33.gif\"><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent=\"true\"><mml:mi>X</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mi>max</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent=\"true\"><mml:mi>X</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>&#x003c3;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>Pairwise cross-modality affinity:<disp-formula id=\"ufd16\"><mml:math id=\"M50\" altimg=\"si34.gif\"><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent=\"true\"><mml:mi>X</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mi>max</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent=\"true\"><mml:mi>X</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>&#x003c3;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mo linebreak=\"goodbreak\">&#x02260;</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></disp-formula>Pairwise affinity ratios (we add a small <inline-formula><mml:math id=\"M51\" altimg=\"si18.gif\"><mml:mrow><mml:mi>&#x003b5;</mml:mi></mml:mrow></mml:math></inline-formula>(10<sup>&#x02212;4</sup>) to the denominator to avoid numerical errors):<disp-formula id=\"ufd17\"><mml:math id=\"M52\" altimg=\"si35.gif\"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent=\"true\"><mml:mi>X</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent=\"true\"><mml:mi>X</mml:mi><mml:mo>&#x002c6;</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow><mml:mi>m</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">+</mml:mo><mml:mi>&#x003b5;</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mo linebreak=\"goodbreak\">&#x02260;</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></disp-formula>Finally, we normalize these pairwise affinity ratios with a softmax transformation. The resulting <italic>m</italic> modality weights for each cell are non-negative and together sum to 1.<disp-formula id=\"ufd18\"><mml:math id=\"M53\" altimg=\"si36.gif\"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mo>&#x02211;</mml:mo><mml:mi>n</mml:mi></mml:munder><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:munder><mml:mo>&#x02211;</mml:mo><mml:mi>m</mml:mi></mml:munder><mml:mrow><mml:munder><mml:mo>&#x02211;</mml:mo><mml:mi>n</mml:mi></mml:munder><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mo linebreak=\"goodbreak\">&#x02260;</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></disp-formula>For two cells <inline-formula><mml:math id=\"M54\" altimg=\"si2.gif\"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula> and cell <inline-formula><mml:math id=\"M55\" altimg=\"si21.gif\"><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula>, we define their weighted similarity as:<disp-formula id=\"ufd19\"><mml:math id=\"M56\" altimg=\"si37.gif\"><mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mrow><mml:mi>w</mml:mi><mml:mi>e</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:munder><mml:mo>&#x02211;</mml:mo><mml:mi>m</mml:mi></mml:munder><mml:msub><mml:mi>w</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>&#x003b8;</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>We then construct a WNN graph, defined as a KNN graph constructed using this weighted similarity metric. For each cell, we consider the set <inline-formula><mml:math id=\"M57\" altimg=\"si38.gif\"><mml:mrow><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>&#x02026;</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>200</mml:mn></mml:mrow></mml:msub><mml:mo linebreak=\"goodbreak\" linebreakstyle=\"after\">&#x0222a;</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>&#x02026;</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>200</mml:mn></mml:mrow></mml:msub><mml:mo linebreak=\"goodbreak\" linebreakstyle=\"after\">&#x0222a;</mml:mo><mml:mo>&#x02026;</mml:mo><mml:mo linebreak=\"goodbreak\" linebreakstyle=\"after\">&#x0222a;</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>&#x02026;</mml:mo><mml:mi>k</mml:mi><mml:mi>n</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>200</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and identify the <italic>k</italic>-most similar cells within this set based on the weighted similarity metric as weighted nearest neighbors.</p></sec></sec><sec id=\"sec4.4.10\"><title>Preprocessing details for each dataset</title><sec id=\"sec4.4.10.1\"><title>Cord blood mononuclear cells (CBMC) CITE-seq dataset</title><p id=\"p0600\">This CBMC dataset is a CITE-seq dataset from <xref rid=\"bib71\" ref-type=\"bibr\">Stoeckius et&#x000a0;al. (2017)</xref> and contains 8,617 cells with a panel of ten antibodies. We use the expression matrices as quantified in the original experiment. This experiment includes a small proportion of spiked-in murine 3T3 cells as negative controls. We apply SCTransform (<xref rid=\"bib29\" ref-type=\"bibr\">Hafemeister and Satija, 2019</xref>) to normalize gene expression data, and we apply a CLR transformation to normalize protein data within each cell. We use PCA to reduce the dimensionality of both datasets, taking 30 RNA and 7 protein dimensions to construct the WNN graph.</p></sec><sec id=\"sec4.4.10.2\"><title>Human bone marrow mononuclear cells (BMNC) CITE-seq dataset</title><p id=\"p0605\">The BMNC dataset is a CITE-seq dataset from <xref rid=\"bib73\" ref-type=\"bibr\">Stuart et&#x000a0;al. (2019)</xref>, consisting of 30,672 cells with a panel of 25 antibodies. We use the expression matrices as quantified in the original experiment. For gene expression, in order to facilitate comparisons with other methods, we use standard log-normalization with default parameters in Seurat. We apply a CLR transformation to normalize protein data within each cell. We use PCA to reduce the dimensionality of both datasets, taking 30 RNA and 18 protein dimensions to construct the WNN graph. When performing a targeted re-clustering of T&#x000a0;cell populations (<xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>I), we repeated all preprocessing steps and performed the same procedure on 14,901 cells identified as T&#x000a0;cells.</p></sec><sec id=\"sec4.4.10.3\"><title>ASAP-seq dataset of human PBMC</title><p id=\"p0610\">We used the published human PBMC ASAP-seq dataset from <xref rid=\"bib56\" ref-type=\"bibr\">Mimitou et&#x000a0;al. (2020)</xref>, containing 4,725 cells with a panel of 227 antibodies. We use the ADT expression matrix, ATAC fragment files, and QC parameters from the original publication. We called peaks from the ATAC fragment files using the MACS2 callpeak function (<xref rid=\"bib90\" ref-type=\"bibr\">Zhang et&#x000a0;al., 2008</xref>), and kept all peaks with -LOG10(qvalue) &#x0003e; 5 for the downstream ATAC analysis. We apply TFIDF to normalize ATAC peaks and CLR transformation to normalize protein data within each cell. We use LSI to reduce the dimensionality of ATAC normalized data, and PCA to reduce the dimensionality of protein. Then, we used LSI dimensions 2-50 LSI dimensions (excluding the first dimension as this is typically correlated with technical metrics in ATAC-seq data), and 30 protein PCA dimensions to construct the WNN graph.</p></sec><sec id=\"sec4.4.10.4\"><title>10x multiome ATAC+Gene expression dataset of human PBMC</title><p id=\"p0615\">10x Genomics multiomic (RNA&#x000a0;+ ATAC) data for human PBMCs was obtained from 10X website (<ext-link ext-link-type=\"uri\" xlink:href=\"https://support.10xgenomics.com/single-cell-multiome-atac-gex/datasets\" id=\"intref0170\">https://support.10xgenomics.com/single-cell-multiome-atac-gex/datasets</ext-link>) and was processed using Signac (<xref rid=\"bib74\" ref-type=\"bibr\">Stuart et&#x000a0;al., 2020</xref>) and Seurat. ATAC-seq peaks were then identified for each cell type separately using MACS2, using the function CallPeaks in Signac 1.1.0 with arguments group.by&#x000a0;= &#x02018;celltype&#x02019; and additional.args&#x000a0;= &#x02018;&#x02013;max-gap 50&#x02019;. Fragment counts for each peak were quantified per cell using the FeatureMatrix function in Signac. Per-cell quality control metrics were computed using the TSSEnrichment and NucleosomeSignal functions, and cells retained with a nucleosome signal score&#x000a0;&#x0003c; 2, TSS enrichment score &#x0003e; 1, and total RNA counts&#x000a0;&#x0003c; 100,000 and &#x0003e; 25,000. We apply SCTransform to normalize RNA counts and TFIDF to normalize ATAC peaks. We use LSI to reduce the dimensionality of ATAC data, and PCA to reduce the dimensionality of RNA. Then, we used 2-40 LSI dimensions and 1-40 RNA PCA dimensions to construct the WNN graph.</p></sec><sec id=\"sec4.4.10.5\"><title>SHARE-seq ATAC+Gene expression dataset of mouse skin cells</title><p id=\"p0620\">SHARE-seq data for mouse skin cells was obtained from GEO: <ext-link ext-link-type=\"uri\" xlink:href=\"ncbi-geo:GSE140203\" id=\"intref0175\">GSE140203</ext-link> (<xref rid=\"bib50\" ref-type=\"bibr\">Ma et&#x000a0;al., 2020</xref>), and was processed using Signac and Seurat. We used the ATAC-seq peak calls, peak by cell quantifications, and fragment files from the original publication. We applied SCTransform to normalize RNA counts and TFIDF to normalize ATAC peaks. We used LSI to reduce the dimensionality of ATAC data, and PCA to reduce the dimensionality of RNA. Then, we used LSI dimensions 2-30 (excluding the first dimension as this is typically correlated with technical metrics in ATAC-seq data) and 30 RNA PCA dimensions to construct the WNN graph. Cells are annotated by their original annotations in the <xref rid=\"bib50\" ref-type=\"bibr\">Ma et&#x000a0;al. (2020)</xref> except for four basal subpopulations which are annotated by WNN-derived clusters. Motif analyses for the ASAP-seq, 10x RNA<sup>+</sup>ATAC and SHARE-seq datasets followed the suggested workflow described at <ext-link ext-link-type=\"uri\" xlink:href=\"https://satijalab.org/signac/articles/motif_vignette.html\" id=\"intref0180\">https://satijalab.org/signac/articles/motif_vignette.html</ext-link></p></sec><sec id=\"sec4.4.10.6\"><title>PBMC CITE-seq datasets of HIV Vaccine Trials Network samples</title><p id=\"p0625\">Alignment and expression quantification: We applied standard pipelines to initially align and quantify the CITE-seq datasets newly generated for this manuscript. For both the 10x v3 (3&#x02032; scRNaseq) and 10x Immune Profiling Solution (5&#x02032; scRNA-seq), we used Cell Ranger 3.1.0 to align reads to the GRCh38 human genome with default settings. To quantify libraries of hashtag oligos (HTO) from cell hashing, or antibody-derived tags (ADT) from CITE-seq, we used Alevin (<xref rid=\"bib70\" ref-type=\"bibr\">Srivastava et&#x000a0;al., 2019</xref>). A dictionary of barcode sequences for each antibody clone is included in <xref rid=\"mmc2\" ref-type=\"supplementary-material\">Table S2</xref>.</p><p id=\"p0630\">Quality control and doublet removal: We considered all cells that were detected in our RNA-seq, cell hashing, and ADT libraries. We first filtered out cells with that were outliers for the number of detected features from these modalities. We removed cells with&#x000a0;&#x0003c; 500 detected genes, but also removed cells where we detected an aberrantly high number of features (more than 6,000 genes, more than 50,000 ADT reads, or more than 10,000 ADT reads), particularly to avoid clumps of antibodies that can occasionally attach to cells. We used our previously described hashing-based doublet detection strategy (<xref rid=\"bib72\" ref-type=\"bibr\">Stoeckius et&#x000a0;al., 2018</xref>), implemented in HTODemux, to identify doublets that represent two or more cells representing different samples. Inspired by the scrublet package (<xref rid=\"bib88\" ref-type=\"bibr\">Wolock et&#x000a0;al., 2019</xref>), we implemented a strategy to further remove doublets that may originate within the same sample (and would therefore not be identified through cell hashing). We first constructed a KNN graph based on the ADT data. For each cell, we examined the percentage of neighbors that had been marked by HTODemux as doublets. If this percentage exceeded 20%, we reasoned that the cell&#x02019;s molecular profile was similar to a verified doublet, and therefore removed it from further analysis.</p><p id=\"p0635\">Sample integration (10X 3&#x02032; CITE-seq experiments): To facilitate the identification of shared cell types across datasets, we applied our previously developed &#x02018;anchor&#x02019; workflow (<xref rid=\"bib73\" ref-type=\"bibr\">Stuart et&#x000a0;al., 2019</xref>) to integrate the datasets. We partitioned the dataset into 24 groups, each corresponding to one of the original samples representing one of eight volunteers, and one of three time points. To integrate the gene expression values, we first separately normalized each of the 24 groups using SCTransform, and applied the reciprocal PCA workflow, which is optimized for integration tasks with large numbers of samples and cells. When performing integration, we designated the unvaccinated cells (day 0), as reference datasets. We integrated the protein measurements across samples using the same workflow, but after performing normalization within each cell using a CLR transformation.</p><p id=\"p0640\">We reduce the dimensionality of the integrated gene expression and integrated protein datasets via PCA. We use the top 40 and 50 dimensions respectively to construct KNN graphs from the RNA and protein modalities, which is used as input to the WNN procedure described above.</p><p id=\"p0645\">Clustering and annotation: To cluster our multimodal dataset, we first used the KNN graph based on the weighted RNA and protein similarities (referred to as the WNN graph), to calculate the Jaccard index (neighborhood overlap) between every pair of cells. This distance represents the edge weight in a shared nearest neighbor graph (SNN), which we used as input to the graph-based smart local moving (SLM) algorithm (<xref rid=\"bib84\" ref-type=\"bibr\">Waltman and Van Eck, 2013</xref>). We initially clustered cells at a high resolution (resolution&#x000a0;= 5), and performed differential expression (see below) on all pairs of clusters for both RNA and protein markers. We merged clusters that did not exhibit clear evidence of separation, or where the only differentially expressed features represented ribosomal genes or mitochondrial genes. In some cases (particularly for extremely rare cell types that required a higher resolution to be correctly annotated in our clustering), we increased the granularity of our clustering by subsetting cells in an individual cluster, and rerunning SLM on this subgraph. In our final annotations, we considered 57 total clusters.</p><p id=\"p0650\">We note that the annotation process requires careful consideration of both known RNA and protein markers, as well as those that are discovered through unsupervised analysis. We placed clusters into eight broad groups (Level 1 annotations: CD4<sup>+</sup> T&#x000a0;cells, CD8<sup>+</sup> T&#x000a0;cells, Unconventional T, B cells, Natural Killer (NK) cells, Monocytes, Dendritic Cells (DC), and Other (consisting of progenitors and additional rare populations expressing erythroid or platelet lineage markers). We further subdivided these groups into 30 Level 2 annotation categories representing well-described subtypes of human immune cells: CD4<sup>+</sup> T Naive, CD4<sup>+</sup> T Central Memory (TCM), CD4<sup>+</sup> T Effector Memory (TEM), CD8<sup>+</sup> TEM, etc., all thirty subtypes are listed at <ext-link ext-link-type=\"uri\" xlink:href=\"https://azimuth.hubmapconsortium.org/\" id=\"intref0185\">https://azimuth.hubmapconsortium.org/</ext-link>). Our 57 clusters fall into subsets of these categories (i.e., CD8<sup>+</sup> TCM_1, CD8<sup>+</sup> TCM_2, etc.), and represent Level 3 annotations with the highest level of granularity (all listed in the legend for <xref rid=\"fig3\" ref-type=\"fig\">Figure&#x000a0;3</xref>C). We report markers for each of our Level 3 annotations in <xref rid=\"figs4\" ref-type=\"fig\">Figure&#x000a0;S4</xref>.</p></sec></sec><sec id=\"sec4.4.11\"><title>Simulated addition of protein noise</title><p id=\"p0655\">In <xref rid=\"fig2\" ref-type=\"fig\">Figure&#x000a0;2</xref>C, we perform a robustness analysis to explore the effects of artificially reducing the information content in one data type. To achieve this, we add increasing amounts of random noise to the protein data, immediately prior to running PCA. The amount of noise added is generated independently for each element in the matrix, and is drawn from a Gaussian distribution with mean zero and increasing standard deviation (sd&#x000a0;= 0.5, 1, 1.5, 2, 3, 4, 5). After adding noise, we repeated the WNN procedure.</p></sec><sec id=\"sec4.4.12\"><title>Comparing transcriptomic heterogeneity of WNN, RNA, and ADT-derived neighborhoods</title><p id=\"p0660\">In addition, we sought to ensure that the incorporation of protein information in the WNN graph does not come at the expense of identifying transcriptomically congruent neighborhoods. We therefore examined the WNN-derived neighborhoods for bone marrow cells originating from clusters with predominantly high protein weights, such as regulatory T&#x000a0;cells, and compared them with RNA-derived neighborhoods. If the WNN procedure is performing well, gene expression levels within these neighborhoods should represent a &#x02018;homogeneous&#x02019; population with low levels of variability. We therefore compared levels of gene variability between RNA-derived and WNN-derived neighborhoods.</p><p id=\"p0665\">We utilized two different measures to quantify the heterogeneity of gene expression within a local neighborhood (<xref rid=\"sec4\" ref-type=\"sec\">STAR Methods</xref>). Inspired by the M3Drop (<xref rid=\"bib4\" ref-type=\"bibr\">Andrews and Hemberg, 2019</xref>), we identified &#x02018;variable&#x02019; features in a group of cells based on unexpectedly high &#x02018;dropout&#x02019; rates after controlling for a gene&#x02019;s average expression. We found that WNN-derived neighborhoods were most reflective of a homogeneous population, as evidenced by the number of genes that exhibited variable levels of expression within each neighbor set (<xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>). We obtained similar results when computing a measure of &#x02018;excess variance&#x02019;, defined as the amount of residual variance observed for each gene after controlling for the mean-variance relationship inherent in single-cell data, and also when repeating these analyses using progenitor subpopulations with high RNA modality weights (<xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>). Moreover, we found that differentially expressed genes between cell states exhibited nearly identical fold-changes in either WNN-derived or RNA-derived clusters (<xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>).</p><p id=\"p0670\">Specifically, in <xref rid=\"figs2\" ref-type=\"fig\">Figures S2</xref>J&#x02013;S2M, we test whether the WNN graph generates local neighborhoods that exhibit congruent (or &#x02018;homogeneous&#x02019;) levels of gene expression. In particular, we sought to confirm this for subpopulations comprising cells with high protein modality weights, such as the 297 regulatory T&#x000a0;cells in our BMNC dataset. We therefore considered three sets of 5,940 (297 <sup>&#x02217;</sup> k&#x000a0;= 20) neighbor cells, defined using either the RNA, ADT, or WNN neighbor graphs, and attempted to identify &#x02018;variable&#x02019; genes within these cells as a test of heterogeneity.</p><p id=\"p0675\">In Figure&#x000a0;S2J, we plot the relationship between pseudobulk-level gene expression and &#x02018;dropout&#x02019; rate, as inspired by M3Drop (<xref rid=\"bib4\" ref-type=\"bibr\">Andrews and Hemberg, 2019</xref>). We fit an average trendline using the ksmooth function from package stats with a Gaussian kernel and default parameters, and calculate the residual of each gene to the fitted line. We consider genes with a residual &#x0003e; 0.1 to be variable. In <xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>L we perform the same analysis, but utilize the standard deviation of gene expression across single cells as an alternative metric to &#x02018;dropout&#x02019; rate for defining variable genes (residual from trendline &#x0003e; 0.5). We repeat the same analysis for HSC (defined by high RNA modality weights) in <xref rid=\"figs2\" ref-type=\"fig\">Figures S2</xref>K and S2M.</p></sec><sec id=\"sec4.4.13\"><title>Differential analysis for clusters defined by RNA and WNN</title><p id=\"p0680\">In <xref rid=\"figs2\" ref-type=\"fig\">Figures S2</xref>N and S2O, we compare the results of differential expression after performing clustering on either the RNA-derived or WNN-derived nearest neighbor graphs for the BMNC dataset. We first cluster cells by the RNA or WNN nearest neighbor graphs respectively, and annotate clusters based on their molecular profiles. While some clusters (for example, regulatory T&#x000a0;cells) were only identified in the WNN-derived clusters, we did identify shared populations across both cluster sets including: CD4 Naive T, CD4 Memory T, CD8 Naive T, B Naive, B Memory, HSC, and LMPP subgroups. For both the WNN-derived and RNA-derived cluster sets, we performed four transcriptome-based differential expression tests (HSC versus LMPP, CD8 Naive versus CD4 Naive, CD4 Memory versus CD4 Naive, Naive B versus Memory B) using the Wilcoxon test implemented in Seurat. For genes identified as differentially expressed (adjusted p value&#x000a0;&#x0003c; 0.01) in either the WNN-derived or RNA-derived cluster sets, we compared the difference in observed magnitude of log2 fold changes (<xref rid=\"figs2\" ref-type=\"fig\">Figures S2</xref>N and S2O).</p></sec><sec id=\"sec4.4.14\"><title>Comparisons with MOFA+ and totalVI</title><p id=\"p0685\">In order to assess the performance of our WNN method alongside other recently proposed multimodal integration tools, we compared the results of WNN, Total Variational Inference (totalVI version 0.6.7) (<xref rid=\"bib26\" ref-type=\"bibr\">Gayoso et&#x000a0;al., 2019</xref>) and Multi-omics factor analysis v2 (MOFA+ version 1.1) (<xref rid=\"bib5\" ref-type=\"bibr\">Argelaguet et&#x000a0;al., 2020</xref>), on the BMNC dataset. We followed the recommended settings and workflows for both methods, and further describe parameter choices below.</p><p id=\"p0690\">For totalVI, we use the RNA and ADT counts matrices as input. We use the subsample_genes function to select 4000 variable genes, and used 500 epochs for model training, as suggested in the totalVI tutorial (https:// scvi-tools.org/en/stable/tutorials/totalvi.html). All other parameters were set to default settings. We identified nearest neighbors, and performed UMAP visualization on the learned latent space.</p><p id=\"p0695\">For MOFA+, we used the same normalization method as Seurat to facilitate direct comparison. As recommended in the MOFA+ tutorial (<ext-link ext-link-type=\"uri\" xlink:href=\"https://raw.githack.com/bioFAM/MOFA2_tutorials/master/R_tutorials/10x_scRNA_scATAC.html\" id=\"intref0190\">https://raw.githack.com/bioFAM/MOFA2_tutorials/master/R_tutorials/10x_scRNA_scATAC.html</ext-link>), we used the z-scored data (&#x02018;scaled&#x02019; data) from the two assays as view1 and view2 for MOFA+. All other parameters were set to default or recommended settings. We identified nearest neighbors, and performed UMAP visualization based on the learned factors.</p><p id=\"p0700\">The UMAP plots in <xref rid=\"figs2\" ref-type=\"fig\">Figures S2</xref>A and S2B show the results of all three methods (we also include independent RNA and protein analyses in Seurat for comparison). The plots show that the methods generally reveal similar sets of cell types, but with important differences. For example, regulatory T&#x000a0;cells, defined by CD25 expression, are only separated in the WNN UMAP. <xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>B demonstrates that this is due to the fact that CD25<sup>+</sup> cells only form a distinct cluster in WNN analysis.</p><p id=\"p0705\">In order to move beyond visualization and quantify the performance of each method, we averaged the CD25 expression level for the calculated multimodal neighbors of each cell, returning a vector of predicted values. We quantified the performance of the method using the correlation (Pearson; <xref rid=\"fig2\" ref-type=\"fig\">Figure&#x000a0;2</xref>D, Spearman; <xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>), between predicted and measured values. For CD25, WNN analysis achieved the highest correlation, as cells that are CD25<sup>+</sup> are correctly identified as neighbors with other cells that are CD25<sup>+</sup> in the dataset. We repeated this analysis for all protein features, and found that, WNN analysis consistently achieved the highest correlation. We repeated the analysis for all transcriptomic features as well (<xref rid=\"figs2\" ref-type=\"fig\">Figure&#x000a0;S2</xref>) and observed similar performance for all methods. We note that transcriptomic correlations were also much lower, likely due to the substantial technical noise inherent to scRNA-seq data.</p></sec><sec id=\"sec4.4.15\"><title>TCR analysis</title><p id=\"p0710\">To generate clonotype information for the 10X 5&#x02032; samples, TCR&#x003b1;&#x003b2; and TCR&#x003b3;&#x003b4; fastq files were processed with cellranger vdj version 3.0.2 against the GRCh38 v2.0.0 reference as provided by 10x Genomics. Clonotype information was then manually added into Seurat as cell metadata, allowing us to explore the relationship between annotated cell type, molecular state, and TCR sequence. We obtained productive TCR &#x0237a;/&#x003b2; sequences representing 16,060 distinct clones, where all cells within a clone share the exact same CDR3&#x0237a; and CDR3&#x003b2; sequences.</p></sec><sec id=\"sec4.4.16\"><title>Identifying targeted immunophenotype panels</title><p id=\"p0715\">For each of our 57 clusters, we aimed to identify a reduced set of antibodies that could enrich for cells in this molecular state. We utilized forward feature selection with balanced logistic regression to identify targeted surface protein markers for each cell type. This represents an iterative process where we successively add markers based on a greedy algorithm aiming to maximize the classification power of logistic regression. Prior to initializing the procedure, we randomly downsampled cells within abundant cell states to ensure that no cluster made up more than 5% of all cells in the dataset. We used the implementation for logistic regression with 5-fold cross validation in the boot R package (<xref rid=\"bib10\" ref-type=\"bibr\">Canty and Ripley, 2020</xref>). We ran ten rounds of forward selection, allowing us to design panels of one-ten immunophenotypic markers for each cell type. To enhance the interpretability of these panels, we required the first five markers selected to be positive markers. These panels are reported in <xref rid=\"mmc3\" ref-type=\"supplementary-material\">Table S3</xref>. We used each panel to enrich for our 57 clusters &#x02018;<italic>in silico</italic>&#x02019;, using logistic regression with a decision boundary of 0.5 to set our gates. We report the enrichment, precision, and recall for each panel in <xref rid=\"mmc3\" ref-type=\"supplementary-material\">Table S3</xref>.</p></sec><sec id=\"sec4.4.17\"><title>Gradient analysis for NK and B cells</title><p id=\"p0720\">In <xref rid=\"fig5\" ref-type=\"fig\">Figures 5</xref>G, 5H, and <xref rid=\"figs5\" ref-type=\"fig\">S5</xref>, we identify genes whose expression level is correlated with a cell&#x02019;s position along a molecular gradient defined by a single protein. For example, in <xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>G, we ordered cells along a gradient defined by CD16 protein expression. We then calculated Moran&#x02019;s I, a spatial autocorrelation metric proposed to identify trajectory-dependent genes in Monocle3 (<xref rid=\"bib12\" ref-type=\"bibr\">Cao et&#x000a0;al., 2019</xref>), to identify correlated genes. We plot a representative subset of these features in <xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>G. We generate these plots by ordering cells on the x axis based on their expression level for CD16 protein, and apply the ksmooth function from package stats with default bandwidth and parameters (<xref rid=\"bib77\" ref-type=\"bibr\">R Development Core Team, 2013</xref>) to calculate smoothed gene expression levels across the trajectory. We utilize the same approach for trajectory analyses based on CD38 and CD27.</p></sec><sec id=\"sec4.4.18\"><title>Supervised principal component analysis for multimodal data</title><p id=\"p0725\">Due to the inherent levels of noise in single-cell RNA-seq, techniques such as PCA are often used to reduce the dimensionality of the dataset. PCA identifies correlated modules of genes, whose heterogeneous expression represent the largest sources of variance in the dataset. PCA is an unsupervised dimensional reduction technique, and while the correlated gene modules may typically represent markers of heterogeneous cell states in the dataset, they may also represent unwanted sources of variation related to technical noise, cell cycle state, or random fluctuations.</p><p id=\"p0730\">We therefore considered the application of supervised principal component analysis (sPCA) to our multimodal dataset. sPCA is a generalization of PCA that can be used not only for unsupervised learning, but also for regression and classification problems (<xref rid=\"bib6\" ref-type=\"bibr\">Barshan et&#x000a0;al., 2011</xref>). While PCA will identify the directions that explain maximal variance in the source data, sPCA can help pinpoint sources of variation that are of the greatest interest. To accomplish this, sPCA takes as input a kernel which describes the similarity between any two cells based on a response outcome. We set this kernel to represent the Jaccard distances derived from our WNN graph, as this considers the response outcome to be the weighted combination of RNA and protein profiles. sPCA will then estimate a set of principal components that have maximal dependence on the response variable (<xref rid=\"bib6\" ref-type=\"bibr\">Barshan et&#x000a0;al., 2011</xref>). These components should represent the optimal transcriptomic modules that can be used to separate the cell types defined in our multimodal dataset. Therefore, the sPCA procedure can identify the set of principal components that can transform the data in a single modality to best capture the structure in a multimodal dataset. We emphasize that sPCA takes as input a cell-cell similarity kernel, but does not require cells to be labeled or placed into discrete clusters. Therefore, it can capture both discrete and continuous sources of variation in a multimodal dataset.</p><p id=\"p0735\">Formally, sPCA transforms the dataset to maximize the dependency with the response variable. We implement the method described in <xref rid=\"bib6\" ref-type=\"bibr\">Barshan et&#x000a0;al. (2011)</xref>, where the Hilbert-Schmidt Independence Criterion (HSIC) is used as the dependency measure. To apply this method in the context of single cell multimodal data, we define the following:<list list-type=\"simple\" id=\"ulist0045\"><list-item id=\"u0140\"><p id=\"p0740\"><italic>X</italic>: data matrix for gene expression measurements</p></list-item><list-item id=\"u0145\"><p id=\"p0745\"><italic>Y</italic>: data matrix for protein measurements.</p></list-item><list-item id=\"u0150\"><p id=\"p0750\"><italic>U</italic>: Transformation of <italic>X</italic> (for example, a set of principal components)</p></list-item><list-item id=\"u0155\"><p id=\"p0755\"><italic>K:</italic> Kernel derived from <italic>U</italic>, describes the cell-cell similarity in <italic>X</italic></p></list-item><list-item id=\"u0160\"><p id=\"p0760\"><italic>L</italic>: Kernel derived from the WNN graph, and describes the cell-cell similarity based on a weighted combination of <italic>X</italic> and <italic>Y</italic></p></list-item></list></p><p id=\"p0765\">The HSIC between two kernels <italic>K</italic> and <italic>L</italic> is:<disp-formula id=\"ufd20\"><mml:math id=\"M58\" altimg=\"si39.gif\"><mml:mrow><mml:mi>H</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mi>C</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>K</mml:mi><mml:mo>,</mml:mo><mml:mi>L</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mfrac><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>K</mml:mi><mml:mi>H</mml:mi><mml:mi>L</mml:mi><mml:mi>H</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>The goal of the sPCA is to identify <italic>U</italic> that maximizes <inline-formula><mml:math id=\"M59\" altimg=\"si40.gif\"><mml:mrow><mml:mi>H</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mi>C</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>K</mml:mi><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula><disp-formula id=\"ufd21\"><mml:math id=\"M60\" altimg=\"si41.gif\"><mml:mrow><mml:mrow><mml:mi>H</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mi>C</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>U</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>X</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:msup><mml:mi>U</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>X</mml:mi><mml:mo>,</mml:mo><mml:mi>L</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo linebreak=\"badbreak\">=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mfrac><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>U</mml:mi><mml:msup><mml:mi>U</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>X</mml:mi><mml:mi>H</mml:mi><mml:mi>L</mml:mi><mml:mi>H</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo linebreak=\"newline\">=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo linebreak=\"badbreak\">&#x02212;</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mfrac><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>U</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>X</mml:mi><mml:mi>H</mml:mi><mml:mi>L</mml:mi><mml:mi>H</mml:mi><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>U</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula>As described in described in <xref rid=\"bib6\" ref-type=\"bibr\">Barshan et&#x000a0;al. (2011)</xref>, the optimization problem reduces to:<disp-formula id=\"ufd22\"><mml:math id=\"M61\" altimg=\"si42.gif\"><mml:mtable columnalign=\"left\"><mml:mtr><mml:mtd><mml:munder><mml:mtext>argmax</mml:mtext><mml:mi>U</mml:mi></mml:munder><mml:mspace width=\"1em\"/><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mfenced><mml:mrow><mml:msup><mml:mi>U</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>X</mml:mi><mml:mi>H</mml:mi><mml:mi>L</mml:mi><mml:mi>H</mml:mi><mml:msup><mml:mi>X</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>U</mml:mi></mml:mrow></mml:mfenced></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>s</mml:mi><mml:mi>u</mml:mi><mml:mi>b</mml:mi><mml:mi>j</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mspace width=\"0.5em\"/><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mspace width=\"0.5em\"/><mml:msup><mml:mi>U</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>U</mml:mi><mml:mo>=</mml:mo><mml:mi>I</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>where H is the centering matrix <italic>H</italic><sub><italic>ij</italic></sub>\n<italic>= I &#x02013; n</italic><sup><italic>-1</italic></sup><italic>ee</italic><sup><italic>T</italic></sup>.</p><p id=\"p0770\">This optimization problem has a closed form solution. <italic>U</italic> represents the eigenvectors of matrix <italic>XHLHX</italic><sup><italic>T</italic></sup>, based on the top <italic>d</italic> eigenvalues, where <italic>d</italic> represents the desired number of components. Each vector in <italic>U</italic> describes the relative importance for each gene in defining this component (i.e, <italic>U</italic> represents a set of feature component loadings).</p></sec><sec id=\"sec4.4.19\"><title>Mapping query datasets to a multimodal reference</title><p id=\"p0775\">We compute the sPCA transformation described above for our reference dataset, and can subsequently project this transformation onto any query dataset consisting of PBMC. This enables us to perform supervised analysis of the query datasets. Since our sPCA was computed based on a reference defined by a large number of cells and antibodies, this transformation will likely be more informative than an unsupervised PCA computed on a new scRNA-seq query. This transformation should therefore be more capable of separating cell types in the query dataset. As a secondary benefit, projecting the sPCA transformation onto a query dataset places the query in the same low-dimensional space as the reference. This provides a starting point to integrate the two datasets, which can assist in the visualization and annotation of the query as described below.</p></sec><sec id=\"sec4.4.20\"><title>Reference-based Integration for query datasets</title><p id=\"p0780\">In <xref rid=\"bib73\" ref-type=\"bibr\">Stuart et&#x000a0;al. (2019)</xref>, we demonstrate a workflow to identify reference-based transfer &#x02018;anchors&#x02019; between reference and query datasets. Briefly, this workflow first projects a transformation calculated on the reference dataset onto the query. The method next identifies mutual nearest neighbors (<xref rid=\"bib31\" ref-type=\"bibr\">Haghverdi et&#x000a0;al., 2018</xref>) between the reference and query datasets, based on this L2-normalized low-dimensional space. These anchors can be used to transfer discrete or continuous data from the reference onto the query. For cell annotation (transfer of discrete label form reference to query), each query cell is assigned a label based on a weighted vote classifier, where each anchor provides a vote that is weighted by its similarity to the query cell. When classifying cells in this manuscript, we apply the same workflow, but use the sPCA transformation described above for projection.</p><p id=\"p0785\">In <xref rid=\"bib73\" ref-type=\"bibr\">Stuart et&#x000a0;al. (2019)</xref>, we also provide methods to leverage an existing set of anchors in order to modify the underlying gene-expression levels, allowing shared cell types to cluster together across experiments. We apply a similar workflow here. However, instead of correcting values in high-dimensional space, we correct in low-dimensional space. This substantially improves the speed of the method. Moreover, at the conclusion of this procedure, we have placed the query dataset in the same low-dimensional representation (defined by the sPCA transformation) as the reference.</p><p id=\"p0790\">Having placed both the query and reference dataset in the same space, we have two options to visualize the query dataset. The first is that we can project the query data onto the same UMAP projection as has been previously computed. To accomplish this, we use the umap_transform functionality implemented in the R uwot package, which enables new points to be adding to an existing embedding. We use this approach to project query datasets onto the reference-defined visualization shown in <xref rid=\"fig3\" ref-type=\"fig\">Figure&#x000a0;3</xref>D. Together, these methods enable a fully automated pipeline to leverage a multimodal single-cell reference to annotate and visualize new single-cell query datasets, even if only the transcriptome was measured. To facilitate users applying this approach to interpret their own datasets from either healthy or diseased PBMC, we have provided a web application (<ext-link ext-link-type=\"uri\" xlink:href=\"https://azimuth.hubmapconsortium.org/\" id=\"intref0195\">https://azimuth.hubmapconsortium.org/</ext-link>) to automate these analyses.</p><p id=\"p0795\">A second option for visualization is to compute a new (&#x02018;de-novo&#x02019;) UMAP visualization, which can be computed after merging the reference and query datasets together. For the analysis of the COVID-19 dataset (<xref rid=\"bib86\" ref-type=\"bibr\">Wilk et&#x000a0;al., 2020</xref>), we compute both visualizations. The reference-based UMAP is shown in <xref rid=\"fig7\" ref-type=\"fig\">Figure&#x000a0;7</xref>D, while the de-novo UMAP is shown in <xref rid=\"figs7\" ref-type=\"fig\">Figure&#x000a0;S7</xref>. One advantage of the de-novo approach is that it can help to visualize populations in the query that cannot be effectively represented in the reference. For example, the <xref rid=\"bib86\" ref-type=\"bibr\">Wilk et&#x000a0;al. (2020)</xref> dataset contains subsets of neutrophils, activated granulocytes that were not captured in our reference, as well as subpopulations of monocytes whose expression profiles are heavily perturbed in COVID-19 samples. In the reference-based visualization, the umap_transform functions aims to embed these cells adjacent to their closest neighbors in the reference, which often places these cells at the boundary of cell clusters. In the de-novo visualization, all three of these populations remain distinct from reference cells even after integration (<xref rid=\"figs7\" ref-type=\"fig\">Figure&#x000a0;S7</xref>). We encourage users to compute both to understand how their dataset can be interpreted in light of a reference, and also to flag any particular populations that may not be well represented.</p><p id=\"p0800\">We leverage this reference-based mapping workflow to interpret the 5&#x02032; scRNA-seq datasets generated for this manuscript. We use the same QC, normalization, and doublet filtration procedures to analyze the 5&#x02032; data as described earlier in this section. We apply the reference-based integrative analysis procedures described above to project the 5&#x02032; scRNA-seq data onto the UMAP visualization defined by the 3&#x02032; dataset, and also to transfer a discrete label. The annotation and projected UMAP are shown in <xref rid=\"figs5\" ref-type=\"fig\">Figure&#x000a0;S5</xref>F, while the UMAP visualization with annotated clonotype structures is shown in <xref rid=\"fig5\" ref-type=\"fig\">Figure&#x000a0;5</xref>K.</p><p id=\"p0805\">Similarly, we applied the same pipeline to map the CITE-seq datasets from (<xref rid=\"bib41\" ref-type=\"bibr\">Kotliarov et&#x000a0;al., 2020</xref>). We downloaded the dataset at <ext-link ext-link-type=\"uri\" xlink:href=\"https://doi.org/10.35092/yhjc.c.4753772\" id=\"intref0200\">https://doi.org/10.35092/yhjc.c.4753772</ext-link>, applied SCTransform normalization, and repeated the mapping procedure applied above. While the dataset contains measurements for 82 proteins alongside the transcriptome, we used only the transcriptome for reference mapping and the transfer of Level 2 annotations. This allowed us to use the withheld protein data for benchmarking with scArches (version 0.1.2) (<xref rid=\"bib45\" ref-type=\"bibr\">Lotfollahi et&#x000a0;al., 2020</xref>), as shown in <xref rid=\"figs7\" ref-type=\"fig\">Figure&#x000a0;S7</xref>.</p></sec><sec id=\"sec4.4.21\"><title>Benchmarking Seurat reference-mapping with scArches</title><p id=\"p0810\">To run scArches, we followed the tutorial released by the authors. We first integrated our 24 3&#x02032; scRNA-seq samples into a reference atlas, using the same variable genes as used in the WNN analysis. We obtained poor results with the default nb loss function, and as suggested in the tutorial, tried the sse loss function as an alternative. We trained the scArches model using recommended parameter settings of 150 epochs and a batch size of 128, and next mapped query cells onto the reference using recommended parameters in the tutorial. To facilitate fair comparisons between our reference mapping workflow and scArches, we forced both methods to return the most likely annotation for each query cell.</p><p id=\"p0815\">We note the extensive challenges in benchmarking reference-based annotation workflows in the absence of ground-truth cell labels. By withholding the protein data from consideration during the mapping process, we can use the protein measurements as an independent assessment of prediction quality. For 35,619 cells (67.1%), Seurat and scArches returned the same annotation. For the remaining 17,480 query cells, the two methods returned two divergent annotations (for example, suppose that Seurat annotated the cell as CD4 Treg, and scArches annotated as NK). In the reference dataset, we calculated the protein centroids for the CD4 Treg and NK clusters. We then calculated the Pearson correlation between these centroids, and the protein values for the individual cell. If the cell&#x02019;s protein levels exhibit a high correlation with the centroid of CD4 Treg, but a low correlation with the centroid of NK, this suggests that the Treg annotation is correct. This metric and approach are inspired by scmap (<xref rid=\"bib39\" ref-type=\"bibr\">Kiselev et&#x000a0;al., 2018</xref>). Essentially, in cases where two methods disagree based on an RNA classification, we attempt to classify the cell based on its protein levels to see if there is strong evidence for one annotation versus another. In 79.4% of cases, we observe stronger support for the Seurat annotation (<xref rid=\"figs7\" ref-type=\"fig\">Figure&#x000a0;S7</xref>E).</p></sec></sec><sec id=\"sec4.5\"><title>Quantification and statistical analysis</title><sec id=\"sec4.5.1\"><title>Differential abundance of cell types across experimental conditions</title><p id=\"p0820\">In <xref rid=\"fig6\" ref-type=\"fig\">Figures 6</xref>E and 6F, we analyze the composition of samples at different time points, and aim to find cell states whose abundance changes during the response. For Level 1 annotations, for each of the 24 samples, we calculated the percentage of each cell state in each sample, and ran two paired Wilcoxon tests: day 0 versus day 3, and day 0 versus day7. No cell states exhibited significant changes. To search for more subtle changes, we calculated the relative abundance of all 30 Level 2 annotations in each sample within each Level 1 group (for example, for each sample we calculated the fraction of CD14<sup>+</sup> monocytes within the total pool of sample monocytes). These values were used as input to two paired Wilcoxon tests: day 0 versus day 3, and day 0 versus day7. We detected significant shifts (p&#x000a0;&#x0003c; 0.05) for three clusters, visualized for the 10X 3&#x02032; samples in <xref rid=\"fig6\" ref-type=\"fig\">Figure&#x000a0;6</xref>F, with independent support for each of the signals in the 10X 5&#x02032; datasets (<xref rid=\"figs6\" ref-type=\"fig\">Figure&#x000a0;S6</xref>).</p></sec><sec id=\"sec4.5.2\"><title>Identifying differentially expressed genes across cell types and experimental time points</title><p id=\"p0825\">In this manuscript (for example, <xref rid=\"fig4\" ref-type=\"fig\">Figure&#x000a0;4</xref>A), we identify differentially expressed (DE) genes and proteins that represent biomarkers of different cell states, or represent specific responses across experimental conditions. We used the wilcoxauc method from presto (<xref rid=\"bib40\" ref-type=\"bibr\">Korsunsky et&#x000a0;al., 2019</xref>) to identify DE genes and proteins, reporting markers with adjusted p value&#x000a0;&#x0003c; 10<sup>&#x02212;5</sup>. For space considerations, we typically report only the top 20 markers in each heatmap, and sort genes first by adjusted p value and next by log fold-change to determine the top markers.</p></sec><sec id=\"sec4.5.3\"><title>Perturbation score</title><p id=\"p0830\">In <xref rid=\"fig6\" ref-type=\"fig\">Figure&#x000a0;6</xref>A, we aim to identify the cell types whose molecular state exhibits significant changes during the response to vaccination. We note that when calculating DE genes and proteins within a cell state, across experimental time points, the statistical power of these per-gene tests is heavily dependent on the abundance of the cell state. We therefore considered an alternative metric, the &#x02018;perturbation score&#x02019; as described in <xref rid=\"bib58\" ref-type=\"bibr\">Papalexi et&#x000a0;al. (2020)</xref>, which quantifies the magnitude of the response across the transcriptome. To briefly summarize, we perform the following procedure to quantify the response for cells at day 3 versus day 0 for each cell state. We first identify a set of genes that exhibit initial evidence of differential expression across time points, but may not achieve statistical significance after multiple-testing correction (adjusted p value&#x000a0;&#x0003c; 0.1). We compute the pseudobulk expression of these genes after grouping cells by experimental time point, generating a vector representing the average expression of these genes for day 0 cells, and a second vector representing the average expression at day 3 cells. We define the &#x02018;perturbation vector&#x02019; for this cell state as the difference between these two vectors, normalized to length 1. Finally, we project the transcriptome of each cell onto this vector and quantify the magnitude of this projection. We find that this approach helps to prioritize cell types that exhibit robust responses, particularly when comparing populations with vastly different abundances.</p></sec><sec id=\"sec4.5.4\"><title>Additional resources</title><p id=\"p0835\">Installation instructions, tutorials, and documentation for Seurat v4 are available at <ext-link ext-link-type=\"uri\" xlink:href=\"https://www.satijalab.org/seurat\" id=\"intref0205\">https://www.satijalab.org/seurat</ext-link>.</p></sec></sec></sec></body><back><ref-list id=\"cebib0010\"><title>References</title><ref id=\"bib1\"><element-citation publication-type=\"journal\" id=\"sref1\"><person-group person-group-type=\"author\"><name><surname>Abel</surname><given-names>A.M.</given-names></name><name><surname>Yang</surname><given-names>C.</given-names></name><name><surname>Thakar</surname><given-names>M.S.</given-names></name><name><surname>Malarkannan</surname><given-names>S.</given-names></name></person-group><article-title>Natural Killer Cells: Development, Maturation, and Clinical Utilization</article-title><source>Front. Immunol.</source><volume>9</volume><year>2018</year><fpage>1869</fpage><pub-id pub-id-type=\"pmid\">30150991</pub-id></element-citation></ref><ref id=\"bib2\"><element-citation publication-type=\"journal\" id=\"sref2\"><person-group person-group-type=\"author\"><name><surname>Alquicira-Hernandez</surname><given-names>J.</given-names></name><name><surname>Powell</surname><given-names>J.E.</given-names></name></person-group><article-title>Nebulosa recovers single cell gene expression signals by kernel density estimation</article-title><source>bioRxiv</source><year>2020</year><pub-id pub-id-type=\"doi\">10.1101/2020.09.29.315879</pub-id></element-citation></ref><ref id=\"bib3\"><element-citation publication-type=\"journal\" id=\"sref3\"><person-group person-group-type=\"author\"><name><surname>Andreeff</surname><given-names>M.</given-names></name><name><surname>Beck</surname><given-names>J.D.</given-names></name><name><surname>Darzynkiewicz</surname><given-names>Z.</given-names></name><name><surname>Traganos</surname><given-names>F.</given-names></name><name><surname>Gupta</surname><given-names>S.</given-names></name><name><surname>Melamed</surname><given-names>M.R.</given-names></name><name><surname>Good</surname><given-names>R.A.</given-names></name></person-group><article-title>RNA content in human lymphocyte subpopulations</article-title><source>Proc. Natl. Acad. Sci. USA</source><volume>75</volume><year>1978</year><fpage>1938</fpage><lpage>1942</lpage><pub-id pub-id-type=\"pmid\">306108</pub-id></element-citation></ref><ref id=\"bib4\"><element-citation publication-type=\"journal\" id=\"sref4\"><person-group person-group-type=\"author\"><name><surname>Andrews</surname><given-names>T.S.</given-names></name><name><surname>Hemberg</surname><given-names>M.</given-names></name></person-group><article-title>M3Drop: dropout-based feature selection for scRNASeq</article-title><source>Bioinformatics</source><volume>35</volume><year>2019</year><fpage>2865</fpage><lpage>2867</lpage><pub-id pub-id-type=\"pmid\">30590489</pub-id></element-citation></ref><ref id=\"bib5\"><element-citation publication-type=\"journal\" id=\"sref5\"><person-group person-group-type=\"author\"><name><surname>Argelaguet</surname><given-names>R.</given-names></name><name><surname>Arnol</surname><given-names>D.</given-names></name><name><surname>Bredikhin</surname><given-names>D.</given-names></name><name><surname>Deloro</surname><given-names>Y.</given-names></name><name><surname>Velten</surname><given-names>B.</given-names></name><name><surname>Marioni</surname><given-names>J.C.</given-names></name><name><surname>Stegle</surname><given-names>O.</given-names></name></person-group><article-title>MOFA+: a statistical framework for comprehensive integration of multi-modal single-cell data</article-title><source>Genome Biol.</source><volume>21</volume><year>2020</year><fpage>111</fpage><pub-id pub-id-type=\"pmid\">32393329</pub-id></element-citation></ref><ref id=\"bib6\"><element-citation publication-type=\"journal\" id=\"sref6\"><person-group person-group-type=\"author\"><name><surname>Barshan</surname><given-names>E.</given-names></name><name><surname>Ghodsi</surname><given-names>A.</given-names></name><name><surname>Azimifar</surname><given-names>Z.</given-names></name><name><surname>Jahromi</surname><given-names>M.Z.</given-names></name></person-group><article-title>Supervised principal component analysis: Visualization, classification and regression on subspaces and submanifolds</article-title><source>Pattern Recognit.</source><volume>44</volume><year>2011</year><fpage>1357</fpage><lpage>1371</lpage></element-citation></ref><ref id=\"bib7\"><element-citation publication-type=\"journal\" id=\"sref7\"><person-group person-group-type=\"author\"><name><surname>Bendall</surname><given-names>S.C.</given-names></name><name><surname>Simonds</surname><given-names>E.F.</given-names></name><name><surname>Qiu</surname><given-names>P.</given-names></name><name><surname>Amir</surname><given-names>A.D.</given-names></name><name><surname>Krutzik</surname><given-names>P.O.</given-names></name><name><surname>Finck</surname><given-names>R.</given-names></name><name><surname>Bruggner</surname><given-names>R.V.</given-names></name><name><surname>Melamed</surname><given-names>R.</given-names></name><name><surname>Trejo</surname><given-names>A.</given-names></name><name><surname>Ornatsky</surname><given-names>O.I.</given-names></name></person-group><article-title>Single-cell mass cytometry of differential immune and drug responses across a human hematopoietic continuum</article-title><source>Science</source><volume>332</volume><year>2011</year><fpage>687</fpage><lpage>696</lpage><pub-id pub-id-type=\"pmid\">21551058</pub-id></element-citation></ref><ref id=\"bib8\"><element-citation publication-type=\"journal\" id=\"sref8\"><person-group person-group-type=\"author\"><name><surname>Bodenmiller</surname><given-names>B.</given-names></name><name><surname>Zunder</surname><given-names>E.R.</given-names></name><name><surname>Finck</surname><given-names>R.</given-names></name><name><surname>Chen</surname><given-names>T.J.</given-names></name><name><surname>Savig</surname><given-names>E.S.</given-names></name><name><surname>Bruggner</surname><given-names>R.V.</given-names></name><name><surname>Simonds</surname><given-names>E.F.</given-names></name><name><surname>Bendall</surname><given-names>S.C.</given-names></name><name><surname>Sachs</surname><given-names>K.</given-names></name><name><surname>Krutzik</surname><given-names>P.O.</given-names></name><name><surname>Nolan</surname><given-names>G.P.</given-names></name></person-group><article-title>Multiplexed mass cytometry profiling of cellular states perturbed by small-molecule regulators</article-title><source>Nat. Biotechnol.</source><volume>30</volume><year>2012</year><fpage>858</fpage><lpage>867</lpage><pub-id pub-id-type=\"pmid\">22902532</pub-id></element-citation></ref><ref id=\"bib9\"><element-citation publication-type=\"journal\" id=\"sref9\"><person-group person-group-type=\"author\"><name><surname>Bull</surname><given-names>M.</given-names></name><name><surname>Lee</surname><given-names>D.</given-names></name><name><surname>Stucky</surname><given-names>J.</given-names></name><name><surname>Chiu</surname><given-names>Y.L.</given-names></name><name><surname>Rubin</surname><given-names>A.</given-names></name><name><surname>Horton</surname><given-names>H.</given-names></name><name><surname>McElrath</surname><given-names>M.J.</given-names></name></person-group><article-title>Defining blood processing parameters for optimal detection of cryopreserved antigen-specific responses for HIV vaccine trials</article-title><source>J.&#x000a0;Immunol. Methods</source><volume>322</volume><year>2007</year><fpage>57</fpage><lpage>69</lpage><pub-id pub-id-type=\"pmid\">17382342</pub-id></element-citation></ref><ref id=\"bib10\"><element-citation publication-type=\"book\" id=\"sref10\"><person-group person-group-type=\"author\"><name><surname>Canty</surname><given-names>A.</given-names></name><name><surname>Ripley</surname><given-names>B.</given-names></name></person-group><chapter-title>boot: Bootstrap R (S-Plus) functions. R package version 1.3-25</chapter-title><year>2020</year><comment><ext-link ext-link-type=\"uri\" xlink:href=\"https://CRAN.R-project.org/package=boot\" id=\"interref0010\">https://CRAN.R-project.org/package=boot</ext-link></comment></element-citation></ref><ref id=\"bib11\"><element-citation publication-type=\"journal\" id=\"sref11\"><person-group person-group-type=\"author\"><name><surname>Cao</surname><given-names>J.</given-names></name><name><surname>Cusanovich</surname><given-names>D.A.</given-names></name><name><surname>Ramani</surname><given-names>V.</given-names></name><name><surname>Aghamirzaie</surname><given-names>D.</given-names></name><name><surname>Pliner</surname><given-names>H.A.</given-names></name><name><surname>Hill</surname><given-names>A.J.</given-names></name><name><surname>Daza</surname><given-names>R.M.</given-names></name><name><surname>McFaline-Figueroa</surname><given-names>J.L.</given-names></name><name><surname>Packer</surname><given-names>J.S.</given-names></name><name><surname>Christiansen</surname><given-names>L.</given-names></name></person-group><article-title>Joint profiling of chromatin accessibility and gene expression in thousands of single cells</article-title><source>Science</source><volume>361</volume><year>2018</year><fpage>1380</fpage><lpage>1385</lpage><pub-id pub-id-type=\"pmid\">30166440</pub-id></element-citation></ref><ref id=\"bib12\"><element-citation publication-type=\"journal\" id=\"sref12\"><person-group person-group-type=\"author\"><name><surname>Cao</surname><given-names>J.</given-names></name><name><surname>Spielmann</surname><given-names>M.</given-names></name><name><surname>Qiu</surname><given-names>X.</given-names></name><name><surname>Huang</surname><given-names>X.</given-names></name><name><surname>Ibrahim</surname><given-names>D.M.</given-names></name><name><surname>Hill</surname><given-names>A.J.</given-names></name><name><surname>Zhang</surname><given-names>F.</given-names></name><name><surname>Mundlos</surname><given-names>S.</given-names></name><name><surname>Christiansen</surname><given-names>L.</given-names></name><name><surname>Steemers</surname><given-names>F.J.</given-names></name></person-group><article-title>The single-cell transcriptional landscape of mammalian organogenesis</article-title><source>Nature</source><volume>566</volume><year>2019</year><fpage>496</fpage><lpage>502</lpage><pub-id pub-id-type=\"pmid\">30787437</pub-id></element-citation></ref><ref id=\"bib13\"><element-citation publication-type=\"journal\" id=\"sref13\"><person-group person-group-type=\"author\"><name><surname>Chen</surname><given-names>H.</given-names></name><name><surname>Ye</surname><given-names>F.</given-names></name><name><surname>Guo</surname><given-names>G.</given-names></name></person-group><article-title>Revolutionizing immunology with single-cell RNA sequencing</article-title><source>Cell. Mol. Immunol.</source><volume>16</volume><year>2019</year><fpage>242</fpage><lpage>249</lpage><pub-id pub-id-type=\"pmid\">30796351</pub-id></element-citation></ref><ref id=\"bib14\"><element-citation publication-type=\"journal\" id=\"sref14\"><person-group person-group-type=\"author\"><name><surname>Chen</surname><given-names>S.</given-names></name><name><surname>Lake</surname><given-names>B.B.</given-names></name><name><surname>Zhang</surname><given-names>K.</given-names></name></person-group><article-title>High-throughput sequencing of the transcriptome and chromatin accessibility in the same cell</article-title><source>Nat. Biotechnol.</source><volume>37</volume><year>2019</year><fpage>1452</fpage><lpage>1457</lpage><pub-id pub-id-type=\"pmid\">31611697</pub-id></element-citation></ref><ref id=\"bib15\"><element-citation publication-type=\"journal\" id=\"sref15\"><person-group person-group-type=\"author\"><name><surname>Clark</surname><given-names>S.J.</given-names></name><name><surname>Argelaguet</surname><given-names>R.</given-names></name><name><surname>Kapourani</surname><given-names>C.A.</given-names></name><name><surname>Stubbs</surname><given-names>T.M.</given-names></name><name><surname>Lee</surname><given-names>H.J.</given-names></name><name><surname>Alda-Catalinas</surname><given-names>C.</given-names></name><name><surname>Krueger</surname><given-names>F.</given-names></name><name><surname>Sanguinetti</surname><given-names>G.</given-names></name><name><surname>Kelsey</surname><given-names>G.</given-names></name><name><surname>Marioni</surname><given-names>J.C.</given-names></name></person-group><article-title>scNMT-seq enables joint profiling of chromatin accessibility DNA methylation and transcription in single cells</article-title><source>Nat. Commun.</source><volume>9</volume><year>2018</year><fpage>781</fpage><pub-id pub-id-type=\"pmid\">29472610</pub-id></element-citation></ref><ref id=\"bib16\"><element-citation publication-type=\"journal\" id=\"sref16\"><person-group person-group-type=\"author\"><name><surname>Corgnac</surname><given-names>S.</given-names></name><name><surname>Boutet</surname><given-names>M.</given-names></name><name><surname>Kfoury</surname><given-names>M.</given-names></name><name><surname>Naltet</surname><given-names>C.</given-names></name><name><surname>Mami-Chouaib</surname><given-names>F.</given-names></name></person-group><article-title>The Emerging Role of CD8<sup>+</sup> Tissue Resident Memory T (T<sub>RM</sub>) Cells in Antitumor Immunity: A Unique Functional Contribution of the CD103 Integrin</article-title><source>Front. Immunol.</source><volume>9</volume><year>2018</year><fpage>1904</fpage><pub-id pub-id-type=\"pmid\">30158938</pub-id></element-citation></ref><ref id=\"bib17\"><element-citation publication-type=\"journal\" id=\"sref17\"><person-group person-group-type=\"author\"><name><surname>Cusanovich</surname><given-names>D.A.</given-names></name><name><surname>Hill</surname><given-names>A.J.</given-names></name><name><surname>Aghamirzaie</surname><given-names>D.</given-names></name><name><surname>Daza</surname><given-names>R.M.</given-names></name><name><surname>Pliner</surname><given-names>H.A.</given-names></name><name><surname>Berletch</surname><given-names>J.B.</given-names></name><name><surname>Filippova</surname><given-names>G.N.</given-names></name><name><surname>Huang</surname><given-names>X.</given-names></name><name><surname>Christiansen</surname><given-names>L.</given-names></name><name><surname>DeWitt</surname><given-names>W.S.</given-names></name></person-group><article-title>A Single-Cell Atlas of In&#x000a0;Vivo Mammalian Chromatin Accessibility</article-title><source>Cell</source><volume>174</volume><year>2018</year><fpage>1309</fpage><lpage>1324.e18</lpage><pub-id pub-id-type=\"pmid\">30078704</pub-id></element-citation></ref><ref id=\"bib18\"><element-citation publication-type=\"journal\" id=\"sref18\"><person-group person-group-type=\"author\"><name><surname>Demirkan</surname><given-names>N.C.</given-names></name><name><surname>Colakoglu</surname><given-names>N.</given-names></name><name><surname>D&#x000fc;zcan</surname><given-names>E.</given-names></name></person-group><article-title>Value of p53 protein in biological behavior of basal cell carcinoma and in normal epithelia adjacent to carcinomas</article-title><source>Pathol. Oncol. Res.</source><volume>6</volume><year>2000</year><fpage>272</fpage><lpage>274</lpage><pub-id pub-id-type=\"pmid\">11173659</pub-id></element-citation></ref><ref id=\"bib19\"><element-citation publication-type=\"journal\" id=\"sref19\"><person-group person-group-type=\"author\"><name><surname>Diggins</surname><given-names>K.E.</given-names></name><name><surname>Ferrell</surname><given-names>P.B.</given-names><suffix>Jr.</suffix></name><name><surname>Irish</surname><given-names>J.M.</given-names></name></person-group><article-title>Methods for discovery and characterization of cell subsets in high dimensional mass cytometry data</article-title><source>Methods</source><volume>82</volume><year>2015</year><fpage>55</fpage><lpage>63</lpage><pub-id pub-id-type=\"pmid\">25979346</pub-id></element-citation></ref><ref id=\"bib20\"><element-citation publication-type=\"journal\" id=\"sref20\"><person-group person-group-type=\"author\"><name><surname>Ding</surname><given-names>J.</given-names></name><name><surname>Adiconis</surname><given-names>X.</given-names></name><name><surname>Simmons</surname><given-names>S.K.</given-names></name><name><surname>Kowalczyk</surname><given-names>M.S.</given-names></name><name><surname>Hession</surname><given-names>C.C.</given-names></name><name><surname>Marjanovic</surname><given-names>N.D.</given-names></name><name><surname>Hughes</surname><given-names>T.K.</given-names></name><name><surname>Wadsworth</surname><given-names>M.H.</given-names></name><name><surname>Burks</surname><given-names>T.</given-names></name><name><surname>Nguyen</surname><given-names>L.T.</given-names></name></person-group><article-title>Systematic comparison of single-cell and single-nucleus RNA-sequencing methods</article-title><source>Nat. Biotechnol.</source><volume>38</volume><year>2020</year><fpage>737</fpage><lpage>746</lpage><pub-id pub-id-type=\"pmid\">32341560</pub-id></element-citation></ref><ref id=\"bib21\"><element-citation publication-type=\"journal\" id=\"sref21\"><person-group person-group-type=\"author\"><name><surname>Efremova</surname><given-names>M.</given-names></name><name><surname>Teichmann</surname><given-names>S.A.</given-names></name></person-group><article-title>Computational methods for single-cell omics across modalities</article-title><source>Nat. Methods</source><volume>17</volume><year>2020</year><fpage>14</fpage><lpage>17</lpage><pub-id pub-id-type=\"pmid\">31907463</pub-id></element-citation></ref><ref id=\"bib22\"><element-citation publication-type=\"journal\" id=\"sref22\"><person-group person-group-type=\"author\"><name><surname>Elizaga</surname><given-names>M.L.</given-names></name><name><surname>Li</surname><given-names>S.S.</given-names></name><name><surname>Kochar</surname><given-names>N.K.</given-names></name><name><surname>Wilson</surname><given-names>G.J.</given-names></name><name><surname>Allen</surname><given-names>M.A.</given-names></name><name><surname>Tieu</surname><given-names>H.V.N.</given-names></name><name><surname>Frank</surname><given-names>I.</given-names></name><name><surname>Sobieszczyk</surname><given-names>M.E.</given-names></name><name><surname>Cohen</surname><given-names>K.W.</given-names></name><name><surname>Sanchez</surname><given-names>B.</given-names></name><collab>NIAID HIV Vaccine Trials Network (HVTN) 087 Study Team</collab></person-group><article-title>Safety and tolerability of HIV-1 multiantigen pDNA vaccine given with IL-12 plasmid DNA via electroporation, boosted with a recombinant vesicular stomatitis virus HIV Gag vaccine in healthy volunteers in a randomized, controlled clinical trial</article-title><source>PLoS ONE</source><volume>13</volume><year>2018</year><fpage>e0202753</fpage><pub-id pub-id-type=\"pmid\">30235286</pub-id></element-citation></ref><ref id=\"bib23\"><element-citation publication-type=\"journal\" id=\"sref23\"><person-group person-group-type=\"author\"><name><surname>Epstein</surname><given-names>E.H.</given-names></name></person-group><article-title>Basal cell carcinomas: attack of the hedgehog</article-title><source>Nat. Rev. Cancer</source><volume>8</volume><year>2008</year><fpage>743</fpage><lpage>754</lpage><pub-id pub-id-type=\"pmid\">18813320</pub-id></element-citation></ref><ref id=\"bib24\"><element-citation publication-type=\"journal\" id=\"sref24\"><person-group person-group-type=\"author\"><name><surname>Finck</surname><given-names>R.</given-names></name><name><surname>Simonds</surname><given-names>E.F.</given-names></name><name><surname>Jager</surname><given-names>A.</given-names></name><name><surname>Krishnaswamy</surname><given-names>S.</given-names></name><name><surname>Sachs</surname><given-names>K.</given-names></name><name><surname>Fantl</surname><given-names>W.</given-names></name><name><surname>Pe&#x02019;er</surname><given-names>D.</given-names></name><name><surname>Nolan</surname><given-names>G.P.</given-names></name><name><surname>Bendall</surname><given-names>S.C.</given-names></name></person-group><article-title>Normalization of mass cytometry data with bead standards</article-title><source>Cytometry A</source><volume>83</volume><year>2013</year><fpage>483</fpage><lpage>494</lpage><pub-id pub-id-type=\"pmid\">23512433</pub-id></element-citation></ref><ref id=\"bib25\"><element-citation publication-type=\"journal\" id=\"sref25\"><person-group person-group-type=\"author\"><name><surname>Gaiti</surname><given-names>F.</given-names></name><name><surname>Chaligne</surname><given-names>R.</given-names></name><name><surname>Gu</surname><given-names>H.</given-names></name><name><surname>Brand</surname><given-names>R.M.</given-names></name><name><surname>Kothen-Hill</surname><given-names>S.</given-names></name><name><surname>Schulman</surname><given-names>R.C.</given-names></name><name><surname>Grigorev</surname><given-names>K.</given-names></name><name><surname>Risso</surname><given-names>D.</given-names></name><name><surname>Kim</surname><given-names>K.T.</given-names></name><name><surname>Pastore</surname><given-names>A.</given-names></name></person-group><article-title>Epigenetic evolution and lineage histories of chronic lymphocytic leukaemia</article-title><source>Nature</source><volume>569</volume><year>2019</year><fpage>576</fpage><lpage>580</lpage><pub-id pub-id-type=\"pmid\">31092926</pub-id></element-citation></ref><ref id=\"bib26\"><element-citation publication-type=\"journal\" id=\"sref26\"><person-group person-group-type=\"author\"><name><surname>Gayoso</surname><given-names>A.</given-names></name><name><surname>Lopez</surname><given-names>R.</given-names></name><name><surname>Steier</surname><given-names>Z.</given-names></name><name><surname>Regier</surname><given-names>J.</given-names></name><name><surname>Streets</surname><given-names>A.</given-names></name><name><surname>Yosef</surname><given-names>N.</given-names></name></person-group><article-title>A Joint Model of RNA Expression and Surface Protein Abundance in Single Cells</article-title><source>bioRxiv</source><year>2019</year><pub-id pub-id-type=\"doi\">10.1101/791947</pub-id></element-citation></ref><ref id=\"bib27\"><element-citation publication-type=\"journal\" id=\"sref27\"><person-group person-group-type=\"author\"><name><surname>Gomes</surname><given-names>T.</given-names></name><name><surname>Teichmann</surname><given-names>S.A.</given-names></name><name><surname>Talavera-L&#x000f3;pez</surname><given-names>C.</given-names></name></person-group><article-title>Immunology Driven by Large-Scale Single-Cell Sequencing</article-title><source>Trends Immunol.</source><volume>40</volume><year>2019</year><fpage>1011</fpage><lpage>1021</lpage><pub-id pub-id-type=\"pmid\">31645299</pub-id></element-citation></ref><ref id=\"bib28\"><element-citation publication-type=\"journal\" id=\"sref28\"><person-group person-group-type=\"author\"><name><surname>Grimaldi</surname><given-names>D.</given-names></name><name><surname>Le Bourhis</surname><given-names>L.</given-names></name><name><surname>Sauneuf</surname><given-names>B.</given-names></name><name><surname>Dechartres</surname><given-names>A.</given-names></name><name><surname>Rousseau</surname><given-names>C.</given-names></name><name><surname>Ouaaz</surname><given-names>F.</given-names></name><name><surname>Milder</surname><given-names>M.</given-names></name><name><surname>Louis</surname><given-names>D.</given-names></name><name><surname>Chiche</surname><given-names>J.-D.</given-names></name><name><surname>Mira</surname><given-names>J.-P.</given-names></name></person-group><article-title>Specific MAIT cell behaviour among innate-like T lymphocytes in critically ill patients with severe infections</article-title><source>Intensive Care Med.</source><volume>40</volume><year>2014</year><fpage>192</fpage><lpage>201</lpage><pub-id pub-id-type=\"pmid\">24322275</pub-id></element-citation></ref><ref id=\"bib29\"><element-citation publication-type=\"journal\" id=\"sref29\"><person-group person-group-type=\"author\"><name><surname>Hafemeister</surname><given-names>C.</given-names></name><name><surname>Satija</surname><given-names>R.</given-names></name></person-group><article-title>Normalization and variance stabilization of single-cell RNA-seq data using regularized negative binomial regression</article-title><source>Genome Biol.</source><volume>20</volume><year>2019</year><fpage>296</fpage><pub-id pub-id-type=\"pmid\">31870423</pub-id></element-citation></ref><ref id=\"bib30\"><element-citation publication-type=\"journal\" id=\"sref30\"><person-group person-group-type=\"author\"><name><surname>Haghverdi</surname><given-names>L.</given-names></name><name><surname>B&#x000fc;ttner</surname><given-names>M.</given-names></name><name><surname>Wolf</surname><given-names>F.A.</given-names></name><name><surname>Buettner</surname><given-names>F.</given-names></name><name><surname>Theis</surname><given-names>F.J.</given-names></name></person-group><article-title>Diffusion pseudotime robustly reconstructs lineage branching</article-title><source>Nat. Methods</source><volume>13</volume><year>2016</year><fpage>845</fpage><lpage>848</lpage><pub-id pub-id-type=\"pmid\">27571553</pub-id></element-citation></ref><ref id=\"bib31\"><element-citation publication-type=\"journal\" id=\"sref31\"><person-group person-group-type=\"author\"><name><surname>Haghverdi</surname><given-names>L.</given-names></name><name><surname>Lun</surname><given-names>A.T.L.</given-names></name><name><surname>Morgan</surname><given-names>M.D.</given-names></name><name><surname>Marioni</surname><given-names>J.C.</given-names></name></person-group><article-title>Batch effects in single-cell RNA-sequencing data are corrected by matching mutual nearest neighbors</article-title><source>Nat. Biotechnol.</source><volume>36</volume><year>2018</year><fpage>421</fpage><lpage>427</lpage><pub-id pub-id-type=\"pmid\">29608177</pub-id></element-citation></ref><ref id=\"bib32\"><element-citation publication-type=\"journal\" id=\"sref32\"><person-group person-group-type=\"author\"><name><surname>Hensley</surname><given-names>T.R.</given-names></name><name><surname>Easter</surname><given-names>A.B.</given-names></name><name><surname>Gerdts</surname><given-names>S.E.</given-names></name><name><surname>De Rosa</surname><given-names>S.C.</given-names></name><name><surname>Heit</surname><given-names>A.</given-names></name><name><surname>McElrath</surname><given-names>M.J.</given-names></name><name><surname>Andersen-Nissen</surname><given-names>E.</given-names></name></person-group><article-title>Enumeration of major peripheral blood leukocyte populations for multicenter clinical trials using a whole blood phenotyping assay</article-title><source>J.&#x000a0;Vis. Exp.</source><volume>4302</volume><year>2012</year><fpage>e4302</fpage></element-citation></ref><ref id=\"bib33\"><element-citation publication-type=\"journal\" id=\"sref33\"><person-group person-group-type=\"author\"><name><surname>Hensley-McBain</surname><given-names>T.</given-names></name><name><surname>Heit</surname><given-names>A.</given-names></name><name><surname>De Rosa</surname><given-names>S.C.</given-names></name><name><surname>McElrath</surname><given-names>M.J.</given-names></name><name><surname>Andersen-Nissen</surname><given-names>E.</given-names></name></person-group><article-title>Optimization of a whole blood phenotyping assay for enumeration of peripheral blood leukocyte populations in multicenter clinical trials</article-title><source>J.&#x000a0;Immunol. Methods</source><volume>411</volume><year>2014</year><fpage>23</fpage><lpage>36</lpage><pub-id pub-id-type=\"pmid\">24925805</pub-id></element-citation></ref><ref id=\"bib34\"><element-citation publication-type=\"journal\" id=\"sref34\"><person-group person-group-type=\"author\"><name><surname>Hinks</surname><given-names>T.S.C.</given-names></name><name><surname>Zhang</surname><given-names>X.W.</given-names></name></person-group><article-title>MAIT Cell Activation and Functions</article-title><source>Front. Immunol.</source><volume>11</volume><year>2020</year><fpage>1014</fpage><pub-id pub-id-type=\"pmid\">32536923</pub-id></element-citation></ref><ref id=\"bib35\"><element-citation publication-type=\"journal\" id=\"sref35\"><person-group person-group-type=\"author\"><name><surname>Huang</surname><given-names>H.</given-names></name><name><surname>Sikora</surname><given-names>M.J.</given-names></name><name><surname>Islam</surname><given-names>S.</given-names></name><name><surname>Chowdhury</surname><given-names>R.R.</given-names></name><name><surname>Chien</surname><given-names>Y.H.</given-names></name><name><surname>Scriba</surname><given-names>T.J.</given-names></name><name><surname>Davis</surname><given-names>M.M.</given-names></name><name><surname>Steinmetz</surname><given-names>L.M.</given-names></name></person-group><article-title>Select sequencing of clonally expanded CD8<sup>+</sup> T&#x000a0;cells reveals limits to clonal expansion</article-title><source>Proc. Natl. Acad. Sci. USA</source><volume>116</volume><year>2019</year><fpage>8995</fpage><lpage>9001</lpage><pub-id pub-id-type=\"pmid\">30992377</pub-id></element-citation></ref><ref id=\"bib36\"><element-citation publication-type=\"journal\" id=\"sref36\"><person-group person-group-type=\"author\"><name><surname>Ivanov</surname><given-names>I.I.</given-names></name><name><surname>McKenzie</surname><given-names>B.S.</given-names></name><name><surname>Zhou</surname><given-names>L.</given-names></name><name><surname>Tadokoro</surname><given-names>C.E.</given-names></name><name><surname>Lepelley</surname><given-names>A.</given-names></name><name><surname>Lafaille</surname><given-names>J.J.</given-names></name><name><surname>Cua</surname><given-names>D.J.</given-names></name><name><surname>Littman</surname><given-names>D.R.</given-names></name></person-group><article-title>The orphan nuclear receptor RORgammat directs the differentiation program of proinflammatory IL-17+ T helper cells</article-title><source>Cell</source><volume>126</volume><year>2006</year><fpage>1121</fpage><lpage>1133</lpage><pub-id pub-id-type=\"pmid\">16990136</pub-id></element-citation></ref><ref id=\"bib37\"><element-citation publication-type=\"journal\" id=\"sref37\"><person-group person-group-type=\"author\"><name><surname>Jaitin</surname><given-names>D.A.</given-names></name><name><surname>Kenigsberg</surname><given-names>E.</given-names></name><name><surname>Keren-Shaul</surname><given-names>H.</given-names></name><name><surname>Elefant</surname><given-names>N.</given-names></name><name><surname>Paul</surname><given-names>F.</given-names></name><name><surname>Zaretsky</surname><given-names>I.</given-names></name><name><surname>Mildner</surname><given-names>A.</given-names></name><name><surname>Cohen</surname><given-names>N.</given-names></name><name><surname>Jung</surname><given-names>S.</given-names></name><name><surname>Tanay</surname><given-names>A.</given-names></name><name><surname>Amit</surname><given-names>I.</given-names></name></person-group><article-title>Massively parallel single-cell RNA-seq for marker-free decomposition of tissues into cell types</article-title><source>Science</source><volume>343</volume><year>2014</year><fpage>776</fpage><lpage>779</lpage><pub-id pub-id-type=\"pmid\">24531970</pub-id></element-citation></ref><ref id=\"bib38\"><element-citation publication-type=\"journal\" id=\"sref38\"><person-group person-group-type=\"author\"><name><surname>Kim</surname><given-names>J.</given-names></name><name><surname>Kim</surname><given-names>A.R.</given-names></name><name><surname>Shin</surname><given-names>E.C.</given-names></name></person-group><article-title>Cytomegalovirus Infection and Memory T Cell Inflation</article-title><source>Immune Netw.</source><volume>15</volume><year>2015</year><fpage>186</fpage><lpage>190</lpage><pub-id pub-id-type=\"pmid\">26330804</pub-id></element-citation></ref><ref id=\"bib39\"><element-citation publication-type=\"journal\" id=\"sref39\"><person-group person-group-type=\"author\"><name><surname>Kiselev</surname><given-names>V.Y.</given-names></name><name><surname>Yiu</surname><given-names>A.</given-names></name><name><surname>Hemberg</surname><given-names>M.</given-names></name></person-group><article-title>scmap: projection of single-cell RNA-seq data across data sets</article-title><source>Nat. Methods</source><volume>15</volume><year>2018</year><fpage>359</fpage><lpage>362</lpage><pub-id pub-id-type=\"pmid\">29608555</pub-id></element-citation></ref><ref id=\"bib40\"><element-citation publication-type=\"journal\" id=\"sref40\"><person-group person-group-type=\"author\"><name><surname>Korsunsky</surname><given-names>I.</given-names></name><name><surname>Nathan</surname><given-names>A.</given-names></name><name><surname>Millard</surname><given-names>N.</given-names></name><name><surname>Raychaudhuri</surname><given-names>S.</given-names></name></person-group><article-title>Presto scales Wilcoxon and auROC analyses to millions of observations</article-title><source>bioRxiv</source><year>2019</year><pub-id pub-id-type=\"doi\">10.1101/653253</pub-id></element-citation></ref><ref id=\"bib41\"><element-citation publication-type=\"journal\" id=\"sref41\"><person-group person-group-type=\"author\"><name><surname>Kotliarov</surname><given-names>Y.</given-names></name><name><surname>Sparks</surname><given-names>R.</given-names></name><name><surname>Martins</surname><given-names>A.J.</given-names></name><name><surname>Mul&#x000e8;</surname><given-names>M.P.</given-names></name><name><surname>Lu</surname><given-names>Y.</given-names></name><name><surname>Goswami</surname><given-names>M.</given-names></name><name><surname>Kardava</surname><given-names>L.</given-names></name><name><surname>Banchereau</surname><given-names>R.</given-names></name><name><surname>Pascual</surname><given-names>V.</given-names></name><name><surname>Biancotto</surname><given-names>A.</given-names></name></person-group><article-title>Broad immune activation underlies shared set point signatures for vaccine responsiveness in healthy individuals and disease activity in patients with lupus</article-title><source>Nat. Med.</source><volume>26</volume><year>2020</year><fpage>618</fpage><lpage>629</lpage><pub-id pub-id-type=\"pmid\">32094927</pub-id></element-citation></ref><ref id=\"bib42\"><element-citation publication-type=\"journal\" id=\"sref42\"><person-group person-group-type=\"author\"><name><surname>Lee</surname><given-names>J.</given-names></name><name><surname>Zhang</surname><given-names>T.</given-names></name><name><surname>Hwang</surname><given-names>I.</given-names></name><name><surname>Kim</surname><given-names>A.</given-names></name><name><surname>Nitschke</surname><given-names>L.</given-names></name><name><surname>Kim</surname><given-names>M.</given-names></name><name><surname>Scott</surname><given-names>J.M.</given-names></name><name><surname>Kamimura</surname><given-names>Y.</given-names></name><name><surname>Lanier</surname><given-names>L.L.</given-names></name><name><surname>Kim</surname><given-names>S.</given-names></name></person-group><article-title>Epigenetic modification and antibody-dependent expansion of memory-like NK cells in human cytomegalovirus-infected individuals</article-title><source>Immunity</source><volume>42</volume><year>2015</year><fpage>431</fpage><lpage>442</lpage><pub-id pub-id-type=\"pmid\">25786175</pub-id></element-citation></ref><ref id=\"bib43\"><element-citation publication-type=\"journal\" id=\"sref43\"><person-group person-group-type=\"author\"><name><surname>Levine</surname><given-names>J.H.</given-names></name><name><surname>Simonds</surname><given-names>E.F.</given-names></name><name><surname>Bendall</surname><given-names>S.C.</given-names></name><name><surname>Davis</surname><given-names>K.L.</given-names></name><name><surname>Amir</surname><given-names>A.D.</given-names></name><name><surname>Tadmor</surname><given-names>M.D.</given-names></name><name><surname>Litvin</surname><given-names>O.</given-names></name><name><surname>Fienberg</surname><given-names>H.G.</given-names></name><name><surname>Jager</surname><given-names>A.</given-names></name><name><surname>Zunder</surname><given-names>E.R.</given-names></name></person-group><article-title>Data-Driven Phenotypic Dissection of AML Reveals Progenitor-like Cells that Correlate with Prognosis</article-title><source>Cell</source><volume>162</volume><year>2015</year><fpage>184</fpage><lpage>197</lpage><pub-id pub-id-type=\"pmid\">26095251</pub-id></element-citation></ref><ref id=\"bib44\"><element-citation publication-type=\"journal\" id=\"sref44\"><person-group person-group-type=\"author\"><name><surname>Li</surname><given-names>S.S.</given-names></name><name><surname>Kochar</surname><given-names>N.K.</given-names></name><name><surname>Elizaga</surname><given-names>M.</given-names></name><name><surname>Hay</surname><given-names>C.M.</given-names></name><name><surname>Wilson</surname><given-names>G.J.</given-names></name><name><surname>Cohen</surname><given-names>K.W.</given-names></name><name><surname>De Rosa</surname><given-names>S.C.</given-names></name><name><surname>Xu</surname><given-names>R.</given-names></name><name><surname>Ota-Setlik</surname><given-names>A.</given-names></name><name><surname>Morris</surname><given-names>D.</given-names></name><collab>NIAID HIV Vaccine Trials Network</collab></person-group><article-title>DNA Priming Increases Frequency of T-Cell Responses to a Vesicular Stomatitis Virus HIV Vaccine with Specific Enhancement of CD8<sup>+</sup> T-Cell Responses by Interleukin-12 Plasmid DNA</article-title><source>Clin. Vaccine Immunol.</source><volume>24</volume><year>2017</year><fpage>e00263-17</fpage><pub-id pub-id-type=\"pmid\">28931520</pub-id></element-citation></ref><ref id=\"bib45\"><element-citation publication-type=\"journal\" id=\"sref45\"><person-group person-group-type=\"author\"><name><surname>Lotfollahi</surname><given-names>M.</given-names></name><name><surname>Naghipourfar</surname><given-names>M.</given-names></name><name><surname>Luecken</surname><given-names>M.D.</given-names></name><name><surname>Khajavi</surname><given-names>M.</given-names></name><name><surname>Buttner</surname><given-names>M.</given-names></name><name><surname>Avsec</surname><given-names>Z.</given-names></name><name><surname>Misharin</surname><given-names>A.V.</given-names></name><name><surname>Theis</surname><given-names>F.J.</given-names></name></person-group><article-title>Query to reference single-cell integration with transfer learning</article-title><source>bioRxiv</source><year>2020</year><pub-id pub-id-type=\"doi\">10.1101/2020.07.16.205997</pub-id></element-citation></ref><ref id=\"bib46\"><element-citation publication-type=\"journal\" id=\"sref46\"><person-group person-group-type=\"author\"><name><surname>Lu</surname><given-names>L.</given-names></name><name><surname>Li</surname><given-names>J.</given-names></name><name><surname>Moussaoui</surname><given-names>M.</given-names></name><name><surname>Boix</surname><given-names>E.</given-names></name></person-group><article-title>Immune modulation by human secreted RNases at the extracellular space</article-title><source>Front. Immunol.</source><volume>9</volume><year>2018</year><fpage>1012</fpage><pub-id pub-id-type=\"pmid\">29867984</pub-id></element-citation></ref><ref id=\"bib47\"><element-citation publication-type=\"journal\" id=\"sref47\"><person-group person-group-type=\"author\"><name><surname>Lun</surname><given-names>A.T.</given-names></name><name><surname>Bach</surname><given-names>K.</given-names></name><name><surname>Marioni</surname><given-names>J.C.</given-names></name></person-group><article-title>Pooling across cells to normalize single-cell RNA sequencing data with many zero counts</article-title><source>Genome Biol.</source><volume>17</volume><year>2016</year><fpage>75</fpage><pub-id pub-id-type=\"pmid\">27122128</pub-id></element-citation></ref><ref id=\"bib48\"><element-citation publication-type=\"journal\" id=\"sref48\"><person-group person-group-type=\"author\"><name><surname>Luo</surname><given-names>C.</given-names></name><name><surname>Liu</surname><given-names>H.</given-names></name><name><surname>Xie</surname><given-names>F.</given-names></name><name><surname>Armand</surname><given-names>E.J.</given-names></name><name><surname>Siletti</surname><given-names>K.</given-names></name><name><surname>Bakken</surname><given-names>T.E.</given-names></name><name><surname>Fang</surname><given-names>R.</given-names></name><name><surname>Doyle</surname><given-names>W.I.</given-names></name><name><surname>Hodge</surname><given-names>R.D.</given-names></name><name><surname>Hu</surname><given-names>L.</given-names></name></person-group><article-title>Single nucleus multi-omics links human cortical cell regulatory genome diversity to disease risk variants</article-title><source>bioRxiv</source><year>2019</year><pub-id pub-id-type=\"doi\">10.1101/2019.12.11.873398</pub-id></element-citation></ref><ref id=\"bib50\"><element-citation publication-type=\"journal\" id=\"sref50\"><person-group person-group-type=\"author\"><name><surname>Ma</surname><given-names>S.</given-names></name><name><surname>Zhang</surname><given-names>B.</given-names></name><name><surname>LaFave</surname><given-names>L.M.</given-names></name><name><surname>Earl</surname><given-names>A.S.</given-names></name><name><surname>Chiang</surname><given-names>Z.</given-names></name><name><surname>Hu</surname><given-names>Y.</given-names></name><name><surname>Ding</surname><given-names>J.</given-names></name><name><surname>Brack</surname><given-names>A.</given-names></name><name><surname>Kartha</surname><given-names>V.K.</given-names></name><name><surname>Tay</surname><given-names>T.</given-names></name></person-group><article-title>Chromatin Potential Identified by Shared Single-Cell Profiling of RNA and Chromatin</article-title><source>Cell</source><volume>183</volume><year>2020</year><fpage>1103</fpage><lpage>1116.e20</lpage><pub-id pub-id-type=\"pmid\">33098772</pub-id></element-citation></ref><ref id=\"bib51\"><element-citation publication-type=\"journal\" id=\"sref51\"><person-group person-group-type=\"author\"><name><surname>McInnes</surname><given-names>L.</given-names></name><name><surname>Healy</surname><given-names>J.</given-names></name><name><surname>Melville</surname><given-names>J.</given-names></name></person-group><article-title>Umap: Uniform manifold approximation and projection for dimension reduction</article-title><source>arXiv</source><year>2018</year><comment>arXiv:1802.03426</comment></element-citation></ref><ref id=\"bib52\"><element-citation publication-type=\"journal\" id=\"sref52\"><person-group person-group-type=\"author\"><name><surname>McKechnie</surname><given-names>J.L.</given-names></name><name><surname>Beltr&#x000e1;n</surname><given-names>D.</given-names></name><name><surname>Ferreira</surname><given-names>A.-M.M.</given-names></name><name><surname>Vergara</surname><given-names>R.</given-names></name><name><surname>Saenz</surname><given-names>L.</given-names></name><name><surname>Vergara</surname><given-names>O.</given-names></name><name><surname>Estripeaut</surname><given-names>D.</given-names></name><name><surname>Ara&#x000fa;z</surname><given-names>A.B.</given-names></name><name><surname>Simpson</surname><given-names>L.J.</given-names></name><name><surname>Holmes</surname><given-names>S.</given-names></name></person-group><article-title>Mass cytometry analysis of the NK cell receptor-ligand repertoire reveals unique differences between dengue-infected children and adults</article-title><source>bioRxiv</source><year>2020</year><pub-id pub-id-type=\"doi\">10.1101/2020.07.27.223339</pub-id></element-citation></ref><ref id=\"bib53\"><element-citation publication-type=\"journal\" id=\"sref53\"><person-group person-group-type=\"author\"><name><surname>Mei</surname><given-names>H.E.</given-names></name><name><surname>Leipold</surname><given-names>M.D.</given-names></name><name><surname>Schulz</surname><given-names>A.R.</given-names></name><name><surname>Chester</surname><given-names>C.</given-names></name><name><surname>Maecker</surname><given-names>H.T.</given-names></name></person-group><article-title>Barcoding of live human peripheral blood mononuclear cells for multiplexed mass cytometry</article-title><source>J.&#x000a0;Immunol.</source><volume>194</volume><year>2015</year><fpage>2022</fpage><lpage>2031</lpage><pub-id pub-id-type=\"pmid\">25609839</pub-id></element-citation></ref><ref id=\"bib54\"><element-citation publication-type=\"journal\" id=\"sref54\"><person-group person-group-type=\"author\"><name><surname>Mereu</surname><given-names>E.</given-names></name><name><surname>Lafzi</surname><given-names>A.</given-names></name><name><surname>Moutinho</surname><given-names>C.</given-names></name><name><surname>Ziegenhain</surname><given-names>C.</given-names></name><name><surname>McCarthy</surname><given-names>D.J.</given-names></name><name><surname>&#x000c1;lvarez-Varela</surname><given-names>A.</given-names></name><name><surname>Batlle</surname><given-names>E.</given-names></name><name><surname>Sagar</surname></name><name><surname>Gr&#x000fc;n</surname><given-names>D.</given-names></name><name><surname>Lau</surname><given-names>J.K.</given-names></name></person-group><article-title>Benchmarking single-cell RNA-sequencing protocols for cell atlas projects</article-title><source>Nat. Biotechnol.</source><volume>38</volume><year>2020</year><fpage>747</fpage><lpage>755</lpage><pub-id pub-id-type=\"pmid\">32518403</pub-id></element-citation></ref><ref id=\"bib55\"><element-citation publication-type=\"journal\" id=\"sref55\"><person-group person-group-type=\"author\"><name><surname>Mimitou</surname><given-names>E.P.</given-names></name><name><surname>Cheng</surname><given-names>A.</given-names></name><name><surname>Montalbano</surname><given-names>A.</given-names></name><name><surname>Hao</surname><given-names>S.</given-names></name><name><surname>Stoeckius</surname><given-names>M.</given-names></name><name><surname>Legut</surname><given-names>M.</given-names></name><name><surname>Roush</surname><given-names>T.</given-names></name><name><surname>Herrera</surname><given-names>A.</given-names></name><name><surname>Papalexi</surname><given-names>E.</given-names></name><name><surname>Ouyang</surname><given-names>Z.</given-names></name></person-group><article-title>Multiplexed detection of proteins, transcriptomes, clonotypes and CRISPR perturbations in single cells</article-title><source>Nat. Methods</source><volume>16</volume><year>2019</year><fpage>409</fpage><lpage>412</lpage><pub-id pub-id-type=\"pmid\">31011186</pub-id></element-citation></ref><ref id=\"bib56\"><element-citation publication-type=\"journal\" id=\"sref56\"><person-group person-group-type=\"author\"><name><surname>Mimitou</surname><given-names>E.P.</given-names></name><name><surname>Lareau</surname><given-names>C.A.</given-names></name><name><surname>Chen</surname><given-names>K.Y.</given-names></name><name><surname>Zorzetto-Fernandes</surname><given-names>A.L.</given-names></name><name><surname>Takeshima</surname><given-names>Y.</given-names></name><name><surname>Luo</surname><given-names>W.</given-names></name><name><surname>Huang</surname><given-names>T.-S.</given-names></name><name><surname>Yeung</surname><given-names>B.</given-names></name><name><surname>Thakore</surname><given-names>P.I.</given-names></name><name><surname>Wing</surname><given-names>J.B.</given-names></name></person-group><article-title>Scalable, multimodal profiling of chromatin accessibility and protein levels in single cells</article-title><source>bioRxiv</source><year>2020</year><pub-id pub-id-type=\"doi\">10.1101/2020.09.08.286914</pub-id></element-citation></ref><ref id=\"bib57\"><element-citation publication-type=\"journal\" id=\"sref57\"><person-group person-group-type=\"author\"><name><surname>Papalexi</surname><given-names>E.</given-names></name><name><surname>Satija</surname><given-names>R.</given-names></name></person-group><article-title>Single-cell RNA sequencing to explore immune cell heterogeneity</article-title><source>Nat. Rev. Immunol.</source><volume>18</volume><year>2018</year><fpage>35</fpage><lpage>45</lpage><pub-id pub-id-type=\"pmid\">28787399</pub-id></element-citation></ref><ref id=\"bib58\"><element-citation publication-type=\"journal\" id=\"sref58\"><person-group person-group-type=\"author\"><name><surname>Papalexi</surname><given-names>E.</given-names></name><name><surname>Mimitou</surname><given-names>E.</given-names></name><name><surname>Butler</surname><given-names>A.W.</given-names></name><name><surname>Foster</surname><given-names>S.</given-names></name><name><surname>Bracken</surname><given-names>B.</given-names></name><name><surname>Mauck</surname><given-names>W.M.</given-names></name><name><surname>Wessels</surname><given-names>H.-H.</given-names></name><name><surname>Yeung</surname><given-names>B.Z.</given-names></name><name><surname>Smibert</surname><given-names>P.</given-names></name><name><surname>Satija</surname><given-names>R.</given-names></name></person-group><article-title>Characterizing the molecular regulation of inhibitory immune checkpoints with multi-modal single-cell screens</article-title><source>bioRxiv</source><year>2020</year><pub-id pub-id-type=\"doi\">10.1101/2020.06.28.175596</pub-id></element-citation></ref><ref id=\"bib59\"><element-citation publication-type=\"journal\" id=\"sref59\"><person-group person-group-type=\"author\"><name><surname>Peterson</surname><given-names>V.M.</given-names></name><name><surname>Zhang</surname><given-names>K.X.</given-names></name><name><surname>Kumar</surname><given-names>N.</given-names></name><name><surname>Wong</surname><given-names>J.</given-names></name><name><surname>Li</surname><given-names>L.</given-names></name><name><surname>Wilson</surname><given-names>D.C.</given-names></name><name><surname>Moore</surname><given-names>R.</given-names></name><name><surname>McClanahan</surname><given-names>T.K.</given-names></name><name><surname>Sadekova</surname><given-names>S.</given-names></name><name><surname>Klappenbach</surname><given-names>J.A.</given-names></name></person-group><article-title>Multiplexed quantification of proteins and transcripts in single cells</article-title><source>Nat. Biotechnol.</source><volume>35</volume><year>2017</year><fpage>936</fpage><lpage>939</lpage><pub-id pub-id-type=\"pmid\">28854175</pub-id></element-citation></ref><ref id=\"bib60\"><element-citation publication-type=\"journal\" id=\"sref60\"><person-group person-group-type=\"author\"><name><surname>Picelli</surname><given-names>S.</given-names></name><name><surname>Faridani</surname><given-names>O.R.</given-names></name><name><surname>Bj&#x000f6;rklund</surname><given-names>&#x000c5;.K.</given-names></name><name><surname>Winberg</surname><given-names>G.</given-names></name><name><surname>Sagasser</surname><given-names>S.</given-names></name><name><surname>Sandberg</surname><given-names>R.</given-names></name></person-group><article-title>Full-length RNA-seq from single cells using Smart-seq2</article-title><source>Nat. Protoc.</source><volume>9</volume><year>2014</year><fpage>171</fpage><lpage>181</lpage><pub-id pub-id-type=\"pmid\">24385147</pub-id></element-citation></ref><ref id=\"bib61\"><element-citation publication-type=\"journal\" id=\"sref61\"><person-group person-group-type=\"author\"><name><surname>Pott</surname><given-names>S.</given-names></name></person-group><article-title>Simultaneous measurement of chromatin accessibility, DNA methylation, and nucleosome phasing in single cells</article-title><source>eLife</source><volume>6</volume><year>2017</year><fpage>e23203</fpage><pub-id pub-id-type=\"pmid\">28653622</pub-id></element-citation></ref><ref id=\"bib62\"><element-citation publication-type=\"journal\" id=\"sref62\"><person-group person-group-type=\"author\"><name><surname>Poulos</surname><given-names>R.C.</given-names></name><name><surname>Thoms</surname><given-names>J.A.I.</given-names></name><name><surname>Guan</surname><given-names>Y.F.</given-names></name><name><surname>Unnikrishnan</surname><given-names>A.</given-names></name><name><surname>Pimanda</surname><given-names>J.E.</given-names></name><name><surname>Wong</surname><given-names>J.W.H.</given-names></name></person-group><article-title>Functional Mutations Form at CTCF-Cohesin Binding Sites in Melanoma Due to Uneven Nucleotide Excision Repair across the Motif</article-title><source>Cell Rep.</source><volume>17</volume><year>2016</year><fpage>2865</fpage><lpage>2872</lpage><pub-id pub-id-type=\"pmid\">27974201</pub-id></element-citation></ref><ref id=\"bib63\"><element-citation publication-type=\"journal\" id=\"sref63\"><person-group person-group-type=\"author\"><name><surname>Provine</surname><given-names>N.M.</given-names></name><name><surname>Klenerman</surname><given-names>P.</given-names></name></person-group><article-title>MAIT Cells in Health and Disease</article-title><source>Annu. Rev. Immunol.</source><volume>38</volume><year>2020</year><fpage>203</fpage><lpage>228</lpage><pub-id pub-id-type=\"pmid\">31986071</pub-id></element-citation></ref><ref id=\"bib64\"><element-citation publication-type=\"journal\" id=\"sref64\"><person-group person-group-type=\"author\"><name><surname>Rodriques</surname><given-names>S.G.</given-names></name><name><surname>Stickels</surname><given-names>R.R.</given-names></name><name><surname>Goeva</surname><given-names>A.</given-names></name><name><surname>Martin</surname><given-names>C.A.</given-names></name><name><surname>Murray</surname><given-names>E.</given-names></name><name><surname>Vanderburg</surname><given-names>C.R.</given-names></name><name><surname>Welch</surname><given-names>J.</given-names></name><name><surname>Chen</surname><given-names>L.M.</given-names></name><name><surname>Chen</surname><given-names>F.</given-names></name><name><surname>Macosko</surname><given-names>E.Z.</given-names></name></person-group><article-title>Slide-seq: A scalable technology for measuring genome-wide expression at high spatial resolution</article-title><source>Science</source><volume>363</volume><year>2019</year><fpage>1463</fpage><lpage>1467</lpage><pub-id pub-id-type=\"pmid\">30923225</pub-id></element-citation></ref><ref id=\"bib65\"><element-citation publication-type=\"journal\" id=\"sref65\"><person-group person-group-type=\"author\"><name><surname>Saeys</surname><given-names>Y.</given-names></name><name><surname>Van Gassen</surname><given-names>S.</given-names></name><name><surname>Lambrecht</surname><given-names>B.N.</given-names></name></person-group><article-title>Computational flow cytometry: helping to make sense of high-dimensional immunology data</article-title><source>Nat. Rev. Immunol.</source><volume>16</volume><year>2016</year><fpage>449</fpage><lpage>462</lpage><pub-id pub-id-type=\"pmid\">27320317</pub-id></element-citation></ref><ref id=\"bib66\"><element-citation publication-type=\"journal\" id=\"sref66\"><person-group person-group-type=\"author\"><name><surname>Schlums</surname><given-names>H.</given-names></name><name><surname>Cichocki</surname><given-names>F.</given-names></name><name><surname>Tesi</surname><given-names>B.</given-names></name><name><surname>Theorell</surname><given-names>J.</given-names></name><name><surname>Beziat</surname><given-names>V.</given-names></name><name><surname>Holmes</surname><given-names>T.D.</given-names></name><name><surname>Han</surname><given-names>H.</given-names></name><name><surname>Chiang</surname><given-names>S.C.</given-names></name><name><surname>Foley</surname><given-names>B.</given-names></name><name><surname>Mattsson</surname><given-names>K.</given-names></name></person-group><article-title>Cytomegalovirus infection drives adaptive epigenetic diversification of NK cells with altered signaling and effector function</article-title><source>Immunity</source><volume>42</volume><year>2015</year><fpage>443</fpage><lpage>456</lpage><pub-id pub-id-type=\"pmid\">25786176</pub-id></element-citation></ref><ref id=\"bib67\"><element-citation publication-type=\"journal\" id=\"sref67\"><person-group person-group-type=\"author\"><name><surname>See</surname><given-names>P.</given-names></name><name><surname>Dutertre</surname><given-names>C.-A.</given-names></name><name><surname>Chen</surname><given-names>J.</given-names></name><name><surname>G&#x000fc;nther</surname><given-names>P.</given-names></name><name><surname>McGovern</surname><given-names>N.</given-names></name><name><surname>Irac</surname><given-names>S.E.</given-names></name><name><surname>Gunawan</surname><given-names>M.</given-names></name><name><surname>Beyer</surname><given-names>M.</given-names></name><name><surname>H&#x000e4;ndler</surname><given-names>K.</given-names></name><name><surname>Duan</surname><given-names>K.</given-names></name></person-group><article-title>Mapping the human DC lineage through the integration of high-dimensional techniques</article-title><source>Science</source><volume>356</volume><year>2017</year><fpage>eaag3009</fpage><pub-id pub-id-type=\"pmid\">28473638</pub-id></element-citation></ref><ref id=\"bib68\"><element-citation publication-type=\"journal\" id=\"sref68\"><person-group person-group-type=\"author\"><name><surname>Sercan Alp</surname><given-names>&#x000d6;.</given-names></name><name><surname>Durlanik</surname><given-names>S.</given-names></name><name><surname>Schulz</surname><given-names>D.</given-names></name><name><surname>McGrath</surname><given-names>M.</given-names></name><name><surname>Gr&#x000fc;n</surname><given-names>J.R.</given-names></name><name><surname>Bardua</surname><given-names>M.</given-names></name><name><surname>Ikuta</surname><given-names>K.</given-names></name><name><surname>Sgouroudis</surname><given-names>E.</given-names></name><name><surname>Riedel</surname><given-names>R.</given-names></name><name><surname>Zehentmeier</surname><given-names>S.</given-names></name></person-group><article-title>Memory CD8(+) T&#x000a0;cells colocalize with IL-7(+) stromal cells in bone marrow and rest in terms of proliferation and transcription</article-title><source>Eur. J. Immunol.</source><volume>45</volume><year>2015</year><fpage>975</fpage><lpage>987</lpage><pub-id pub-id-type=\"pmid\">25639669</pub-id></element-citation></ref><ref id=\"bib69\"><element-citation publication-type=\"journal\" id=\"sref69\"><person-group person-group-type=\"author\"><name><surname>Soumillon</surname><given-names>M.</given-names></name><name><surname>Cacchiarelli</surname><given-names>D.</given-names></name><name><surname>Semrau</surname><given-names>S.</given-names></name><name><surname>van Oudenaarden</surname><given-names>A.</given-names></name><name><surname>Mikkelsen</surname><given-names>T.S.</given-names></name></person-group><article-title>Characterization of directed differentiation by high-throughput single-cell RNA-Seq</article-title><source>bioRxiv</source><year>2014</year><pub-id pub-id-type=\"doi\">10.1101/003236</pub-id></element-citation></ref><ref id=\"bib70\"><element-citation publication-type=\"journal\" id=\"sref70\"><person-group person-group-type=\"author\"><name><surname>Srivastava</surname><given-names>A.</given-names></name><name><surname>Malik</surname><given-names>L.</given-names></name><name><surname>Smith</surname><given-names>T.</given-names></name><name><surname>Sudbery</surname><given-names>I.</given-names></name><name><surname>Patro</surname><given-names>R.</given-names></name></person-group><article-title>Alevin efficiently estimates accurate gene abundances from dscRNA-seq data</article-title><source>Genome Biol.</source><volume>20</volume><year>2019</year><fpage>65</fpage><pub-id pub-id-type=\"pmid\">30917859</pub-id></element-citation></ref><ref id=\"bib71\"><element-citation publication-type=\"journal\" id=\"sref71\"><person-group person-group-type=\"author\"><name><surname>Stoeckius</surname><given-names>M.</given-names></name><name><surname>Hafemeister</surname><given-names>C.</given-names></name><name><surname>Stephenson</surname><given-names>W.</given-names></name><name><surname>Houck-Loomis</surname><given-names>B.</given-names></name><name><surname>Chattopadhyay</surname><given-names>P.K.</given-names></name><name><surname>Swerdlow</surname><given-names>H.</given-names></name><name><surname>Satija</surname><given-names>R.</given-names></name><name><surname>Smibert</surname><given-names>P.</given-names></name></person-group><article-title>Simultaneous epitope and transcriptome measurement in single cells</article-title><source>Nat. Methods</source><volume>14</volume><year>2017</year><fpage>865</fpage><lpage>868</lpage><pub-id pub-id-type=\"pmid\">28759029</pub-id></element-citation></ref><ref id=\"bib72\"><element-citation publication-type=\"journal\" id=\"sref72\"><person-group person-group-type=\"author\"><name><surname>Stoeckius</surname><given-names>M.</given-names></name><name><surname>Zheng</surname><given-names>S.</given-names></name><name><surname>Houck-Loomis</surname><given-names>B.</given-names></name><name><surname>Hao</surname><given-names>S.</given-names></name><name><surname>Yeung</surname><given-names>B.Z.</given-names></name><name><surname>Mauck</surname><given-names>W.M.</given-names><suffix>3rd</suffix></name><name><surname>Smibert</surname><given-names>P.</given-names></name><name><surname>Satija</surname><given-names>R.</given-names></name></person-group><article-title>Cell Hashing with barcoded antibodies enables multiplexing and doublet detection for single cell genomics</article-title><source>Genome Biol.</source><volume>19</volume><year>2018</year><fpage>224</fpage><pub-id pub-id-type=\"pmid\">30567574</pub-id></element-citation></ref><ref id=\"bib73\"><element-citation publication-type=\"journal\" id=\"sref73\"><person-group person-group-type=\"author\"><name><surname>Stuart</surname><given-names>T.</given-names></name><name><surname>Butler</surname><given-names>A.</given-names></name><name><surname>Hoffman</surname><given-names>P.</given-names></name><name><surname>Hafemeister</surname><given-names>C.</given-names></name><name><surname>Papalexi</surname><given-names>E.</given-names></name><name><surname>Mauck</surname><given-names>W.M.</given-names><suffix>III</suffix></name><name><surname>Hao</surname><given-names>Y.</given-names></name><name><surname>Stoeckius</surname><given-names>M.</given-names></name><name><surname>Smibert</surname><given-names>P.</given-names></name><name><surname>Satija</surname><given-names>R.</given-names></name></person-group><article-title>Comprehensive integration of single-cell data</article-title><source>Cell</source><volume>177</volume><year>2019</year><fpage>1888</fpage><lpage>1902</lpage><pub-id pub-id-type=\"pmid\">31178118</pub-id></element-citation></ref><ref id=\"bib74\"><element-citation publication-type=\"journal\" id=\"sref74\"><person-group person-group-type=\"author\"><name><surname>Stuart</surname><given-names>T.</given-names></name><name><surname>Srivastava</surname><given-names>A.</given-names></name><name><surname>Lareau</surname><given-names>C.</given-names></name><name><surname>Satija</surname><given-names>R.</given-names></name></person-group><article-title>Multimodal single-cell chromatin analysis with Signac</article-title><source>bioRxiv</source><year>2020</year><pub-id pub-id-type=\"doi\">10.1101/2020.11.09.373613</pub-id></element-citation></ref><ref id=\"bib75\"><element-citation publication-type=\"journal\" id=\"sref75\"><person-group person-group-type=\"author\"><name><surname>Stubbington</surname><given-names>M.J.T.</given-names></name><name><surname>Rozenblatt-Rosen</surname><given-names>O.</given-names></name><name><surname>Regev</surname><given-names>A.</given-names></name><name><surname>Teichmann</surname><given-names>S.A.</given-names></name></person-group><article-title>Single-cell transcriptomics to explore the immune system in health and disease</article-title><source>Science</source><volume>358</volume><year>2017</year><fpage>58</fpage><lpage>63</lpage><pub-id pub-id-type=\"pmid\">28983043</pub-id></element-citation></ref><ref id=\"bib76\"><element-citation publication-type=\"journal\" id=\"sref76\"><person-group person-group-type=\"author\"><name><surname>Szabo</surname><given-names>P.A.</given-names></name><name><surname>Miron</surname><given-names>M.</given-names></name><name><surname>Farber</surname><given-names>D.L.</given-names></name></person-group><article-title>Location, location, location: Tissue resident memory T&#x000a0;cells in mice and humans</article-title><source>Sci. Immunol.</source><volume>4</volume><year>2019</year><fpage>eaas9673</fpage><pub-id pub-id-type=\"pmid\">30952804</pub-id></element-citation></ref><ref id=\"bib77\"><element-citation publication-type=\"book\" id=\"sref77\"><person-group person-group-type=\"author\"><collab>R Development Core Team</collab></person-group><chapter-title>R: A language and environment for statistical computing</chapter-title><year>2013</year><publisher-name>R Foundation for Statistical Computing</publisher-name></element-citation></ref><ref id=\"bib78\"><element-citation publication-type=\"journal\" id=\"sref78\"><person-group person-group-type=\"author\"><name><surname>Topham</surname><given-names>D.J.</given-names></name><name><surname>Reilly</surname><given-names>E.C.</given-names></name></person-group><article-title>Tissue-Resident Memory CD8<sup>+</sup> T Cells: From Phenotype to Function</article-title><source>Front. Immunol.</source><volume>9</volume><year>2018</year><fpage>515</fpage><pub-id pub-id-type=\"pmid\">29632527</pub-id></element-citation></ref><ref id=\"bib79\"><element-citation publication-type=\"journal\" id=\"sref79\"><person-group person-group-type=\"author\"><name><surname>van Dijk</surname><given-names>D.</given-names></name><name><surname>Sharma</surname><given-names>R.</given-names></name><name><surname>Nainys</surname><given-names>J.</given-names></name><name><surname>Yim</surname><given-names>K.</given-names></name><name><surname>Kathail</surname><given-names>P.</given-names></name><name><surname>Carr</surname><given-names>A.J.</given-names></name><name><surname>Burdziak</surname><given-names>C.</given-names></name><name><surname>Moon</surname><given-names>K.R.</given-names></name><name><surname>Chaffer</surname><given-names>C.L.</given-names></name><name><surname>Pattabiraman</surname><given-names>D.</given-names></name></person-group><article-title>Recovering Gene Interactions from Single-Cell Data Using Data Diffusion</article-title><source>Cell</source><volume>174</volume><year>2018</year><fpage>716</fpage><lpage>729.e27</lpage><pub-id pub-id-type=\"pmid\">29961576</pub-id></element-citation></ref><ref id=\"bib80\"><element-citation publication-type=\"journal\" id=\"sref80\"><person-group person-group-type=\"author\"><name><surname>Vendrame</surname><given-names>E.</given-names></name><name><surname>Seiler</surname><given-names>C.</given-names></name><name><surname>Ranganath</surname><given-names>T.</given-names></name><name><surname>Zhao</surname><given-names>N.Q.</given-names></name><name><surname>Vergara</surname><given-names>R.</given-names></name><name><surname>Alary</surname><given-names>M.</given-names></name><name><surname>Labb&#x000e9;</surname><given-names>A.C.</given-names></name><name><surname>Gu&#x000e9;dou</surname><given-names>F.</given-names></name><name><surname>Poudrier</surname><given-names>J.</given-names></name><name><surname>Holmes</surname><given-names>S.</given-names></name></person-group><article-title>TIGIT is upregulated by HIV-1 infection and marks a highly functional adaptive and mature subset of natural killer cells</article-title><source>AIDS</source><volume>34</volume><year>2020</year><fpage>801</fpage><lpage>813</lpage><pub-id pub-id-type=\"pmid\">32028328</pub-id></element-citation></ref><ref id=\"bib81\"><element-citation publication-type=\"journal\" id=\"sref81\"><person-group person-group-type=\"author\"><name><surname>Vickovic</surname><given-names>S.</given-names></name><name><surname>Eraslan</surname><given-names>G.</given-names></name><name><surname>Salm&#x000e9;n</surname><given-names>F.</given-names></name><name><surname>Klughammer</surname><given-names>J.</given-names></name><name><surname>Stenbeck</surname><given-names>L.</given-names></name><name><surname>Schapiro</surname><given-names>D.</given-names></name><name><surname>&#x000c4;ij&#x000f6;</surname><given-names>T.</given-names></name><name><surname>Bonneau</surname><given-names>R.</given-names></name><name><surname>Bergenstr&#x000e5;hle</surname><given-names>L.</given-names></name><name><surname>Navarro</surname><given-names>J.F.</given-names></name></person-group><article-title>High-definition spatial transcriptomics for in&#x000a0;situ tissue profiling</article-title><source>Nat. Methods</source><volume>16</volume><year>2019</year><fpage>987</fpage><lpage>990</lpage><pub-id pub-id-type=\"pmid\">31501547</pub-id></element-citation></ref><ref id=\"bib82\"><element-citation publication-type=\"journal\" id=\"sref82\"><person-group person-group-type=\"author\"><name><surname>Villani</surname><given-names>A.C.</given-names></name><name><surname>Satija</surname><given-names>R.</given-names></name><name><surname>Reynolds</surname><given-names>G.</given-names></name><name><surname>Sarkizova</surname><given-names>S.</given-names></name><name><surname>Shekhar</surname><given-names>K.</given-names></name><name><surname>Fletcher</surname><given-names>J.</given-names></name><name><surname>Griesbeck</surname><given-names>M.</given-names></name><name><surname>Butler</surname><given-names>A.</given-names></name><name><surname>Zheng</surname><given-names>S.</given-names></name><name><surname>Lazo</surname><given-names>S.</given-names></name></person-group><article-title>Single-cell RNA-seq reveals new types of human blood dendritic cells, monocytes, and progenitors</article-title><source>Science</source><volume>356</volume><year>2017</year><fpage>eaah4573</fpage><pub-id pub-id-type=\"pmid\">28428369</pub-id></element-citation></ref><ref id=\"bib83\"><element-citation publication-type=\"journal\" id=\"sref83\"><person-group person-group-type=\"author\"><name><surname>Walsh</surname><given-names>D.A.</given-names></name><name><surname>Borges da Silva</surname><given-names>H.</given-names></name><name><surname>Beura</surname><given-names>L.K.</given-names></name><name><surname>Peng</surname><given-names>C.</given-names></name><name><surname>Hamilton</surname><given-names>S.E.</given-names></name><name><surname>Masopust</surname><given-names>D.</given-names></name><name><surname>Jameson</surname><given-names>S.C.</given-names></name></person-group><article-title>The Functional Requirement for CD69 in Establishment of Resident Memory CD8<sup>+</sup> T Cells Varies with Tissue Location</article-title><source>J.&#x000a0;Immunol.</source><volume>203</volume><year>2019</year><fpage>946</fpage><lpage>955</lpage><pub-id pub-id-type=\"pmid\">31243092</pub-id></element-citation></ref><ref id=\"bib84\"><element-citation publication-type=\"journal\" id=\"sref84\"><person-group person-group-type=\"author\"><name><surname>Waltman</surname><given-names>L.</given-names></name><name><surname>Van Eck</surname><given-names>N.J.</given-names></name></person-group><article-title>A smart local moving algorithm for large-scale modularity-based community detection</article-title><source>Eur. Phys. J. B</source><volume>86</volume><year>2013</year><fpage>471</fpage></element-citation></ref><ref id=\"bib85\"><element-citation publication-type=\"journal\" id=\"sref85\"><person-group person-group-type=\"author\"><name><surname>Weinberger</surname><given-names>K.Q.</given-names></name><name><surname>Saul</surname><given-names>L.K.</given-names></name></person-group><article-title>Distance metric learning for large margin nearest neighbor classification</article-title><source>J.&#x000a0;Mach. Learn. Res.</source><volume>10</volume><year>2009</year><fpage>207</fpage><lpage>244</lpage></element-citation></ref><ref id=\"bib86\"><element-citation publication-type=\"journal\" id=\"sref86\"><person-group person-group-type=\"author\"><name><surname>Wilk</surname><given-names>A.J.</given-names></name><name><surname>Rustagi</surname><given-names>A.</given-names></name><name><surname>Zhao</surname><given-names>N.Q.</given-names></name><name><surname>Roque</surname><given-names>J.</given-names></name><name><surname>Mart&#x000ed;nez-Col&#x000f3;n</surname><given-names>G.J.</given-names></name><name><surname>McKechnie</surname><given-names>J.L.</given-names></name><name><surname>Ivison</surname><given-names>G.T.</given-names></name><name><surname>Ranganath</surname><given-names>T.</given-names></name><name><surname>Vergara</surname><given-names>R.</given-names></name><name><surname>Hollis</surname><given-names>T.</given-names></name></person-group><article-title>A single-cell atlas of the peripheral immune response in patients with severe COVID-19</article-title><source>Nat. Med.</source><volume>26</volume><year>2020</year><fpage>1070</fpage><lpage>1076</lpage><pub-id pub-id-type=\"pmid\">32514174</pub-id></element-citation></ref><ref id=\"bib87\"><element-citation publication-type=\"journal\" id=\"sref87\"><person-group person-group-type=\"author\"><name><surname>Willing</surname><given-names>A.</given-names></name><name><surname>J&#x000e4;ger</surname><given-names>J.</given-names></name><name><surname>Reinhardt</surname><given-names>S.</given-names></name><name><surname>Kursawe</surname><given-names>N.</given-names></name><name><surname>Friese</surname><given-names>M.A.</given-names></name></person-group><article-title>Production of IL-17 by MAIT cells is increased in multiple sclerosis and is associated with IL-7 receptor expression</article-title><source>J.&#x000a0;Immunol.</source><volume>200</volume><year>2018</year><fpage>974</fpage><lpage>982</lpage><pub-id pub-id-type=\"pmid\">29298833</pub-id></element-citation></ref><ref id=\"bib88\"><element-citation publication-type=\"journal\" id=\"sref88\"><person-group person-group-type=\"author\"><name><surname>Wolock</surname><given-names>S.L.</given-names></name><name><surname>Lopez</surname><given-names>R.</given-names></name><name><surname>Klein</surname><given-names>A.M.</given-names></name></person-group><article-title>Scrublet: Computational Identification of Cell Doublets in Single-Cell Transcriptomic Data</article-title><source>Cell Syst.</source><volume>8</volume><year>2019</year><fpage>281</fpage><lpage>291.e9</lpage><pub-id pub-id-type=\"pmid\">30954476</pub-id></element-citation></ref><ref id=\"bib89\"><element-citation publication-type=\"journal\" id=\"sref89\"><person-group person-group-type=\"author\"><name><surname>Zak</surname><given-names>D.E.</given-names></name><name><surname>Andersen-Nissen</surname><given-names>E.</given-names></name><name><surname>Peterson</surname><given-names>E.R.</given-names></name><name><surname>Sato</surname><given-names>A.</given-names></name><name><surname>Hamilton</surname><given-names>M.K.</given-names></name><name><surname>Borgerding</surname><given-names>J.</given-names></name><name><surname>Krishnamurty</surname><given-names>A.T.</given-names></name><name><surname>Chang</surname><given-names>J.T.</given-names></name><name><surname>Adams</surname><given-names>D.J.</given-names></name><name><surname>Hensley</surname><given-names>T.R.</given-names></name></person-group><article-title>Merck Ad5/HIV induces broad innate immune activation that predicts CD8<sup>+</sup> T-cell responses but is attenuated by preexisting Ad5 immunity</article-title><source>Proc. Natl. Acad. Sci. USA</source><volume>109</volume><year>2012</year><fpage>E3503</fpage><lpage>E3512</lpage><pub-id pub-id-type=\"pmid\">23151505</pub-id></element-citation></ref><ref id=\"bib90\"><element-citation publication-type=\"journal\" id=\"sref90\"><person-group person-group-type=\"author\"><name><surname>Zhang</surname><given-names>Y.</given-names></name><name><surname>Liu</surname><given-names>T.</given-names></name><name><surname>Meyer</surname><given-names>C.A.</given-names></name><name><surname>Eeckhoute</surname><given-names>J.</given-names></name><name><surname>Johnson</surname><given-names>D.S.</given-names></name><name><surname>Bernstein</surname><given-names>B.E.</given-names></name><name><surname>Nusbaum</surname><given-names>C.</given-names></name><name><surname>Myers</surname><given-names>R.M.</given-names></name><name><surname>Brown</surname><given-names>M.</given-names></name><name><surname>Li</surname><given-names>W.</given-names></name><name><surname>Liu</surname><given-names>X.S.</given-names></name></person-group><article-title>Model-based analysis of ChIP-Seq (MACS)</article-title><source>Genome Biol.</source><volume>9</volume><year>2008</year><fpage>R137</fpage><pub-id pub-id-type=\"pmid\">18798982</pub-id></element-citation></ref><ref id=\"bib91\"><element-citation publication-type=\"journal\" id=\"sref91\"><person-group person-group-type=\"author\"><name><surname>Zhu</surname><given-names>C.</given-names></name><name><surname>Preissl</surname><given-names>S.</given-names></name><name><surname>Ren</surname><given-names>B.</given-names></name></person-group><article-title>Single-cell multimodal omics: the power of many</article-title><source>Nat. Methods</source><volume>17</volume><year>2020</year><fpage>11</fpage><lpage>14</lpage><pub-id pub-id-type=\"pmid\">31907462</pub-id></element-citation></ref></ref-list><sec id=\"app2\" sec-type=\"supplementary-material\"><title>Supplemental information</title><p id=\"p0860\"><supplementary-material content-type=\"local-data\" id=\"mmc1\"><caption><title>Table S1. Antibody information, related to Figure&#x000a0;3</title></caption><media xlink:href=\"mmc1.xlsx\"/></supplementary-material><supplementary-material content-type=\"local-data\" id=\"mmc2\"><caption><title>Table S2. Panel enrichment, related to Figure&#x000a0;4</title></caption><media xlink:href=\"mmc2.xlsx\"/></supplementary-material><supplementary-material content-type=\"local-data\" id=\"mmc3\"><caption><title>Table S3. Donor information, related to Figure&#x000a0;5</title></caption><media xlink:href=\"mmc3.xlsx\"/></supplementary-material></p></sec><ack id=\"ack0010\"><title>Acknowledgments</title><p id=\"p0840\">We acknowledge Dan Littman and members of the Satija and Technology Innovation Labs for general discussion. This work was supported by the <funding-source id=\"gs1\"><institution-wrap><institution-id institution-id-type=\"doi\">10.13039/100014989</institution-id><institution>Chan Zuckerberg Initiative</institution></institution-wrap></funding-source> (EOSS-0000000082 to R.S. and HCA-A-1704-01895 to P.S. and R.S.), the <funding-source id=\"gs2\"><institution-wrap><institution-id institution-id-type=\"doi\">10.13039/100000002</institution-id><institution>NIH</institution></institution-wrap></funding-source> (RM1HG011014-01 to P.S. and R.S., 1OT2OD026673-01 to R.S., DP2HG009623-01 to R.S., R21HG009748-03 to P.S., U19AI128914 to R.G., and UM1 AI068618 to J.M.M.), the <funding-source id=\"gs3\"><institution-wrap><institution-id institution-id-type=\"doi\">10.13039/100000865</institution-id><institution>Bill and Melinda Gates Foundation</institution></institution-wrap></funding-source> (OPP1113682 to C.A.B. and A.J.R.), and the <funding-source id=\"gs4\">Brotman Baty Institute</funding-source> (to M.Z.).</p><sec id=\"sec5\"><title>Author contributions</title><p id=\"p0845\">P.S. and R.S. conceived the study. Y.H., S.Z., A.B., C.D., M.Z., P.H., J.J., A.S., and T.S. performed computational work, supervised by R.G. and R.S. S.H., E.A.-N., W.M.M., M.J.L., A.J.W., M.S., E.P., E.P.M., L.B.F., B.Y., and A.J.R. performed experimental work, supervised by J.M.E., C.A.B., and P.S. All authors participated in interpretation and writing the manuscript.</p></sec><sec sec-type=\"COI-statement\" id=\"sec6\"><title>Declaration of interests</title><p id=\"p0850\">In the past three years, R.S. has worked as a consultant for Bristol-Myers Squibb, Regeneron, and Kallyope and served as an SAB member for ImmunAI, Apollo Life Sciences GmbH, Nanostring, and the NYC Pandemic Response Lab. R.G. has received consulting income from Juno Therapeutics, Takeda, Infotech Soft, Celgene, and Merck, he has received research support from Janssen Pharmaceuticals and Juno Therapeutics, and he declares ownership in CellSpace Biosciences. P.S. is a co-inventor of a patent related to this work. B.Z.Y. is an employee at BioLegend Inc., which is the exclusive licensee of the New York Genome Center patent application related to this work.</p></sec></ack><fn-group><fn id=\"app1\" fn-type=\"supplementary-material\"><p id=\"p0855\">Supplemental information can be found online at <ext-link ext-link-type=\"uri\" xlink:href=\"https://doi.org/10.1016/j.cell.2021.04.048\" id=\"intref0210\">https://doi.org/10.1016/j.cell.2021.04.048</ext-link>.</p></fn></fn-group></back></article>",
  "plain_text": "Introduction The potential to catalog and characterize the rich diversity of cell types in the human immune system represents a powerful opportunity for single-cell genomics ( Chen et al., 2019a ; Gomes et al., 2019 ; Jaitin et al., 2014 ; Papalexi and Satija, 2018 ; Stubbington et al., 2017 ), yet also reveals the limitations of current approaches. Although established technologies like single-cell RNA-seq (scRNA-seq) are capable of discovering new cell types and states in heterogeneous tissues, transcriptomics alone is often incapable of separating molecularly similar, but functionally distinct, categories of immune cells. Despite tremendous functional diversity, distinct populations of T cells such as effector, regulatory, γδ, and mucosal associated invariant T (MAIT), often cannot be effectively separated by scRNA-seq alone, even when using the most sensitive and cutting-edge technologies ( Ding et al., 2020 ; Mereu et al., 2020 ). This reflects technical challenges driven by the minimal RNA content of T cells coupled with high RNase expression ( Andreeff et al., 1978 ; Lu et al., 2018 ; Sercan Alp et al., 2015 ), which hampers scRNA-seq data quality. More broadly, this exhibits the challenge of defining cell states based on the transcriptome alone, because important sources of cellular heterogeneity may not correlate strongly with transcriptomic features despite being identifiable in other modalities. Multimodal single-cell technologies, which simultaneously profile multiple data types in the same cell, represent a new frontier for the discovery and characterization of cell states. For example, we recently introduced CITE-seq ( Stoeckius et al., 2017 ), which leverages oligonucleotide-conjugated antibodies to simultaneously quantify RNA and surface protein abundance in single cells via the sequencing of antibody-derived tags (ADTs). Moreover, pioneering technological advancements now enable the simultaneous profiling of transcriptome alongside either chromatin accessibility ( Cao et al., 2018 ; Chen et al., 2019b ), DNA methylation ( Gaiti et al., 2019 ; Luo et al., 2019 ), nucleosome occupancy ( Clark et al., 2018 ; Pott, 2017 ), or spatial location ( Rodriques et al., 2019 ; Vickovic et al., 2019 ). Each of these approaches offers an exciting solution to overcome the inherent limitations of scRNA-seq and to explore how multiple cellular modalities affect cellular state and function ( Zhu et al., 2020 ). The maturation of multimodal single-cell technologies also necessitates the development of new computational methods to integrate information across different data types ( Efremova and Teichmann, 2020 ). For example, although CITE-seq datasets can be analyzed by first identifying clusters based on gene expression values ( Peterson et al., 2017 ; Stoeckius et al., 2017 ) and subsequently exploring their immunophenotypes, a multimodal computational workflow would define cell states based on both modalities. Importantly, these strategies must be robust to potentially large differences in the data quality and information content for each modality. In some contexts, robust protein quantifications may be most valuable for clustering, especially with a large and well-designed antibody panel. In other contexts (particularly when important cell type markers are missing or not previously known), the unsupervised nature of a cell’s transcriptome may be the most valuable. The varying information content of each modality, even across cells in the same dataset, represents a pressing challenge for the analysis and integration of multimodal datasets. Here, we introduce “weighted-nearest neighbor” (WNN) analysis, an analytical framework to integrate multiple data types measured within a cell and to obtain a joint definition of cellular state. Our approach is based on an unsupervised strategy to learn cell-specific modality “weights,” which reflect the information content for each modality and determine its relative importance in downstream analyses. We demonstrate that WNN analysis substantially improves our ability to define cellular states in multiple biological contexts and data types. We leverage this method to generate a multimodal “atlas” based on a CITE-seq dataset of 211,000 human peripheral blood mononuclear cells (PBMCs), with large cell-surface protein marker panels extending up to 228 antibodies. We utilize this dataset to identify and validate heterogeneous cell states in human lymphocytes and explore how the human immune system responds to vaccination and severe acute respiratory syndrome coronavirus 2 (SARS-CoV-2) infection. Our approach, implemented in an updated version 4 of our open source R toolkit Seurat, represents a broadly applicable strategy for integrative multimodal analysis of single-cell data. Results Quantifying the relative utility of each modality in each cell We sought to design a robust analytical workflow for the integration of multiple measurements collected within the same cell. To be applied to a range of biological contexts and data types, our strategy must successfully address the following criteria. First, the workflow must be robust to potentially vast differences in data quality between the modalities. Second, integrative multimodal analysis should enable multiple downstream analytical tasks, including visualization, clustering, and the identification of cellular trajectories. Last, and most importantly, simultaneous analysis of multiple modalities should improve on the ability to discover and characterize cell states, compared to independent analyses of each modality when performed separately. These challenges highlight the importance of a flexible framework to handle diverse datasets. As previously described for CITE-seq ( Mimitou et al., 2019 ; Stoeckius et al., 2017 ), the increased copy number of protein molecules compared to RNA molecules typically leads to more robust detection of protein features. The protein data in CITE-seq may therefore represent the most informative modality, particularly in cases where the antibody panel comprehensively represents all cell subsets with high specificity. Other panels may omit antibodies for key or previously undiscovered markers, or contain antibodies with low binding specificity, in which case the unsupervised nature of scRNA-seq may be most informative. Even within the same dataset, the relative utility of each modality to define cell states may vary across individual cells. We therefore designed an analytical solution to address these goals, without requiring prior knowledge from the user regarding the importance of each modality. We first introduce and demonstrate our solution on our previously generated CITE-seq dataset of 8,617 cord blood mononuclear cells, with a panel of 10 immunophenotypic markers ( Stoeckius et al., 2017 ). Independent unsupervised analysis of the RNA and protein data revealed largely consistent cell classifications ( Figures 1 A, 1B, and S1 ) but did exhibit some differences. For example, CD8 + and CD4 + T cells were partially blended together when analyzing the transcriptome but separated clearly in the protein data. Contrastingly, conventional dendritic cells (cDCs), along with a rare population of erythroid progenitors and spiked-in murine 3T3 controls, formed distinct clusters when analyzing RNA but were intermixed with other cell types based on surface protein abundance. With biological foresight, the cell-type-specific differences across modalities could be predicted by the composition of the CITE-seq panel, which contained anti-CD4 and anti-CD8 antibodies but lacked any immunophenotypic markers to discriminate cDCs. For each cell, we began by independently calculating sets of k = 20 nearest neighbors for each modality. We found that for CD8 + T cells, the most similar RNA neighbors often reflected a mix of CD8 + and CD4 + T cells (in the RNA KNN graph, there are a total of 944 incorrect edges that connect CD8 + to CD4 + T cells). By contrast, protein neighbors were predominantly correctly identified as CD8 + T cells (in the protein KNN graph, 12 CD8 + /CD4 + edges were identified). This reflects the particular utility of protein data when defining the state of these cells. Next, we independently averaged the molecular profiles of protein neighbors and RNA neighbors (i.e., predicted the molecular contents of a cell from its neighbors), and compared the averages to their original measured values. We found that for CD8 + T cells, protein KNN-based predictions were more accurate compared to RNA KNN-based predictions ( Figures 1 C and 1D), whereas the converse was true for cDCs ( Figure S1 ). We then leveraged the relative accuracy of these predictions to calculate RNA and protein modality “weights,” describing their relative information content for each individual cell. We provide a detailed mathematical description for each component of the WNN workflow in the STAR Methods , highlighting three key steps: (1) obtaining within modality and cross-modality predictions, (2) converting these to prediction affinities, based on a cell-specific bandwidth kernel, and (3) calculating modality weights using a softmax transformation. The RNA and protein modality weights are non-negative, unique to each cell, and sum to 1. Our final step integrates the modalities to create a WNN graph. For each cell, we calculate a new set of k -nearest cells based on a metric that reflects the weighted average of normalized RNA and protein similarities ( STAR Methods ). The WNN graph is a single representation of a multimodal dataset, but should more accurately reflect the richness of both data types. For example, the WNN graph contained only 20 CD8 + /CD4 + edges. Moreover, many common analytical tasks for single-cell data—including t-distributed stochastic neighbor embedding)/uniform manifold approximation and projection (t-SNE/UMAP) visualization, clustering, and trajectory inference—can accept a user-specified neighbor graph as input. We therefore used our WNN graph to derive an integrated UMAP and clustering of our CITE-seq dataset ( Figure 1 E). In contrast to the separate analysis of either modality, our joint integration clearly separated CD4 + and CD8 + T cells, retained the identity of cDCs, and also uncovered additional sources of subtle heterogeneity within natural killer (NK) cells ( Figure S1 ). We observed that cells classified as CD8 + T cells were assigned higher protein modality weights, whereas DCs were assigned higher RNA modality weights, recapitulating our biological expectations despite the fact that the calculation of modality weights was unsupervised and unaware of cell-type labels ( Figure 1 F). WNN analysis is a robust and flexible approach for multimodal analysis We next further explored the performance of our WNN integration, assessed its robustness to fluctuations in data quality, and performed benchmarking against other recently developed methods. For these analyses, we used a more recently generated CITE-seq dataset of human bone marrow, representing 30,672 mononuclear cells with a panel of 25 antibodies. While the samples contained cells across the full spectrum of hematopoietic differentiation, the antibody panel was designed to separate groups of terminally differentiated cells. Consistent with our previous example, WNN integration substantially increased our ability to resolve hematopoietic cell states ( Figures 2 A and S2 ). Once cell states were annotated through integrated multimodal clustering, we were able to discover differentially expressed (DE) genes and proteins in each group, further validating their biological identity and significance ( Figure S2 ). However, although these cell types are defined by both RNA and protein markers, the statistical power in unsupervised analysis of either modality separately was insufficient to identify these populations, demonstrating the importance of joint analysis. Indeed, when examining the cell-specific modality weights, we found that T cell groups—and in particular, populations that were masked in scRNA-seq analyses—all received higher protein modality weights ( Figure 2 B). We found that unsupervised transcriptome-focused clustering was unable to separate these cell states, even if we performed a focused re-clustering using only T cells ( Figure S2 ). Conversely, each of the cell populations with the highest RNA weights represented hematopoietic progenitor populations. As a result, our multimodal analysis was able to identify diverse populations of hematopoietic stem cells, lymphoid-primed multipotent progenitors (LMPP), and progenitors of erythroid, platelet, monocyte, B, and conventional/plasmacytoid DC lineages that could be recovered in scRNA-seq data, even though these groups lacked immunophenotypic markers in our CITE-seq experiment. We confirmed that our results were robust to a range of values for k ( Figure S2 ), and the incorporation of protein information in the WNN graph does not come at the expense of identifying transcriptomically congruent neighborhoods ( Figure S2 ; STAR Methods ). These results suggest that integrated WNN analysis can provide necessary flexibility and allow one data type to compensate for weaknesses in another. We confirmed this using a simulation experiment, where we added increasing amounts of random Gaussian noise to the ADT data, in order to mimic increases in nonspecific binding ( Figure 2 C). We found that the increasing ADT noise led to a decrease in protein weights for all cell types, in a dose-dependent manner. Moreover, protein modality weights were assigned to 0 after a sufficient amount of protein noise was added, correctly instructing downstream analyses to focus only on scRNA-seq data. We next benchmarked WNN analysis against two recently introduced methods for multimodal integration: multi-omics factor analysis v2 (MOFA+) ( Argelaguet et al., 2020 ), which uses a statistical framework based on factor analysis, and totalVI ( Gayoso et al., 2019 ), which combines deep neural networks with a hierarchical Bayesian model. Both methods integrate the modalities into a latent space, which we used to construct an integrated k -NN graph and a 2D UMAP visualization. We reasoned that we could quantify the performance of the different methods by comparing the similarity of each cell’s molecular state to its closest neighbors in the integrated latent space. We found that for each of the 25 proteins ( Figure 2 D), as well as the RNA transcriptome ( Figure S2 ), WNN analysis exhibited superior or equivalent performance to alternative approaches. The difference in performance was particularly striking for markers of regulatory (CD25) and effector (CD57) T cells. This was consistent with UMAP visualization, in which WNN was the only method where these populations were not intermixed with other groups ( Figure S2 ). WNN analysis also exhibited significant improvements in speed, ranging up to 15-fold when analyzing the full dataset ( Figure 2 E). Although we primarily demonstrate our approach on CITE-seq datasets, our strategy is applicable to diverse multimodal technologies. For example, recent developments have enabled the simultaneous measurement of ATAC-seq profiles and transcriptomes from single nuclei ( Cao et al., 2018 ; Chen et al., 2019b ). We applied WNN analysis to a dataset of 11,351 paired PBMC profiles generated by the 10x Genomics Multiome ATAC+RNA kit. We found that the combination of modalities exhibited maximal power to separate immune subsets ( Figure S3 ). Interestingly, similar to our CITE-seq analyses, we found that ATAC-seq data were more capable of separating naive CD8 + and CD4 + T cell states due to reliable detection of cell-type-specific open chromatin regions ( Figure S3 ). The separation of these clusters upon UMAP visualization ( Figure S3 ) was consistent with the number of incorrect naive CD8 + /CD4 + edges identified in each representation (RNA KNN: 984, ATAC KNN: 373, WNN: 322). The combination of ATAC and RNA data also allowed us to identify differentially accessible DNA sequence motifs between our WNN-defined clusters. For example, we found that ATAC-seq peaks accessible in MAIT cells were highly enriched for motifs for the pro-inflammatory transcription factor RORγt ( Ivanov et al., 2006 ; Willing et al., 2018 ), which was also upregulated transcriptionally in these cells ( Figure S3 ). We obtained highly concordant results when applying WNN analysis to ASAP-seq ( Mimitou et al., 2020 ), a third multimodal technology, that pairs measurements of surface protein abundance with ATAC-seq profiles in single cells ( Figure S3 ). Last, we considered a recent dataset of 34,774 mouse skin cells generated by SHARE-seq ( Ma et al., 2020 ), which generates paired measurements of chromatin accessibility and gene expression. WNN analysis recapitulated each of the 23 populations described in the original manuscript where unsupervised clustering was performed on transcriptomic measurements, including three subgroups of Basal cells that could be distinguished from scRNA-seq. However, in addition to the published findings, WNN analysis identified a novel population of Basal cells that exhibits distinct chromatin accessibility profiles, but does not exhibit unique transcriptomic characteristics ( Figure S3 ). As basal cells in the skin are continually replenished ( Epstein, 2008 ), cells that exhibit a primed chromatin state preceding transcriptomic shifts may differ in their proliferative and regenerative potential. We found that the Basal_4 population was specifically characterized by increased chromatin accessibility at CTCF and p53 motifs ( Demirkan et al., 2000 ) ( Figure S3 ). Notably, basal cell carcinoma, the most common form of skin cancer, is often characterized by mutations in p53 and CTCF binding sites ( Poulos et al., 2016 ) and results in uncontrolled basal cell division. Taken together, these findings demonstrate that the ability of WNN to identify subpopulations that are masked by scRNA-seq alone is not limited to immune or CITE-seq datasets. We conclude that WNN analysis is capable of sensitively and robustly characterizing populations that cannot be identified by a single modality, exhibits best-in-class performance, and can be flexibly applied to multiple data types for integrative and multimodal analysis. A multimodal atlas of the human PBMCs Although flow cytometry and cytometry by time of flight (CyTOF) are widely used and powerful approaches for making high-dimensional measurements of protein expression in immune cells ( Bendall et al., 2011 ; Bodenmiller et al., 2012 ; Diggins et al., 2015 ; Saeys et al., 2016 ), CITE-seq’s use of distinct oligonucleotide barcode sequences provides a unique opportunity to profile very large panels of antibodies alongside cellular transcriptomes. In addition, we have recently demonstrated that the signal-to-noise for each antibody can be optimized for any individual marker as a function of antibody concentration, and we have shown that CITE-seq data quality does not deteriorate with greater amounts of total antibody ( Stoeckius et al., 2018 ). We therefore curated and optimized a panel of TotalSeqA reagents encompassing 228 antibodies ( Table S1 ) comprising a diverse set of lineage and activation markers. We leveraged the CITE-seq technology alongside our optimized antibody panel and integrative WNN analysis strategy to generate a multimodal atlas of human PBMCs. We obtained PBMC samples from eight volunteers enrolled in an HIV vaccine trial ( Elizaga et al., 2018 ; Li et al., 2017 ), with ages spanning from 20–49 years. For each subject, PBMCs were collected at three time points: immediately before (day 0), 3 days, and 7 days following administration of a VSV-vectored HIV vaccine ( Figure 3 A). For each sample, we profiled cells using 10x Chromium 3′ (using 228 TotalSeq A antibodies), representing a total of 161,764 cells (average of 8,003 unique RNA molecules/cell, 5,251 unique ADT/cell). We also profiled a total of 49,147 cells (54 antibodies) split across all samples using ECCITE-seq ( Mimitou et al., 2019 ), which also enables immune repertoire profiling with the 10x 5′ technology. After NovaSeq sequencing, stringent quality control, and doublet filtration ( STAR Methods ), our final dataset consists of 210,911 total cells and allows us to profile cellular heterogeneity in both the resting (unvaccinated) and activated (post-vaccination) immune system. We applied our “anchor-based” workflow ( Stuart et al., 2019 ) to first integrate the samples together, enabling cells to cluster together based on their shared biological state, as opposed to sample-of-origin ( STAR Methods ). Although this causes unvaccinated and vaccinated samples to cluster together initially, it enables us to annotate cell states consistently in all samples, and to learn cell-type-specific responses in downstream analyses. We then performed joint analysis of both modalities using WNN integration, and as a comparative control, visualized the dataset using the RNA and protein modalities independently ( Figures 3 B–3D). We identified 57 clusters in WNN analysis, encapsulating all major and minor immune cell types and revealing striking cellular diversity particularly within lymphoid lineages. With rare exceptions for infrequent cell types, each cluster included cells from all 24 samples. Our clusters could be readily grouped into larger categories, including CD4 + T cells (12 clusters), CD8 + T cells (12 clusters), unconventional T cells (7 clusters), NK cells (6 clusters), B cells, plasma cells, and plasmablasts (8 clusters), dendritic cells and monocytes (8 clusters), and rare clusters of hematopoietic progenitors, platelets, erythrocytes, and circulating innate lymphoid cells (ILC). To assist in the interpretation of our clusters, we assign each cell three annotations with increasing granularity (level 1, 8 categories; level 2, 30 categories; level 3, 57 categories). Although we saw the greatest level of heterogeneity within T cell subsets, our analysis clearly identified heterogeneous subsets of myeloid cells that were fully concordant with recent high-resolution scRNA-seq analyses of sorted populations, including extremely rare populations (0.02%) of dendritic cells defined by the expression of AXL and SIGLEC6 ( See et al., 2017 ; Villani et al., 2017 ) (ASDC; Figure S4 ). We also identified substantial heterogeneity in the expression of inflammatory genes such as IL1B and CCL3 within monocyte populations, but because this heterogeneity varied across different volunteers, we conservatively did not further subdivide these states ( Figure S4 ). We next identified differentially expressed RNA and immunophenotype markers for each cluster. We found that each cluster exhibited distinct molecular patterns and biomarkers for both modalities ( Figure 4 A; additional heatmaps in Figure S4 ). Moreover, these identified biomarkers were invariant across human volunteers and vaccination time points. Despite the fact that clusters were enriched for both RNA and protein markers, our ability to identify these groups was substantially reduced without WNN analysis, as multiple clusters blended together when performing separate analysis of either RNA or protein data ( Figures 3 B and 3C). We conclude that multimodal integration is essential for the unsupervised discovery and annotation of immune cell states; however, once these states are enumerated, supervised differential analyses are capable of sensitively describing markers that define their molecular state. Due to the robust detection of protein features in CITE-seq combined with the size of our antibody panel, we reasoned that we could discover small panels of immunophenotypic markers to perform targeted enrichment through flow cytometry. We used stepwise variable selection coupled with logistic regression ( STAR Methods ) to identify the best antibody marker panels of different sizes (1–10 markers) for each subset, and calculated the level of enrichment in silico ( Figure 4 C). We found that a single marker was capable of achieving effective enrichment of at least 10-fold for 45 clusters, whereas a panel with three markers was sufficient to achieve 10-fold enrichment for 55 clusters. We confirmed that this marker discovery procedure identifies effective panels for well-characterized populations (plasmacytoid DC [pDC]: CD123 + ; MAIT cells: CD3 + CD161 + TCRvɑ7.2 + ; CD4 naive: CD4 + CD45RA + CD45RB + ). In other instances (e.g., cytotoxic populations of CD4 + lymphocytes), our analysis identified CD43 as a marker with high enrichment power that has not been previously reported. For this population, as well as a subgroup of highly cytotoxic CD8 + T cells (CD8_TEM_5), we successfully validated our enrichment panels in an independent set of PBMCs from healthy donors by conventional flow cytometry followed by bulk RNA-seq ( STAR Methods ). In both cases, we examined the expression level of genes that we expected to be DE-based on our CITE-seq data, and we observed clear agreement between the sorted bulk profiles and CITE-seq clusters ( Figures 4 D and 4E). Notably, our flow cytometry experiments utilized the exact antibody clones represented in the CITE-seq experiment, which can help to ensure that the two assays will return concordant results. We report each of these panels in Table S2 to facilitate similar experiments for additional clusters in our dataset. We note that although these panels can achieve high levels of enrichment, even optimally sorted groups may contain a minority of contaminating cells from other states. We show precision and recall metrics for each panel in Figure S4 , demonstrating that it remains challenging to sort truly “homogeneous” populations of high-resolution subsets using a small number of markers. Multimodal heterogeneity within lymphoid populations Our integrated WNN analysis reveals a rich diversity of T cell states that is not typically captured in scRNA-seq analyses, including CD4 + regulatory T cells, MAIT cells, multiple subpopulations of γδ and double-negative T cells, along with heterogeneous subpopulations of naive, memory, and effector states. Within CD8 + memory T cells, we identified distinct subpopulations defined by bimodal and mutually exclusive expression of the integrin proteins CD49a and CD103 ( Figure 5 A). Although we identified these cells in peripheral blood, expression of these proteins has traditionally been strongly associated with tissue-resident memory (TRM) cells, where integrins help mediate adhesion to epithelial cells or the extracellular matrix ( Corgnac et al., 2018 ; Topham and Reilly, 2018 ). CD8 + CD103 + T cells expressed high surface protein levels of the heterodimeric co-binding partner integrin beta-7 ( Figure 5 B), while expression was absent in CD8 + CD49a + groups. We validated the presence of the populations in independent healthy PBMC samples by performing flow cytometry for the same markers ( Figures 5 C and 5D). In addition, we identified modules of differentially expressed genes between these two groups ( Figure 5 E), which were enriched for T cell activation, differentiation, signaling response, and chemotaxis modules ( Figure 5 F). Both populations did not express the canonical resident marker CD69 ( Szabo et al., 2019 ; Walsh et al., 2019 ) ( Figure S5 ), suggesting that they are not TRMs that have temporarily detached and re-entered circulation. Instead, these subpopulations may represent cells that are preparing to become tissue-resident and have already begun to acquire distinguishing molecular characteristics. In addition to characterizing heterogeneity in mRNA and protein expression, we leveraged our 5′ dataset to explore the relationship between molecular state and TCR sequence ( STAR Methods ). Overall clonal diversity was consistent across vaccination time points, consistent with an expected lack of a lymphoid response to vaccination within 7 days, and 97% of clones consisted only of a single cell. However, we also observed the presence of expanded clonal populations. As a positive control, we observed populations with highly restricted usage of TCRα sequences: both MAIT and invariant NKT cells exhibited closely related transcriptional profiles ( Huang et al., 2019 ) and semi-invariant repertoires across multiple volunteers ( Figure S5 ). Excluding these populations, we identified 31 additional expanded clones consisting of at least 10 cells ( Figure 5 G). In each case, cells within a clonal population exhibited extremely similar molecular profiles ( Figure 5 H), representing subgroups of CD8 + T cells (primarily within our previously identified CD8_TEM_4 and CD 8_TEM_5 clusters), as well as cytotoxic CD4 + T cells (CD4 CTL). Each clone typically represented cells from a single volunteer, but could be independently found across multiple time points, including before vaccination ( Figure 5 G). Because our sample volunteers were generally middle-aged and otherwise healthy, we considered the possibility that overexpanded clones could be related to cytomegalovirus (CMV) infection ( Kim et al., 2015 ). We assessed the CMV status of each volunteer by stimulating PBMCs with a CMV peptide pool and performing intracellular cytokine staining to determine responses in CD8 + T cells ( Table S3 ; STAR Methods ), identifying five positive and three negative volunteers. We found that the five positive samples accounted for 91% of cells within expanded clones. We note that although WNN integration improves the ability to discover distinct cell subpopulations, it can also improve the characterization of cellular trajectories and continuous sources of heterogeneity. For example, within B cells, we identified a continuous trajectory connecting naive to memory cells defined by the canonical protein markers immunoglobulin D (IgD) and CD27, along with a module of correlated genes ( Figure S5 ). Similarly, NK cells were subdivided into five clusters, representing variation across a continuous landscape. Our data show that the traditional division of NK cells into CD56-bright and CD56-dim categories represents a broader continuum defined by CD16 expression, alongside a module of genes that modulate cytotoxicity and correlate both positively and negatively with this marker ( Figure 5 I). We also observed a second gradient defined by CD38 expression that, to our knowledge, has not been previously described. Notably, KLRC2 , which encodes the NK activating receptor NKG2C was negatively associated with this continuum, while the signaling adaptor FCER1G was positively associated ( Figure 5 J). This expression pattern is consistent with the development of “adaptive” or “memory-like” NK cells observed in CMV seropositive individuals ( Lee et al., 2015 ; Schlums et al., 2015 ). Notably, we observed consistent trends when restricting our analysis only to individuals with either positive or negative CMV T cell responses ( Figure S5 ). We also observed consistent results ( Figure S5 ) in an independent CITE-seq dataset of human PBMCs ( Kotliarov et al., 2020 ). Our results indicate that this phenotype does not represent a strictly binary phenomenon and may not be specific to CMV response. Finally, we observed minimal correlation between CD38 and CD16 expression ( Figure 5 K), demonstrating that NK cells fall along a two-dimensional gradient defined by these markers. Taken together, these results demonstrate that our dataset represents a powerful resource to enumerate cell states in the immune system, identify optimal reagents for cell-type-specific enrichment, and to understand the molecular heterogeneity in clonally related or antigen-specific cell groups. Because these results are consistent in both pre- and post-vaccination time points, they likely describe general characteristics of the healthy immune system. Characterizing the initial innate response to vaccination We next explored our dataset to characterize the response to vaccination for each of our previously identified cell types. We were particularly interested to identify cell populations that contribute most strongly to the innate immune response, which is expected to be highly activated at our first vaccinated time point (day 3), and subsequently dampen in our second time point (day 7) as seen with another non-replicating viral vectored HIV vaccine ( Zak et al., 2012 ). As expected, we observed robust responses in a subset of myeloid subpopulations, but only minimal responses in lymphoid groups ( Figures 6 A and 6B). Response patterns were also largely consistent across samples with the exception of one volunteer that exhibited a highly activated immune system in advance of vaccination and was removed from further analysis ( Figure S6 ). We observed the strongest changes in both CD14 + classical and CD16 + non-classical monocytes, as both cell types upregulated a shared module of 62 genes highly enriched for transcripts responsive to type I interferon ( Figures 6 A, 6B, and S6 ; visualization in Figure 6 B from Alquicira-Hernandez and Powell [2020 ]). In addition, we identified Siglec-1 (CD169) as a protein response biomarker that was robustly induced only in day 3 samples ( Figure 6 C). When we examined dendritic cell populations, we observed a similarly robust response only within CD1C + cDC2 cells. Contrastingly, closely related populations of CD141 + cDC1, as well as ASDC and pDC, exhibited minimal responses, and we did not detect any DE genes before and after vaccination for these groups ( Figure 6 A). This indicates that within DC subgroups, cDC2s may perform an important role in the downstream priming and activation of the adaptive immune system during this vaccine response. We did not observe significant changes during the time course in overall abundance of broad immune classes ( Figure 6 E;); thus, we focused on identifying more subtle compositional changes. For example, although the overall proportion of monocytes was consistent across time points, there was a strong shift in the ratio between classical and non-classical populations between day 0 and day 3 ( Figure 6 F). We validated this result, as well as the observed return to baseline ratios at day 7, using flow cytometry on the same samples ( Figure 6 G). We did not observe changes within lymphoid cells with one exception: a small population of NK cells expressing proliferation and cell-cycle genes (NK_proliferation), consistently increased upon vaccination ( Figure 6 F). These findings were reproducible in independent analyses of the 3′ and 5′ scRNA-seq experiments and persisted in both day 3 and day 7 samples ( Figures 6 F and S6 ). This finding may reflect an early step in the development and maturation of NK cells, a key component of the NK cell-mediated innate immune response ( Abel et al., 2018 ). Mapping query datasets to multimodal references Single-cell transcriptomic profiling of the immune system has become routine, not only for healthy subjects, but also in multiple clinical contexts including for patients hospitalized with COVID-19. These datasets are typically processed using a workflow that consists of unsupervised clustering, which assumes minimal prior knowledge and is ideally suited for cell type discovery. However, having constructed a multimodal reference of the immune system, we sought to leverage this dataset to assist in the analysis and interpretation of additional single-cell experiments profiling human PBMCs (queries), even if only the transcriptome was profiled. We first apply a procedure known as “supervised principal component analysis” (sPCA) ( Barshan et al., 2011 ) to the transcriptome measurements in our reference dataset. Instead of seeking to identify a low-dimensional projection that maximizes total variance as in PCA, sPCA identifies a projection of the transcriptome dataset that maximally captures the structure defined in the WNN graph. Formally, given a gene expression matrix X and a WNN graph Y, sPCA identifies the transformation matrix U that maximizes the Hilbert-Schmidt Independence Criterion measure between a linear kernel of U T X and Y ( STAR Methods ). Informally, sPCA allows the weighted transcriptome and protein measurements to help “supervise” the analysis of gene expression data and identify the optimal transcriptomic vectors (gene modules) that define the cell states in our multimodal reference. We compute this sPCA transformation on our reference (where both mRNA and protein were measured simultaneously), but can subsequently rapidly project this transformation onto any scRNA-seq query dataset. Combining this transformation with our previously described “anchor”-based framework ( Stuart et al., 2019 ) allows us to place each scRNA-seq query cell on the previously defined reference UMAP visualization ( STAR Methods ) and annotate its identity based on reference clusters. We found that this supervised mapping procedure dramatically improved our ability to analyze and interpret query scRNA-seq datasets compared to unsupervised analysis. We examined a recently generated dataset of human PBMCs prior to flu vaccination, which measured the transcriptomes of 53,099 cells alongside 82 surface proteins. We mapped this dataset onto our reference using only the transcriptome data and transferred our level 2 annotations, revealing the presence of multiple high-resolution lymphoid subsets ( Figure S7 ). We verified the accuracy of our predictions using the query protein data, which was held out of the reference mapping procedure, yet revealed expression patterns based on our predicted annotations that were fully concordant with our reference dataset. For example, cells that were annotated as regulatory T cells expressed CD25 in the CITE-seq data, and we observed similar results for MAIT cells (CD161 + ), memory (CD45RA − CD45RO + ) and naive (CD45RA + CD45RO − ) T cells, and circulating ILC (CD117 + CD25 + ) ( Figure S7 ). We benchmarked our method against scArches, a recently developed method for mapping scRNA-seq queries to reference datasets ( Lotfollahi et al., 2020 ) and observed that our approach yielded substantial improvements in accuracy and performance ( Figures 7 A, 7B, and S7 ). We next applied our mapping approach to a recent scRNA-seq study analyzing PBMC samples from seven patients hospitalized with COVID-19, alongside six healthy controls ( Wilk et al., 2020 ). The original publication performed unsupervised clustering on the full dataset and identified six T cell clusters (three CD4 + T, two CD8 + T, and γδ T cells). In our supervised analysis, we transferred our level 2 annotations, successfully dividing T cells into the 12 groups ( Figure 7 C, D). Notably, populations of developing and differentiated neutrophils, which were identified by the original manuscript as being uniquely present in COVID-19 samples but were absent from our reference, could not be successfully mapped ( Figure S7 ). We leveraged our supervised annotations to test for differences in cell type abundance across disease conditions. Our findings recapitulated the original unsupervised analysis, for example, highlighting increases in plasmablast frequency during COVID-19 response ( Figure S7 ). However, we also observed proportional shifts in cell states that were not detected in unsupervised clustering but were successfully annotated after reference mapping. In particular, we observed a depletion of MAIT cells in COVID-19 samples compared to healthy controls. To validate our findings, we performed CyTOF on both the original samples and a validation cohort of 16 additional samples. We observed strong quantitative agreement (R = 0.911) in the fraction of MAIT cells predicted by scRNA-seq and measured by CyTOF in the original cohort ( Figure 7 E). Moreover, CyTOF analysis of the larger sample set identified a depletion of MAIT cells in COVID-19 samples ( Figures 7 F and S7 ). This change in abundance may reflect these cells exiting circulation to play protective roles in barrier tissues during the antiviral immune response ( Grimaldi et al., 2014 ; Hinks and Zhang, 2020 ; Provine and Klenerman, 2020 ). Discussion In order to leverage multiple data types to define cellular identity, we developed WNN analysis, a computational method that learns the information content of each modality and generates an integrated representation of multimodal data. By calculating cell-specific modality weights, WNN analysis solves an important technical challenge for the analysis of multimodal datasets and allows for flexible application across a range of modalities and data types. We demonstrate throughout this manuscript that performing downstream analyses on a weighted combination of data types improves our ability to characterize cellular diversity. We apply our approach to analyze a dataset of human PBMCs featuring paired transcriptomes and measurements of 228 surface proteins, representing a multimodal atlas of the immune system. We leverage this resource to characterize extensive lymphoid heterogeneity that has not been previously observed by scRNA-seq alone, including the heterogeneous expression of integrin proteins on circulating memory T cells, a gradient of adaptive-like responses in NK cells, and tightly clustered clonal populations within effector and cytotoxic groups. Our data also enable us to explore the response of the innate immune system to vaccination, highlighting specific response biomarkers, as well as the heterogeneous responses of conventional DCs. Importantly, we demonstrate that CITE-seq data can be easily mined to identify the best immunophenotypic marker panels for any subpopulation of interest. These marker panels can be used for flow cytometry with the same antibody clones in our CITE-seq panel, facilitating rapid enrichment and downstream analysis of these groups, and broadening the value of our resource. In addition to constructing a multimodal reference, we demonstrate the ability to map scRNA-seq data onto this dataset. We accomplish this via a supervised version of principal component analysis to identify the best transcriptomic modules which delineate our WNN-defined cell types. Supervised mapping represents an attractive alternative to unsupervised analysis, and we show how this workflow can improve cell type identification and robustly integrate samples from multiple donors and disease states. To assist the community in utilizing our resource, we have created a web application, freely available at https://azimuth.hubmapconsortium.org/ , which enables users to rapidly map their own datasets online, automating the process of visualization and annotation. Using this approach, a dataset of 50,000 cells can be fully processed and mapped in less than 5 min. As the profiling of human PBMCs under a variety of disease states becomes increasingly routine, the ability to perform automated mapping of these datasets will facilitate the characterization of complex immune responses, and the discovery of pathogenic populations. We note that our supervised mapping is not limited to scRNA-seq and can be extended to other modalities. For example, future extensions of this work could modify our supervised PCA procedure to identify optimal transformations of multiplexed protein measurements. This would enable the mapping of mass cytometry profiles to our multimodal reference, even in the absence of transcriptomic data. Last, we note that the modality weights learned in our procedure serve not only as a proxy for the technical quality of a measurement type, but may also reflect the biological importance of each modality in determining cellular identity. For example, our analyses of human bone marrow demonstrated that progenitor cells and differentiated cells exhibited divergent modality weights. As future technologies enable the simultaneous measurement of modalities spanning the central dogma including chromatin state, DNA methylation, transcription, lineage, spatial location, and protein levels—WNN analysis may help to reveal how subpopulations of cells differentially utilize these modalities to regulate their current state and future potential. Our current implementation of WNN analysis extends to handle three or more simultaneously measured modalities, as these technologies mature. Integrative multimodal analysis therefore provides a path forward to move beyond the partial and transcriptome-focused view of a cell and toward a unified definition of cellular behavior, identity, and function. Limitations of the study We note the following limitations with our study. First, WNN requires a dimensional reduction to describe the neighborhood structure between cells. This requirement is not compatible with categorical or low-dimensional data. Second, WNN assumes that modalities do not define conflicting sets of cell states. Although we have not observed this when using molecular data such as chromatin state, gene expression, and surface protein abundance, this assumption may be problematic when integrating morphological, functional, and molecular data. In addition, our circulating immune atlas was constructed from PBMCs and therefore contains few cells with no nuclei (erythrocytes) or multi-lobed nuclei (granulocytes). STAR★Methods Key resources table Resource availability Lead contact Further information and requests for resources and reagents should be directed to and will be fulfilled by the Lead Contact, Rahul Satija ( rsatija@nygenome.org ) Materials availability No unique reagents were generated for this study. Data and code availability CITE-seq data generated for this manuscript is available to download and explore at https://atlas.fredhutch.org/nygc/multimodal-pbmc/ . All CITE-seq and ECITE-seq raw data are available in GEO database under the accession number GEO: GSE164378. All raw sequencing data are deposited in the dbGaP under the accession number dbGaP: phs002315.v1.p1. Seurat v4 is released under the open source GPLv3 license, and all code is available at https://www.github.com/satijalab/seurat . To facilitate the mapping of new query datasets to the multimodal PBMC reference described in this manuscript, we have released an automated web app, Azimuth: https://azimuth.hubmapconsortium.org/ . Experimental model and subject details HIV vaccine trial specimens HVTN 087 (NCT01578889) was a phase 1a HIV vaccine trial that tested intramuscular electroporation of a DNA vaccine with or without IL-12 adjuvant delivered as a plasmid at months 0, 1 and 3 followed by boosting with VSV-vectored HIV gag vaccine at month 6 ( Elizaga et al., 2018 ; Li et al., 2017 ). Eight participants in this trial were selected for single cell analysis from Group 1 (no IL-12) and Group 3 (1000 mcg IL-12) based on sample availability. Participant demographics and group assignments are listed in Table S1 . Blood was collected immediately before the first VSV-Gag administration and at sequential time points afterward. PBMC were isolated and cryopreserved as previously described ( Bull et al., 2007 ). Method details Antibody titration, staining, and cleanup For CITE-seq / TotalSeq-A / 3P scRNA-seq experiments, we pooled together 228 TotalSeq-A antibodies from BioLegend ( Table S2 ). In preliminary experiments designed to test the balance of markers in the panel, reads corresponding to 12 antibodies each took up more than 2% of the total sequencing space, and combined together, accounted for half of the total antibody reads. The signal for each of these markers was reduced by addition of a proportional amount of unlabeled antibodies. We recommend the addition of unlabeled antibodies as an effective strategy to modify existing panels to be more robust to sequencing saturation from highly expressed protein markers. CITE-seq antibodies and unlabeled blocking antibodies were then combined in PBS and concentrated with a 50 kDa Amicon filter as per manufacturer’s instructions. Post elution, BSA was added to a final concentration of 2%. For ECCITE-seq / TotalSeq-C / 5P scRNA-seq experiments, we used a combination of antibody:oligo conjugates designed for ECCITE-seq ( Mimitou et al., 2019 ), conjugated as described ( Stoeckius et al., 2018 ), and commercially available TotalSeq-C reagents. 52 ECCITE-seq antibodies ( Mimitou et al., 2019 ) were pooled together at a concentration of 1 μg each per test, and combined with TotalSeq-C reagents for CD45RA and CD45RO at 0.25 μg each per test. Antibodies were pooled together and concentrated in a 50 kDa Amicon filter as per manufacturer’s instructions in PBS. Post elution, BSA was added to a final concentration of 2%. CITE-seq staining and sample preparation To minimize batch effects, for each experiment we processed frozen PBMCs from four different patients at 3 different time points (day 0, day 3, and day 7). After thawing, cells were incubated with FcX block (BioLegend) for 10 min. Cells were then divided into separate aliquots and processed independently for the 3P and 5P protocols. For the 3P CITE-seq staining protocol, samples were stained simultaneously with the antibody/block pool and a unique hashtag for 30 min. Cells were then washed 3 times in staining buffer (2% BSA, 0.01% Tween in PBS) and filtered using a 40 μm Flowmi filter in PBS and pooled in equal proportions. Cells were loaded into 8 lanes of a 10x Genomics Chip B, at 45,000 cells per lane using the 10x Genomics 3′ v3 GEM kit. For the 5P ECCITE-seq staining protocol, each sample of cells was first stained with a unique hashtag for 30 min. Cells were then washed 3 times in staining buffer, pooled together, and stained with the antibody panel for 30 min. The pool of cells was then washed 3 times in staining buffer and filtered using a 40μm Flowmi filter in PBS. Cells were loaded into 2 lanes of a 10x Genomics Chip A, at 45000 cells per lane, using the 10x Genomics V(D)J kit (v1). For both 3P and 5P experiments, first strand cDNA was generated by incubating the emulsions according to the respective 10x Genomics protocol. Emulsions were then broken and nucleic acids recovered Subsequent library preparation steps are detailed in the section below. Library prep CITE-seq / 3P scRNA-seq The 10x 3P v3 protocol was followed according to manufacturer’s instructions for cDNA amplification, with the following modifications: • During cDNA amplification, 0.2 μM of ADT additive primer ( 5′CCTTGGCACCCGAGAATTCC ) and 0.2 μM of HTO additive primer (5′GTGACTGGAGTTCAGACGTGTGCTC) were added to the reaction. • During cDNA cleanup, the supernatant from the 0.6x SPRI cleanup was saved and purified with two rounds of 2x SPRI. The eluate was split and used as template for production of ADT and Hashtag libraries: • Hashtag libraries were generated by PCR using Kapa Hifi Master Mix, 10 μM 10x Genomics SI-PCR primer (5′AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTC), and 10 μM Illumina TruSeq DNA D7xx primer (5′CAAGCAGAAGACGGCATACGAGATxxxxxxxxGTGACTGGAGTTCAGACGTGTGC). Following amplification, Hashtag libraries were and cleaned up with 1.6x SPRI. Antibody tag libraries were generated by PCR using Kapa Hifi Master Mix, 10 μM 10x Genomics SI-PCR primer, and 10 μM TruSeq Small RNA RPIx primer (5′CAAGCAGAAGACGGCATACGAGxxxxxxxxGTGACTGGAGTTCCTTGGCACCCGAGAATTCCA) Following amplification, Antibody tag libraries were and cleaned up with 1.6x SPRI. ECCITE-seq / 5P scRNA-seq / immune receptor: The 10x Immune Profiling v1 protocol was followed according to manufacturer’s instructions for cDNA amplification, with the following modifications: • During cDNA amplification, 0.2 μM each of ADT ( 5′CCTTGGCACCCGAGAATT ∗ C ∗ C) , HTO ( 5′GTGACTGGAGTTCAGACGTGTGC ∗ T ∗ C) , and TotalSeq-C additives (5′ CTCGTGGGCTCGGAGATGTGTATAAGAGACAG) were added to the reaction. • Post cDNA cleanup, a 0.6x SPRI cleanup was performed, where larger cDNA fragments were kept on the beads, and the smaller tag libraries were retained in the supernatant. From the material retained on the beads, a portion of the eluted material was used to generate TCR α/β libraries (as written in the 10x protocol), BCR libraries (as written in the 10x protocol) and TCR γ/δ libraries (as written in the 10x protocol for TCR α/β, with these modifications): • 5 μL of cDNA was taken into the initial reaction • For the first PCR, instead of the TCR1 primer mix provided by 10x genomics, we substituted our own mix consisting of primers 5′AGCTTGACAGCATTGTACTTCC and 5′TGTGTCGTTAGTCTTCATGGTGTTCC • For the second PCR, instead of the TCR2 primer mix provided by 10x Genomics, we substituted our own of primers consisting of 5′TCCTTCACCAGACAAGCGAC and 5′GATCCCAGAATCGTGTTGCTC • The 0.6X SPRI supernatant remaining following cDNA cleanup was subjected to 2 rounds of 2x SPRI. The eluate was split into three reactions for tag library production: • Hashtag libraries were created by performing a PCR reaction consisting of Kapa Hifi Master Mix, 10 μM 10x Genomics SI-PCR primer, and 10 μM Illumina TruSeq DNA D7xx primer. • Antibody libraries (for homemade conjugates) were created by performing a PCR reaction with Kapa Hifi Master Mix, 10 μM 10x Genomics SI-PCR primer, and 10 μM TruSeq Small RNA RPIx primer. • TotlaSeq-C antibody libraries were created by performing a PCR reaction with 2x Kapa Hifi Master Mix, 10 μM 10x Genomics SI-PCR primer, and 10 μM Nextera indexing primer (CAAGCAGAAGACGGCATACGAGATxxxxxxxxGTCTCGTGGGCTCGGAGATGTGTATAAGAGACAG). Sequencing For 3P libraries, the samples were pooled in a ratio of 80% RNA, 12% ADT, and 8% HTO. For the 5P libraries, the samples were pooled in a ratio of 70% RNA, 12% ADT, 8% HTO, 5% of TCR libraries (with equal amounts of α/β and γ/δ libraries), and 5% of BCR libraries. 3P and 5P libraries were then pooled together in equal amounts and sequenced on an Illumina Novaseq S4 flowcell. Validation of targeted immunophenotype panels experiments Commercially available cryopreserved PBMCs (AllCells) were thawed into DMEM with 10% FBS. Two million cells per condition (4 conditions) were spun down in Eppendorf tubes at 4°C for 5 min at 400 g , and resuspended in 100 μl PBS with 2% BSA. Each aliquot was incubated for 10 min with 10 μL of FcX block, followed by staining with flow cytometry antibodies (BioLegend) on ice for 30 min. Cells were washed three times with PBS with 2% BSA. Samples were then gated as described below and sorted directly into Buffer RLT (QIAGEN). Antibodies used (all at 5uL per condition unless otherwise noted): Gating conditions for each of the validation experiments are shown in Figures 4 D and 4E. Post sorting, samples were each split into quintuplicates, and then cleaned up with 2x SPRI. Samples were then brought into reverse transcription in an adaptation of SMARTseq2 ( Picelli et al., 2014 ) and SCRB-seq ( Soumillon et al., 2014 ) as described here: https://dx.doi.org/10.17504/protocols.io.nkgdctw . The pooled library was sequenced on an Illumina Nextseq (50 R1, 8 index, 34 R2). Post base calling, samples were aligned using a wrapper for DropSeqTools against the human reference hg19 to generate RNA counts matrices. To assess the agreement between single-cell datasets and bulk-sorted experiments, we examined the top DE genes separating our gated populations in the CITE-seq reference dataset. We next visualized the relative expression of these genes in the heatmaps in Figures 4 D and 4E. The bulk-sorted populations exhibited highly concordant relative expression patterns for DE genes as we observed in CITE-seq data. Flow cytometry analysis of whole blood Whole blood collected immediately before the first VSV gag administration and then 1 and 7 days after was stained in TruCOUNT tubes as previously described ( Elizaga et al., 2018 ; Hensley et al., 2012 ; Hensley-McBain et al., 2014 ) using the following antibody staining panel: (antibodies from BD Biosciences, unless otherwise indicated): CD14–V450, CD19–V450, CD45–AmCyan, CD4–FITC, CD8–PerCP-Cy5.5, CD123–PE, HLA-DR–ECD (Beckman Coulter), CD86–PE-Cy5, CD56–PE-Cy7, CD11c–APC, CD3–Alexa700 and CD16–APC-Cy7. We used these measurements in Figures 6 G and 6H to validate changes in cell type abundance that were detected by scRNA-seq. Determination of cellular responses to CMV Intracellular cytokine staining assays were conducted as described in Li et al. (2017) and the proportion of CD8 + T cells expressing IL-2 and/or IFN-γ after stimulation with a CMV peptide pool as well as the response call are listed are in Table S1 . Mass cytometry PBMC from patients with nasopharyngeal swab PCR-confirmed COVID-19 and healthy controls were thawed into warm RPMI (HyClone/Thermo Scientific) supplemented with 10% FBS and 0.5 × 106 cells per sample were transferred into a 96-well plate for staining. Cells were stained as previously described in Vendrame et al. (2020) , using the panel described in McKechnie et al. (2020) with the addition of the following antibodies to identify MAIT cells: anti-CD161 (DX12, BD Biosciences) conjugated on 141Pr and TCR Vα7.2 (clone 3C10, Biolegend) conjugated on 162Dy. Antibodies were conjugated using MaxPar® X8 Conjugation Kits (Fluidigm, South San Francisco, CA, USA) or purchased pre-conjugated from Fluidigm. With the exception of the antibodies added, the immune profiling panel was premixed and frozen at −80°C in order to ensure antibody stability and minimize differential staining between batches as described in McKechnie et al. (2020) . Briefly, cells were washed with PBS (Rockwell) and resuspended in 25 mM cisplatin (Enzo, Farmingdale, NY, USA) for sixty seconds to stain for viability before being quenched with undiluted FBS. Samples were multiplexed by staining with CD45-Pd barcodes as previously described ( Mei et al., 2015 ), washed thoroughly in CyFACS buffer (PBS, 0.1% BSA, 2mM EDTA, 0.05% sodium azide), and pooled into sets of barcodes. Barcoded samples were then stained with all antibodies for 30 min, washed with CyFACS buffer, and fixed in 2% Paraformaldehyde (Electron Microscopy Sciences, Hatfield, PA, USA) for 20 min at room temperature. Fixed cells were permeabilized with 1x eBiosciences Permeabilization Buffer. Manufacturer ThermoFisher Scientific (Waltham, MA). Samples were washed, resuspended in 2% PFA containing iridium intercalator (Fluidigm), and stored at 4°C until acquisition (within 3 days of staining). On the day of acquisition, samples were washed once with PBS and thrice with Milli-Q water before being resuspended in 1 × EQ Beads (Fluidigm) and collected on a Helios mass cytometer (Fluidigm). Prior to analysis, fcs files were debarcoded and bead-normalized with EQ beads using the Premessa package in the open-source statistical software R as previously described ( Finck et al., 2013 ). FlowJo v10.7.1 was used to visualize the data and used to gate out beads, dead cells, doublets, and cell debris. MAIT cells were identified by expression of CD3, CD161, and TCR Vα 7.2 as shown in Figure S7 . Weighted Nearest Neighbor Analysis The weighted nearest neighbor (WNN) procedure implemented in Seurat v4 is designed to integrate multiple types of data that are collected in the same cells to define a single unified representation of single-cell multimodal data. For each cell, the procedure learns a set of modality weights, which reflect the relative information content for each data type in that cell. This enables the generation of a WNN graph: for each cell, this graph denotes the most similar cells in the dataset based on a weighted combination of protein and RNA similarities. The WNN graph can be used as input for common downstream analytical tasks including tSNE or UMAP visualization, graph-based clustering, and the identification of developmental trajectories. Our approach consists of four broad steps, as explained in detail below: (1) Constructing independent k -nearest neighbor (KNN) graphs for both modalities. (2) Performing within and across-modality prediction (3) Calculating cell-specific modality weights. (4) Calculating a WNN graph. All methods are implemented in our open-source R package Seurat ( https://www.satijalab.org/seurat , https;//www.github.com/satijalab/seurat ). Constructing k-nearest neighbor graphs for each modality The WNN procedure begins by first applying standard analytical workflows to each modality independently and constructing KNN graphs for each one. In this manuscript we analyze data falling into three categories: measurements of single-cell gene expression, single-cell surface protein expression, and single-cell chromatin accessibility (ATAC-seq). For most analyses in this manuscript, we use a default value of k = 20, which is also the default value of k in the standard Seurat clustering workflow. For the analysis of the multimodal PBMC atlas, due to the substantial size of the dataset, we used a value of k = 30. In Figure S2 , we show that we obtain very similar results from the WNN procedure when varying k across a series of values ranging from 10 to 50. For clarity, we overview the analytical workflows for each data type below: Single-cell gene expression: We analyze scRNA-seq data using standard pipelines in Seurat which include normalization, feature selection, and dimensional reduction with PCA. We then construct a KNN graph after dimensional reduction. We emphasize that WNN analysis can leverage any scRNA-seq preprocessing workflow that generates a KNN graph. For example, users can preprocess their scRNA-seq data with a variety of normalization tools including log-normalization, scran ( Lun et al., 2016 ) or SCTransform ( Hafemeister and Satija, 2019 ), and can utilize alternative dimensional reduction procedures such as factor analysis or variational autoencoders. In this manuscript, we use workflows that are available in the Seurat package, and detail exact settings for each analysis later in this document. Single-cell cell surface protein level expression: We analyze single-cell protein data (representing the quantification of antibody-derived tags (ADTs) in CITE-seq or ASAP-seq data) using a similar workflow to scRNA-seq. We normalize protein expression levels within a cell using the centered-log ratio (CLR) transform, followed by dimensional reduction with PCA, and subsequently construct a KNN graph. Unless otherwise specified, we do not perform feature selection on protein data, and use all measured proteins during dimensional reduction. Single-cell chromatin accessibility: We analyze single-cell ATAC-seq data using our previously described workflow ( Stuart et al., 2019 ), as implemented in the Signac package. We reduced the dimensionality of the scATAC-seq data by performing latent semantic indexing (LSI) on the scATAC-seq peak matrix, as suggested by Cusanovich et al. (2018) . We first computed the term frequency-inverse document frequency (TF-IDF) of the peak matrix by dividing the accessibility of each peak in each cell by the total accessibility in the cell (the “term frequency”), and multiplied this by the inverse accessibility of the peak in the cell population. This step ‘upweights’ the contribution of highly variable peaks and down-weights peaks that are accessible in all cells. We then multiplied these values by 10,000 and log-transformed this TF-IDF matrix, adding a pseudocount of 1 to avoid computing the log of 0. We decomposed the TF-IDF matrix via SVD to return LSI components, and scaled LSI loadings for each LSI component to mean 0 and standard deviation 1. As described for scRNA-seq analysis, while we use Seurat and Signac functions in this manuscript, any analytical workflow that computes a KNN graph for surface protein or chromatin accessibility data can also be used in the first step of WNN analysis. Performing within and cross-modality predictions Suppose we have a CITE-seq dataset where two modalities, RNA and protein, are measured in each single cell. From the previous step, we define the following: r i : L2-normalized low-dimensional vector representing the RNA profile for cell i p i : L2-normalized low-dimensional vector representing the protein profile for cell i { k n n r , i , 1 … k n n r , i , k } : the set of k-nearest RNA neighbors for cell i { k n n p , i , 1 … k n n p , i , k } : the set of k-nearest protein neighbors for cell i We average the low-dimensional profiles of each neighbor set, which represent a prediction for the molecular contents for cell i based on their local neighborhoods. We perform both within-modality and cross-modality prediction: Within-modality prediction: r ˆ i , k n n r = ∑ j = 1 k r k n n r , i , j k : prediction of RNA profile for cell i , based on RNA neighbors p ˆ i , k n n p = ∑ j = 1 k p k n n p , i , j k : prediction of protein profile for cell i , based on protein neighbors Cross-modality prediction: r ˆ i , k n n p = ∑ j = 1 k r k n n p , i , j k : prediction of RNA profile for cell i , based on protein neighbors p ˆ i , k n n r = ∑ j = 1 k p k n n r , i , j k : prediction of protein profile for cell i , based on RNA neighbors Calculating cell-specific modality weights We next calculate the similarity between predicted values for each cell r ˆ i and p ˆ i , and the actual values r i and p i . We first compute Euclidean distances between predicted and actual values, and next convert these to affinities using the exponential kernel utilized in UMAP ( McInnes et al., 2018 ). In McInnes et al. (2018) , the authors demonstrate that the distance between a cell and its first nearest neighbor (‘local connectivity’) functions as distance gap that inflates values in both the numerator and denominator of the exponent. Therefore, they subtract local connectivity from cellular distances when computing the exponential kernel. θ r n a ( r i , r ˆ i , k n n r ) = exp ( − max ( d ( r i , r ˆ i , k n n r ) − d ( r i , r k n n r , i , 1 ) , 0 ) σ r , i − d ( r i , r k n n r , i , 1 ) ) affinity between r i and predicted RNA profile ( based on RNA knn ) θ r n a ( r i , r ˆ i , k n n p ) = exp ( − max ( d ( r i , r ˆ i , k n n p ) − d ( r i , r k n n r , i , 1 ) , 0 ) σ r , i − d ( r i , r k n n r , i , 1 ) ) affinity between r i and predicted RNA profile ( based on protein knn ) θ p r o t e i n ( p i , p ˆ i , k n n p ) = exp ( − max ( d ( p i , p ˆ i , k n n p ) − d ( p i , p k n n p , i , 1 ) , 0 ) σ p , i − d ( p i , p k n n p , i , 1 ) ) affinity between p i and predicted protein profile ( based on protein knn ) θ p r o t e i n ( p i , p ˆ i , k n n r ) = exp ( − max ( d ( p i , p ˆ i , k n n r ) − d ( p i , p k n n p , i , 1 ) , 0 ) σ p , i − d ( p i , p k n n p , i , 1 ) ) affinity between p i and predicted protein profile ( based on RNA knn ) In the equations above, d represents the Euclidean distance metric, and σ r , i and σ p , i represent the bandwidth of the RNA and protein kernels for cell i . A commonly used approach is to set the bandwidth of a kernel to reflect the distance between a cell and its k- th nearest neighbor, resulting in an adaptive bandwidth that is specific to each cell ( Haghverdi et al., 2016 ; van Dijk et al., 2018 ). However, the value of k used to compute this bandwidth is typically fixed across all cells. We considered that cells originating from rare states should not have the same bandwidth constraint as cells originating from abundant states, and therefore considered a modified approach to select kernel bandwidths. Our approach is inspired by the concept of large margin nearest neighbors, which aims to identify kernel bandwidths that separate data points in the same class from those in different classes, even if the classes are closely related ( Weinberger and Saul, 2009 ). In the context of unsupervised single-cell analysis (where the data points are unlabeled), we aim to identify a kernel bandwidth that groups together cells in the same state, yet divides cells that originate from closely related (but different) states. Recent work has clearly demonstrated that KNN-graphs are prone to the formation of spurious edges, which represent links between cells that share some similarity molecular profiles, but are not in a matched molecular state ( Levine et al., 2015 ). However, it is possible to identify these spurious edges through the use of the Jaccard metric. This identifies the number of shared nearest neighbors between two cells, thereby exploiting the local density of each data point to separate well-supported from spurious edges. For each cell i , we therefore aim to identify the 20 cells in the dataset with the lowest non-zero Jaccard similarity. We expect that these represent cells that exhibit some similarity with cell i , but are unlikely to reside in the same molecular state. If more than 20 cells share the same Jaccard value, we select the 20 with the furthest euclidean distance to cell i . We take the average of the Euclidean distances from cell i to the 20 selected cells, and set this as the cell-specific kernel bandwidth. We next calculate the ratio between the affinities for r i with predictions based on RNA neighbors, and predictions based on protein neighbors. A large ratio suggests that the local neighborhood of the cell, as defined by its RNA neighbors, better reflects its molecular state. We calculate the analogous ratio for protein affinities. In both cases, we add a small ε (10 −4 ) to the denominator to avoid numerical errors. s r n a ( i ) = θ r n a ( r i , r ˆ i , k n n r ) θ r n a ( r i , r ˆ i , k n n p ) + ε , s p r o t e i n ( i ) = θ p r o t e i n ( p i , p ˆ i , k n n p ) θ p r o t e i n ( p i , p ˆ i , k n n r ) + ε Finally, we normalize these values with a softmax transformation. The resulting two values are non-negative, and together sum to 1. We refer to these as cell-specific modality weights. w r n a ( i ) = e s r n a ( i ) e s r n a ( i ) + e s p r o t e i n ( i ) , w p r o t e i n ( i ) = e s p r o t e i n ( i ) e s r n a ( i ) + e s p r o t e i n ( i ) Calculating a WNN graph We leverage the cell-specific modality weights calculated above to define a new similarity metric between any two cells, which reflects a weighted combination of RNA and protein affinities. For two cells i and cell j , we define their weighted similarity as: θ w e i g h t e d ( i , j ) = w r n a ( i ) θ r n a ( r i , r j ) + w p r o t e i n ( i ) θ p r o t e i n ( p i , p j ) We then construct a WNN graph, defined as a KNN graph constructed using this weighted similarity metric. For each cell, we consider the set k n n r , i , 1 … k n n r , i , 200 ∪ k n n p , i , 1 … k n n p , i , 200 and identify the k - most similar cells within this set based on the weighted similarity metric as weighted nearest neighbors Extending WNN to process more than two simultaneously measured modalities The WNN method can be generalized to analyze single-cell datasets with three or more simultaneously measured modalities. Briefly, we perform within-modality comparisons for each modality, and extend the concept of cross-modality predictions to all pairwise combinations of modalities. We calculate affinity rations comparing within-modality predictions to cross-modality predictions and normalize these values with a softmax transformation. These ideas are a generalization of the methods described for two modalities, with a full mathematical description below for clarity: Suppose the single-cell dataset has M modalities, we define the following: m, n : Two different modalities in the dataset m ∈ [ 1,2 , … M ] , n ∈ [ 1,2 , … M ] , m ≠ n , X i m : L2-normalized low-dimensional vector representing the modality m profile for cell i { k n n m , i , 1 … k n n m , i , k } : the set of k-nearest neighbors from modality m for cell i Within-modality prediction: X ˆ i , k n n m m = ∑ j = 1 k X k n n m , i , j m k : prediction of X i m , based on neighbors from modality m Pairwise cross-modality prediction: X ˆ i , k n n n m = ∑ j = 1 k X k n n n , i , j m k , m ≠ n : prediction of X i n , based on neighbors from modality m We next calculate the within and cross-modality affinities, θ m , m ( X i m , X ˆ i , k n n m m ) and θ m , n ( X i m , X ˆ i , k n n n m ) between within and cross-modality predicted values for each cell X ˆ i , k n n m m and X ˆ i , k n n n m , and the actual values X i m . Within-modality affinity: θ m , m ( X i m , X ˆ i , k n n m m ) = exp ( − max ( d ( X i m , X ˆ i , k n n m m ) − d ( X i m , X k n n m , i , 1 m ) , 0 ) σ m , i − d ( X i m , X k n n m , i , 1 m ) ) Pairwise cross-modality affinity: θ m , n ( X i m , X ˆ i , k n n n m ) = exp ( − max ( d ( X i m , X ˆ i , k n n n m ) − d ( X i m , X k n n m , i , 1 m ) , 0 ) σ r , i − d ( X i m , X k n n m , i , 1 m ) ) , m ≠ n Pairwise affinity ratios (we add a small ε (10 −4 ) to the denominator to avoid numerical errors): s m , n ( i ) = θ m , m ( X i m , X ˆ i , k n n m m ) θ m , n ( X i m , X ˆ i , k n n n m ) + ε , m ≠ n Finally, we normalize these pairwise affinity ratios with a softmax transformation. The resulting m modality weights for each cell are non-negative and together sum to 1. w m ( i ) = ∑ n e s m , n ( i ) ∑ m ∑ n e s m , n ( i ) , m ≠ n For two cells i and cell j , we define their weighted similarity as: θ w e i g h t e d ( i , j ) = ∑ m w m ( i ) θ m ( i , j ) We then construct a WNN graph, defined as a KNN graph constructed using this weighted similarity metric. For each cell, we consider the set k n n 1 , i , 1 … k n n 1 , i , 200 ∪ k n n 2 , i , 1 … k n n 2 , i , 200 ∪ … ∪ k n n M , i , 1 … k n n M , i , 200 and identify the k -most similar cells within this set based on the weighted similarity metric as weighted nearest neighbors. Preprocessing details for each dataset Cord blood mononuclear cells (CBMC) CITE-seq dataset This CBMC dataset is a CITE-seq dataset from Stoeckius et al. (2017) and contains 8,617 cells with a panel of ten antibodies. We use the expression matrices as quantified in the original experiment. This experiment includes a small proportion of spiked-in murine 3T3 cells as negative controls. We apply SCTransform ( Hafemeister and Satija, 2019 ) to normalize gene expression data, and we apply a CLR transformation to normalize protein data within each cell. We use PCA to reduce the dimensionality of both datasets, taking 30 RNA and 7 protein dimensions to construct the WNN graph. Human bone marrow mononuclear cells (BMNC) CITE-seq dataset The BMNC dataset is a CITE-seq dataset from Stuart et al. (2019) , consisting of 30,672 cells with a panel of 25 antibodies. We use the expression matrices as quantified in the original experiment. For gene expression, in order to facilitate comparisons with other methods, we use standard log-normalization with default parameters in Seurat. We apply a CLR transformation to normalize protein data within each cell. We use PCA to reduce the dimensionality of both datasets, taking 30 RNA and 18 protein dimensions to construct the WNN graph. When performing a targeted re-clustering of T cell populations ( Figure S2 I), we repeated all preprocessing steps and performed the same procedure on 14,901 cells identified as T cells. ASAP-seq dataset of human PBMC We used the published human PBMC ASAP-seq dataset from Mimitou et al. (2020) , containing 4,725 cells with a panel of 227 antibodies. We use the ADT expression matrix, ATAC fragment files, and QC parameters from the original publication. We called peaks from the ATAC fragment files using the MACS2 callpeak function ( Zhang et al., 2008 ), and kept all peaks with -LOG10(qvalue) > 5 for the downstream ATAC analysis. We apply TFIDF to normalize ATAC peaks and CLR transformation to normalize protein data within each cell. We use LSI to reduce the dimensionality of ATAC normalized data, and PCA to reduce the dimensionality of protein. Then, we used LSI dimensions 2-50 LSI dimensions (excluding the first dimension as this is typically correlated with technical metrics in ATAC-seq data), and 30 protein PCA dimensions to construct the WNN graph. 10x multiome ATAC+Gene expression dataset of human PBMC 10x Genomics multiomic (RNA + ATAC) data for human PBMCs was obtained from 10X website ( https://support.10xgenomics.com/single-cell-multiome-atac-gex/datasets ) and was processed using Signac ( Stuart et al., 2020 ) and Seurat. ATAC-seq peaks were then identified for each cell type separately using MACS2, using the function CallPeaks in Signac 1.1.0 with arguments group.by = ‘celltype’ and additional.args = ‘–max-gap 50’. Fragment counts for each peak were quantified per cell using the FeatureMatrix function in Signac. Per-cell quality control metrics were computed using the TSSEnrichment and NucleosomeSignal functions, and cells retained with a nucleosome signal score < 2, TSS enrichment score > 1, and total RNA counts < 100,000 and > 25,000. We apply SCTransform to normalize RNA counts and TFIDF to normalize ATAC peaks. We use LSI to reduce the dimensionality of ATAC data, and PCA to reduce the dimensionality of RNA. Then, we used 2-40 LSI dimensions and 1-40 RNA PCA dimensions to construct the WNN graph. SHARE-seq ATAC+Gene expression dataset of mouse skin cells SHARE-seq data for mouse skin cells was obtained from GEO: GSE140203 ( Ma et al., 2020 ), and was processed using Signac and Seurat. We used the ATAC-seq peak calls, peak by cell quantifications, and fragment files from the original publication. We applied SCTransform to normalize RNA counts and TFIDF to normalize ATAC peaks. We used LSI to reduce the dimensionality of ATAC data, and PCA to reduce the dimensionality of RNA. Then, we used LSI dimensions 2-30 (excluding the first dimension as this is typically correlated with technical metrics in ATAC-seq data) and 30 RNA PCA dimensions to construct the WNN graph. Cells are annotated by their original annotations in the Ma et al. (2020) except for four basal subpopulations which are annotated by WNN-derived clusters. Motif analyses for the ASAP-seq, 10x RNA + ATAC and SHARE-seq datasets followed the suggested workflow described at https://satijalab.org/signac/articles/motif_vignette.html PBMC CITE-seq datasets of HIV Vaccine Trials Network samples Alignment and expression quantification: We applied standard pipelines to initially align and quantify the CITE-seq datasets newly generated for this manuscript. For both the 10x v3 (3′ scRNaseq) and 10x Immune Profiling Solution (5′ scRNA-seq), we used Cell Ranger 3.1.0 to align reads to the GRCh38 human genome with default settings. To quantify libraries of hashtag oligos (HTO) from cell hashing, or antibody-derived tags (ADT) from CITE-seq, we used Alevin ( Srivastava et al., 2019 ). A dictionary of barcode sequences for each antibody clone is included in Table S2 . Quality control and doublet removal: We considered all cells that were detected in our RNA-seq, cell hashing, and ADT libraries. We first filtered out cells with that were outliers for the number of detected features from these modalities. We removed cells with < 500 detected genes, but also removed cells where we detected an aberrantly high number of features (more than 6,000 genes, more than 50,000 ADT reads, or more than 10,000 ADT reads), particularly to avoid clumps of antibodies that can occasionally attach to cells. We used our previously described hashing-based doublet detection strategy ( Stoeckius et al., 2018 ), implemented in HTODemux, to identify doublets that represent two or more cells representing different samples. Inspired by the scrublet package ( Wolock et al., 2019 ), we implemented a strategy to further remove doublets that may originate within the same sample (and would therefore not be identified through cell hashing). We first constructed a KNN graph based on the ADT data. For each cell, we examined the percentage of neighbors that had been marked by HTODemux as doublets. If this percentage exceeded 20%, we reasoned that the cell’s molecular profile was similar to a verified doublet, and therefore removed it from further analysis. Sample integration (10X 3′ CITE-seq experiments): To facilitate the identification of shared cell types across datasets, we applied our previously developed ‘anchor’ workflow ( Stuart et al., 2019 ) to integrate the datasets. We partitioned the dataset into 24 groups, each corresponding to one of the original samples representing one of eight volunteers, and one of three time points. To integrate the gene expression values, we first separately normalized each of the 24 groups using SCTransform, and applied the reciprocal PCA workflow, which is optimized for integration tasks with large numbers of samples and cells. When performing integration, we designated the unvaccinated cells (day 0), as reference datasets. We integrated the protein measurements across samples using the same workflow, but after performing normalization within each cell using a CLR transformation. We reduce the dimensionality of the integrated gene expression and integrated protein datasets via PCA. We use the top 40 and 50 dimensions respectively to construct KNN graphs from the RNA and protein modalities, which is used as input to the WNN procedure described above. Clustering and annotation: To cluster our multimodal dataset, we first used the KNN graph based on the weighted RNA and protein similarities (referred to as the WNN graph), to calculate the Jaccard index (neighborhood overlap) between every pair of cells. This distance represents the edge weight in a shared nearest neighbor graph (SNN), which we used as input to the graph-based smart local moving (SLM) algorithm ( Waltman and Van Eck, 2013 ). We initially clustered cells at a high resolution (resolution = 5), and performed differential expression (see below) on all pairs of clusters for both RNA and protein markers. We merged clusters that did not exhibit clear evidence of separation, or where the only differentially expressed features represented ribosomal genes or mitochondrial genes. In some cases (particularly for extremely rare cell types that required a higher resolution to be correctly annotated in our clustering), we increased the granularity of our clustering by subsetting cells in an individual cluster, and rerunning SLM on this subgraph. In our final annotations, we considered 57 total clusters. We note that the annotation process requires careful consideration of both known RNA and protein markers, as well as those that are discovered through unsupervised analysis. We placed clusters into eight broad groups (Level 1 annotations: CD4 + T cells, CD8 + T cells, Unconventional T, B cells, Natural Killer (NK) cells, Monocytes, Dendritic Cells (DC), and Other (consisting of progenitors and additional rare populations expressing erythroid or platelet lineage markers). We further subdivided these groups into 30 Level 2 annotation categories representing well-described subtypes of human immune cells: CD4 + T Naive, CD4 + T Central Memory (TCM), CD4 + T Effector Memory (TEM), CD8 + TEM, etc., all thirty subtypes are listed at https://azimuth.hubmapconsortium.org/ ). Our 57 clusters fall into subsets of these categories (i.e., CD8 + TCM_1, CD8 + TCM_2, etc.), and represent Level 3 annotations with the highest level of granularity (all listed in the legend for Figure 3 C). We report markers for each of our Level 3 annotations in Figure S4 . Simulated addition of protein noise In Figure 2 C, we perform a robustness analysis to explore the effects of artificially reducing the information content in one data type. To achieve this, we add increasing amounts of random noise to the protein data, immediately prior to running PCA. The amount of noise added is generated independently for each element in the matrix, and is drawn from a Gaussian distribution with mean zero and increasing standard deviation (sd = 0.5, 1, 1.5, 2, 3, 4, 5). After adding noise, we repeated the WNN procedure. Comparing transcriptomic heterogeneity of WNN, RNA, and ADT-derived neighborhoods In addition, we sought to ensure that the incorporation of protein information in the WNN graph does not come at the expense of identifying transcriptomically congruent neighborhoods. We therefore examined the WNN-derived neighborhoods for bone marrow cells originating from clusters with predominantly high protein weights, such as regulatory T cells, and compared them with RNA-derived neighborhoods. If the WNN procedure is performing well, gene expression levels within these neighborhoods should represent a ‘homogeneous’ population with low levels of variability. We therefore compared levels of gene variability between RNA-derived and WNN-derived neighborhoods. We utilized two different measures to quantify the heterogeneity of gene expression within a local neighborhood ( STAR Methods ). Inspired by the M3Drop ( Andrews and Hemberg, 2019 ), we identified ‘variable’ features in a group of cells based on unexpectedly high ‘dropout’ rates after controlling for a gene’s average expression. We found that WNN-derived neighborhoods were most reflective of a homogeneous population, as evidenced by the number of genes that exhibited variable levels of expression within each neighbor set ( Figure S2 ). We obtained similar results when computing a measure of ‘excess variance’, defined as the amount of residual variance observed for each gene after controlling for the mean-variance relationship inherent in single-cell data, and also when repeating these analyses using progenitor subpopulations with high RNA modality weights ( Figure S2 ). Moreover, we found that differentially expressed genes between cell states exhibited nearly identical fold-changes in either WNN-derived or RNA-derived clusters ( Figure S2 ). Specifically, in Figures S2 J–S2M, we test whether the WNN graph generates local neighborhoods that exhibit congruent (or ‘homogeneous’) levels of gene expression. In particular, we sought to confirm this for subpopulations comprising cells with high protein modality weights, such as the 297 regulatory T cells in our BMNC dataset. We therefore considered three sets of 5,940 (297 ∗ k = 20) neighbor cells, defined using either the RNA, ADT, or WNN neighbor graphs, and attempted to identify ‘variable’ genes within these cells as a test of heterogeneity. In Figure S2J, we plot the relationship between pseudobulk-level gene expression and ‘dropout’ rate, as inspired by M3Drop ( Andrews and Hemberg, 2019 ). We fit an average trendline using the ksmooth function from package stats with a Gaussian kernel and default parameters, and calculate the residual of each gene to the fitted line. We consider genes with a residual > 0.1 to be variable. In Figure S2 L we perform the same analysis, but utilize the standard deviation of gene expression across single cells as an alternative metric to ‘dropout’ rate for defining variable genes (residual from trendline > 0.5). We repeat the same analysis for HSC (defined by high RNA modality weights) in Figures S2 K and S2M. Differential analysis for clusters defined by RNA and WNN In Figures S2 N and S2O, we compare the results of differential expression after performing clustering on either the RNA-derived or WNN-derived nearest neighbor graphs for the BMNC dataset. We first cluster cells by the RNA or WNN nearest neighbor graphs respectively, and annotate clusters based on their molecular profiles. While some clusters (for example, regulatory T cells) were only identified in the WNN-derived clusters, we did identify shared populations across both cluster sets including: CD4 Naive T, CD4 Memory T, CD8 Naive T, B Naive, B Memory, HSC, and LMPP subgroups. For both the WNN-derived and RNA-derived cluster sets, we performed four transcriptome-based differential expression tests (HSC versus LMPP, CD8 Naive versus CD4 Naive, CD4 Memory versus CD4 Naive, Naive B versus Memory B) using the Wilcoxon test implemented in Seurat. For genes identified as differentially expressed (adjusted p value < 0.01) in either the WNN-derived or RNA-derived cluster sets, we compared the difference in observed magnitude of log2 fold changes ( Figures S2 N and S2O). Comparisons with MOFA+ and totalVI In order to assess the performance of our WNN method alongside other recently proposed multimodal integration tools, we compared the results of WNN, Total Variational Inference (totalVI version 0.6.7) ( Gayoso et al., 2019 ) and Multi-omics factor analysis v2 (MOFA+ version 1.1) ( Argelaguet et al., 2020 ), on the BMNC dataset. We followed the recommended settings and workflows for both methods, and further describe parameter choices below. For totalVI, we use the RNA and ADT counts matrices as input. We use the subsample_genes function to select 4000 variable genes, and used 500 epochs for model training, as suggested in the totalVI tutorial (https:// scvi-tools.org/en/stable/tutorials/totalvi.html). All other parameters were set to default settings. We identified nearest neighbors, and performed UMAP visualization on the learned latent space. For MOFA+, we used the same normalization method as Seurat to facilitate direct comparison. As recommended in the MOFA+ tutorial ( https://raw.githack.com/bioFAM/MOFA2_tutorials/master/R_tutorials/10x_scRNA_scATAC.html ), we used the z-scored data (‘scaled’ data) from the two assays as view1 and view2 for MOFA+. All other parameters were set to default or recommended settings. We identified nearest neighbors, and performed UMAP visualization based on the learned factors. The UMAP plots in Figures S2 A and S2B show the results of all three methods (we also include independent RNA and protein analyses in Seurat for comparison). The plots show that the methods generally reveal similar sets of cell types, but with important differences. For example, regulatory T cells, defined by CD25 expression, are only separated in the WNN UMAP. Figure S2 B demonstrates that this is due to the fact that CD25 + cells only form a distinct cluster in WNN analysis. In order to move beyond visualization and quantify the performance of each method, we averaged the CD25 expression level for the calculated multimodal neighbors of each cell, returning a vector of predicted values. We quantified the performance of the method using the correlation (Pearson; Figure 2 D, Spearman; Figure S2 ), between predicted and measured values. For CD25, WNN analysis achieved the highest correlation, as cells that are CD25 + are correctly identified as neighbors with other cells that are CD25 + in the dataset. We repeated this analysis for all protein features, and found that, WNN analysis consistently achieved the highest correlation. We repeated the analysis for all transcriptomic features as well ( Figure S2 ) and observed similar performance for all methods. We note that transcriptomic correlations were also much lower, likely due to the substantial technical noise inherent to scRNA-seq data. TCR analysis To generate clonotype information for the 10X 5′ samples, TCRαβ and TCRγδ fastq files were processed with cellranger vdj version 3.0.2 against the GRCh38 v2.0.0 reference as provided by 10x Genomics. Clonotype information was then manually added into Seurat as cell metadata, allowing us to explore the relationship between annotated cell type, molecular state, and TCR sequence. We obtained productive TCR ⍺/β sequences representing 16,060 distinct clones, where all cells within a clone share the exact same CDR3⍺ and CDR3β sequences. Identifying targeted immunophenotype panels For each of our 57 clusters, we aimed to identify a reduced set of antibodies that could enrich for cells in this molecular state. We utilized forward feature selection with balanced logistic regression to identify targeted surface protein markers for each cell type. This represents an iterative process where we successively add markers based on a greedy algorithm aiming to maximize the classification power of logistic regression. Prior to initializing the procedure, we randomly downsampled cells within abundant cell states to ensure that no cluster made up more than 5% of all cells in the dataset. We used the implementation for logistic regression with 5-fold cross validation in the boot R package ( Canty and Ripley, 2020 ). We ran ten rounds of forward selection, allowing us to design panels of one-ten immunophenotypic markers for each cell type. To enhance the interpretability of these panels, we required the first five markers selected to be positive markers. These panels are reported in Table S3 . We used each panel to enrich for our 57 clusters ‘ in silico ’, using logistic regression with a decision boundary of 0.5 to set our gates. We report the enrichment, precision, and recall for each panel in Table S3 . Gradient analysis for NK and B cells In Figures 5 G, 5H, and S5 , we identify genes whose expression level is correlated with a cell’s position along a molecular gradient defined by a single protein. For example, in Figure 5 G, we ordered cells along a gradient defined by CD16 protein expression. We then calculated Moran’s I, a spatial autocorrelation metric proposed to identify trajectory-dependent genes in Monocle3 ( Cao et al., 2019 ), to identify correlated genes. We plot a representative subset of these features in Figure 5 G. We generate these plots by ordering cells on the x axis based on their expression level for CD16 protein, and apply the ksmooth function from package stats with default bandwidth and parameters ( R Development Core Team, 2013 ) to calculate smoothed gene expression levels across the trajectory. We utilize the same approach for trajectory analyses based on CD38 and CD27. Supervised principal component analysis for multimodal data Due to the inherent levels of noise in single-cell RNA-seq, techniques such as PCA are often used to reduce the dimensionality of the dataset. PCA identifies correlated modules of genes, whose heterogeneous expression represent the largest sources of variance in the dataset. PCA is an unsupervised dimensional reduction technique, and while the correlated gene modules may typically represent markers of heterogeneous cell states in the dataset, they may also represent unwanted sources of variation related to technical noise, cell cycle state, or random fluctuations. We therefore considered the application of supervised principal component analysis (sPCA) to our multimodal dataset. sPCA is a generalization of PCA that can be used not only for unsupervised learning, but also for regression and classification problems ( Barshan et al., 2011 ). While PCA will identify the directions that explain maximal variance in the source data, sPCA can help pinpoint sources of variation that are of the greatest interest. To accomplish this, sPCA takes as input a kernel which describes the similarity between any two cells based on a response outcome. We set this kernel to represent the Jaccard distances derived from our WNN graph, as this considers the response outcome to be the weighted combination of RNA and protein profiles. sPCA will then estimate a set of principal components that have maximal dependence on the response variable ( Barshan et al., 2011 ). These components should represent the optimal transcriptomic modules that can be used to separate the cell types defined in our multimodal dataset. Therefore, the sPCA procedure can identify the set of principal components that can transform the data in a single modality to best capture the structure in a multimodal dataset. We emphasize that sPCA takes as input a cell-cell similarity kernel, but does not require cells to be labeled or placed into discrete clusters. Therefore, it can capture both discrete and continuous sources of variation in a multimodal dataset. Formally, sPCA transforms the dataset to maximize the dependency with the response variable. We implement the method described in Barshan et al. (2011) , where the Hilbert-Schmidt Independence Criterion (HSIC) is used as the dependency measure. To apply this method in the context of single cell multimodal data, we define the following: X : data matrix for gene expression measurements Y : data matrix for protein measurements. U : Transformation of X (for example, a set of principal components) K: Kernel derived from U , describes the cell-cell similarity in X L : Kernel derived from the WNN graph, and describes the cell-cell similarity based on a weighted combination of X and Y The HSIC between two kernels K and L is: H S I C ( K , L ) = 1 ( n − 1 ) 2 t r ( K H L H ) The goal of the sPCA is to identify U that maximizes H S I C ( K , L ) H S I C ( ( U T X ) T U T X , L ) = 1 ( n − 1 ) 2 t r ( X T U U T X H L H ) = 1 ( n − 1 ) 2 t r ( U T X H L H X T U ) As described in described in Barshan et al. (2011) , the optimization problem reduces to: argmax U t r U T X H L H X T U s u b j e c t t o U T U = I where H is the centering matrix H ij = I – n -1 ee T . This optimization problem has a closed form solution. U represents the eigenvectors of matrix XHLHX T , based on the top d eigenvalues, where d represents the desired number of components. Each vector in U describes the relative importance for each gene in defining this component (i.e, U represents a set of feature component loadings). Mapping query datasets to a multimodal reference We compute the sPCA transformation described above for our reference dataset, and can subsequently project this transformation onto any query dataset consisting of PBMC. This enables us to perform supervised analysis of the query datasets. Since our sPCA was computed based on a reference defined by a large number of cells and antibodies, this transformation will likely be more informative than an unsupervised PCA computed on a new scRNA-seq query. This transformation should therefore be more capable of separating cell types in the query dataset. As a secondary benefit, projecting the sPCA transformation onto a query dataset places the query in the same low-dimensional space as the reference. This provides a starting point to integrate the two datasets, which can assist in the visualization and annotation of the query as described below. Reference-based Integration for query datasets In Stuart et al. (2019) , we demonstrate a workflow to identify reference-based transfer ‘anchors’ between reference and query datasets. Briefly, this workflow first projects a transformation calculated on the reference dataset onto the query. The method next identifies mutual nearest neighbors ( Haghverdi et al., 2018 ) between the reference and query datasets, based on this L2-normalized low-dimensional space. These anchors can be used to transfer discrete or continuous data from the reference onto the query. For cell annotation (transfer of discrete label form reference to query), each query cell is assigned a label based on a weighted vote classifier, where each anchor provides a vote that is weighted by its similarity to the query cell. When classifying cells in this manuscript, we apply the same workflow, but use the sPCA transformation described above for projection. In Stuart et al. (2019) , we also provide methods to leverage an existing set of anchors in order to modify the underlying gene-expression levels, allowing shared cell types to cluster together across experiments. We apply a similar workflow here. However, instead of correcting values in high-dimensional space, we correct in low-dimensional space. This substantially improves the speed of the method. Moreover, at the conclusion of this procedure, we have placed the query dataset in the same low-dimensional representation (defined by the sPCA transformation) as the reference. Having placed both the query and reference dataset in the same space, we have two options to visualize the query dataset. The first is that we can project the query data onto the same UMAP projection as has been previously computed. To accomplish this, we use the umap_transform functionality implemented in the R uwot package, which enables new points to be adding to an existing embedding. We use this approach to project query datasets onto the reference-defined visualization shown in Figure 3 D. Together, these methods enable a fully automated pipeline to leverage a multimodal single-cell reference to annotate and visualize new single-cell query datasets, even if only the transcriptome was measured. To facilitate users applying this approach to interpret their own datasets from either healthy or diseased PBMC, we have provided a web application ( https://azimuth.hubmapconsortium.org/ ) to automate these analyses. A second option for visualization is to compute a new (‘de-novo’) UMAP visualization, which can be computed after merging the reference and query datasets together. For the analysis of the COVID-19 dataset ( Wilk et al., 2020 ), we compute both visualizations. The reference-based UMAP is shown in Figure 7 D, while the de-novo UMAP is shown in Figure S7 . One advantage of the de-novo approach is that it can help to visualize populations in the query that cannot be effectively represented in the reference. For example, the Wilk et al. (2020) dataset contains subsets of neutrophils, activated granulocytes that were not captured in our reference, as well as subpopulations of monocytes whose expression profiles are heavily perturbed in COVID-19 samples. In the reference-based visualization, the umap_transform functions aims to embed these cells adjacent to their closest neighbors in the reference, which often places these cells at the boundary of cell clusters. In the de-novo visualization, all three of these populations remain distinct from reference cells even after integration ( Figure S7 ). We encourage users to compute both to understand how their dataset can be interpreted in light of a reference, and also to flag any particular populations that may not be well represented. We leverage this reference-based mapping workflow to interpret the 5′ scRNA-seq datasets generated for this manuscript. We use the same QC, normalization, and doublet filtration procedures to analyze the 5′ data as described earlier in this section. We apply the reference-based integrative analysis procedures described above to project the 5′ scRNA-seq data onto the UMAP visualization defined by the 3′ dataset, and also to transfer a discrete label. The annotation and projected UMAP are shown in Figure S5 F, while the UMAP visualization with annotated clonotype structures is shown in Figure 5 K. Similarly, we applied the same pipeline to map the CITE-seq datasets from ( Kotliarov et al., 2020 ). We downloaded the dataset at https://doi.org/10.35092/yhjc.c.4753772 , applied SCTransform normalization, and repeated the mapping procedure applied above. While the dataset contains measurements for 82 proteins alongside the transcriptome, we used only the transcriptome for reference mapping and the transfer of Level 2 annotations. This allowed us to use the withheld protein data for benchmarking with scArches (version 0.1.2) ( Lotfollahi et al., 2020 ), as shown in Figure S7 . Benchmarking Seurat reference-mapping with scArches To run scArches, we followed the tutorial released by the authors. We first integrated our 24 3′ scRNA-seq samples into a reference atlas, using the same variable genes as used in the WNN analysis. We obtained poor results with the default nb loss function, and as suggested in the tutorial, tried the sse loss function as an alternative. We trained the scArches model using recommended parameter settings of 150 epochs and a batch size of 128, and next mapped query cells onto the reference using recommended parameters in the tutorial. To facilitate fair comparisons between our reference mapping workflow and scArches, we forced both methods to return the most likely annotation for each query cell. We note the extensive challenges in benchmarking reference-based annotation workflows in the absence of ground-truth cell labels. By withholding the protein data from consideration during the mapping process, we can use the protein measurements as an independent assessment of prediction quality. For 35,619 cells (67.1%), Seurat and scArches returned the same annotation. For the remaining 17,480 query cells, the two methods returned two divergent annotations (for example, suppose that Seurat annotated the cell as CD4 Treg, and scArches annotated as NK). In the reference dataset, we calculated the protein centroids for the CD4 Treg and NK clusters. We then calculated the Pearson correlation between these centroids, and the protein values for the individual cell. If the cell’s protein levels exhibit a high correlation with the centroid of CD4 Treg, but a low correlation with the centroid of NK, this suggests that the Treg annotation is correct. This metric and approach are inspired by scmap ( Kiselev et al., 2018 ). Essentially, in cases where two methods disagree based on an RNA classification, we attempt to classify the cell based on its protein levels to see if there is strong evidence for one annotation versus another. In 79.4% of cases, we observe stronger support for the Seurat annotation ( Figure S7 E). Quantification and statistical analysis Differential abundance of cell types across experimental conditions In Figures 6 E and 6F, we analyze the composition of samples at different time points, and aim to find cell states whose abundance changes during the response. For Level 1 annotations, for each of the 24 samples, we calculated the percentage of each cell state in each sample, and ran two paired Wilcoxon tests: day 0 versus day 3, and day 0 versus day7. No cell states exhibited significant changes. To search for more subtle changes, we calculated the relative abundance of all 30 Level 2 annotations in each sample within each Level 1 group (for example, for each sample we calculated the fraction of CD14 + monocytes within the total pool of sample monocytes). These values were used as input to two paired Wilcoxon tests: day 0 versus day 3, and day 0 versus day7. We detected significant shifts (p < 0.05) for three clusters, visualized for the 10X 3′ samples in Figure 6 F, with independent support for each of the signals in the 10X 5′ datasets ( Figure S6 ). Identifying differentially expressed genes across cell types and experimental time points In this manuscript (for example, Figure 4 A), we identify differentially expressed (DE) genes and proteins that represent biomarkers of different cell states, or represent specific responses across experimental conditions. We used the wilcoxauc method from presto ( Korsunsky et al., 2019 ) to identify DE genes and proteins, reporting markers with adjusted p value < 10 −5 . For space considerations, we typically report only the top 20 markers in each heatmap, and sort genes first by adjusted p value and next by log fold-change to determine the top markers. Perturbation score In Figure 6 A, we aim to identify the cell types whose molecular state exhibits significant changes during the response to vaccination. We note that when calculating DE genes and proteins within a cell state, across experimental time points, the statistical power of these per-gene tests is heavily dependent on the abundance of the cell state. We therefore considered an alternative metric, the ‘perturbation score’ as described in Papalexi et al. (2020) , which quantifies the magnitude of the response across the transcriptome. To briefly summarize, we perform the following procedure to quantify the response for cells at day 3 versus day 0 for each cell state. We first identify a set of genes that exhibit initial evidence of differential expression across time points, but may not achieve statistical significance after multiple-testing correction (adjusted p value < 0.1). We compute the pseudobulk expression of these genes after grouping cells by experimental time point, generating a vector representing the average expression of these genes for day 0 cells, and a second vector representing the average expression at day 3 cells. We define the ‘perturbation vector’ for this cell state as the difference between these two vectors, normalized to length 1. Finally, we project the transcriptome of each cell onto this vector and quantify the magnitude of this projection. We find that this approach helps to prioritize cell types that exhibit robust responses, particularly when comparing populations with vastly different abundances. Additional resources Installation instructions, tutorials, and documentation for Seurat v4 are available at https://www.satijalab.org/seurat .",
  "source_url": "https://europepmc.org/article/pmcid/PMC8238499"
}